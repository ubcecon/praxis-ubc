<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-GB" xml:lang="en-GB"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-06-27">
<meta name="description" content="Using the KINMATRIX Dataset to explore network analysis for SOCI 415">

<title>Praxis - SOCI 415 Network Analysis - KINMATRIX Dataset</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../media/praxis-badge.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<meta name="keywords" content="economics, econometrics, R, data, machine learning, UBC, COMET, geog 374, econ 325, econ 326, learning, teaching, learn r, r help, help, tutorial, r tutorial for beginners,learning statistics with r, learn r programming, learn statistics, linear regression, r machine learning, learn machine learning, university of british columbia, british columbia, r programming for beginners, r language tutorial, r tutorial for beginners, economic data, econometrics tutoring, economics help for students, economics homework help, oer resources for teachers, open educational resources for teachers, educational resource, oer project, oer materials, oer resources, learn economics online, learn econometrics, teach yourself economics, teach yourself econometrics, econometrics basics for beginners">


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../media/praxis-badge-white.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Praxis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-get-started" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Get Started</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-get-started">    
        <li>
    <a class="dropdown-item" href="../../pages/quickstart.html" rel="" target="">
 <span class="dropdown-text">Quickstart Guide</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-courses" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Courses</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-courses">    
        <li>
    <a class="dropdown-item" href="../../pages/index/index_HIST-414.html" rel="" target="">
 <span class="dropdown-text">HIST-414</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../pages/index/index_AMNE-376.html" rel="" target="">
 <span class="dropdown-text">AMNE-376</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../pages/index/index_SOCI415.html" rel="" target="">
 <span class="dropdown-text">SOCI-415</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../pages/index/index_SOCI280.html" rel="" target="">
 <span class="dropdown-text">SOCI-280</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../pages/index/index_ECON227.html" rel="" target="">
 <span class="dropdown-text">ECON-227</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../../pages/index/all.html" rel="" target="">
 <span class="dropdown-text">Browse All</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../pages/index/index_topical.html" rel="" target="">
 <span class="menu-text">Topics</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-teach-with-praxis" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Teach With prAxIs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-teach-with-praxis">    
        <li>
    <a class="dropdown-item" href="../../pages/teaching_with_comet.html" rel="" target="">
 <span class="dropdown-text">Learn how to teach with prAxIs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../pages/using_comet.html" rel="" target="">
 <span class="dropdown-text">Using prAxIs in the Classroom</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-launch-praxis" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-play" role="img">
</i> 
 <span class="menu-text">Launch prAxIs</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-launch-praxis">    
        <li>
    <a class="dropdown-item" href="https://open.jupyter.ubc.ca/jupyter/hub/user-redirect/git-pull?repo=https%3A%2F%2Fgithub.com%2Fubcecon%2Fcomet-notebooks&amp;urlpath=lab%2Ftree%2Fcomet-notebooks%2F&amp;branch=main" rel="" target=""><i class="bi bi-cloud-check" role="img">
</i> 
 <span class="dropdown-text">Launch on JupyterOpen (with Data)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://open.jupyter.ubc.ca/jupyter/hub/user-redirect/git-pull?repo=https%3A%2F%2Fgithub.com%2Fubcecon%2Fcomet-project&amp;urlpath=lab%2Ftree%2Fcomet-project%2F&amp;branch=main" rel="" target=""><i class="bi bi-cloud-check" role="img">
</i> 
 <span class="dropdown-text">Launch on JupyterOpen (lite)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://ubc.syzygy.ca/jupyter/hub/user-redirect/git-pull?repo=https%3A%2F%2Fgithub.com%2Fubcecon%2Fcomet-project&amp;urlpath=lab%2Ftree%2Fcomet-project%2F&amp;branch=main" rel="" target=""><i class="bi bi-gear" role="img">
</i> 
 <span class="dropdown-text">Launch on Syzygy</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://colab.research.google.com/github/ubcecon/comet-notebooks/blob/main/" rel="" target=""><i class="bi bi-google" role="img">
</i> 
 <span class="dropdown-text">Launch on Colab</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ubcecon/comet-notebooks/archive/refs/heads/main.zip" rel="" target=""><i class="bi bi-cloud-download" role="img">
</i> 
 <span class="dropdown-text">Launch Locally</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="https://github.com/ubcecon/comet-open/archive/refs/heads/datasets.zip" rel="" target=""><i class="bi bi-clipboard-data" role="img">
</i> 
 <span class="dropdown-text">Project Datasets</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ubcecon/comet-open" rel="" target="">
 <span class="dropdown-text">Github Repository</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../#" rel="" target="">
 <span class="menu-text">|</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-about" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">About</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-about">    
        <li>
    <a class="dropdown-item" href="../../pages/team.html" rel="" target="">
 <span class="dropdown-text">prAxIs Team</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../pages/copyright.html" rel="" target="">
 <span class="dropdown-text">Copyright Information</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link active" data-scroll-target="#prerequisites">Prerequisites</a>
  <ul class="collapse">
  <li><a href="#kinmatrix-data-description" id="toc-kinmatrix-data-description" class="nav-link" data-scroll-target="#kinmatrix-data-description">KINMATRIX DATA DESCRIPTION</a>
  <ul class="collapse">
  <li><a href="#part-1.-broader-patterns-across-countries" id="toc-part-1.-broader-patterns-across-countries" class="nav-link" data-scroll-target="#part-1.-broader-patterns-across-countries">Part 1. Broader Patterns Across Countries</a></li>
  <li><a href="#across-countries-density-by-age-and-gender" id="toc-across-countries-density-by-age-and-gender" class="nav-link" data-scroll-target="#across-countries-density-by-age-and-gender">2. Across countries Density by Age and Gender</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#colored-family-networks" id="toc-colored-family-networks" class="nav-link" data-scroll-target="#colored-family-networks">3.0 Colored Family Networks</a>
  <ul class="collapse">
  <li><a href="#make-it-a-networkx-network" id="toc-make-it-a-networkx-network" class="nav-link" data-scroll-target="#make-it-a-networkx-network">3.1 Make it a NetworkX Network</a></li>
  <li><a href="#colored-visualization" id="toc-colored-visualization" class="nav-link" data-scroll-target="#colored-visualization">3.2 Colored Visualization</a></li>
  </ul></li>
  <li><a href="#in-class-discussion-from-the-family-structures-visualization" id="toc-in-class-discussion-from-the-family-structures-visualization" class="nav-link" data-scroll-target="#in-class-discussion-from-the-family-structures-visualization">3.3 In class discussion from the family structures visualization</a></li>
  <li><a href="#visualization-of-gender" id="toc-visualization-of-gender" class="nav-link" data-scroll-target="#visualization-of-gender">4.0 Visualization of Gender</a></li>
  <li><a href="#health-and-education-across-countries" id="toc-health-and-education-across-countries" class="nav-link" data-scroll-target="#health-and-education-across-countries">5.0 Health and Education Across Countries</a>
  <ul class="collapse">
  <li><a href="#health-and-education-variables" id="toc-health-and-education-variables" class="nav-link" data-scroll-target="#health-and-education-variables">5.1 Health and Education Variables</a></li>
  </ul></li>
  <li><a href="#family-size-vs-politics-in-usa-and-poland" id="toc-family-size-vs-politics-in-usa-and-poland" class="nav-link" data-scroll-target="#family-size-vs-politics-in-usa-and-poland">6.0 Family size vs Politics in USA and Poland</a>
  <ul class="collapse">
  <li><a href="#republican-and-democrat-states" id="toc-republican-and-democrat-states" class="nav-link" data-scroll-target="#republican-and-democrat-states">6.1 Republican and Democrat States</a></li>
  <li><a href="#politics-for-poland" id="toc-politics-for-poland" class="nav-link" data-scroll-target="#politics-for-poland">6.2 Politics for Poland</a></li>
  <li><a href="#signifcance-of-these-findings" id="toc-signifcance-of-these-findings" class="nav-link" data-scroll-target="#signifcance-of-these-findings">6.3 Signifcance of these findings</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">6.4 Discussion</a></li>
  </ul></li>
  <li><a href="#employment-and-education-in-poland" id="toc-employment-and-education-in-poland" class="nav-link" data-scroll-target="#employment-and-education-in-poland">7.0 Employment and Education in Poland</a></li>
  <li><a href="#parental-seperations" id="toc-parental-seperations" class="nav-link" data-scroll-target="#parental-seperations">8.0 Parental Seperations</a>
  <ul class="collapse">
  <li><a href="#discussion-1" id="toc-discussion-1" class="nav-link" data-scroll-target="#discussion-1">8.1 Discussion</a></li>
  </ul></li>
  <li><a href="#non-straight-nodes-across-the-countries-and-regions." id="toc-non-straight-nodes-across-the-countries-and-regions." class="nav-link" data-scroll-target="#non-straight-nodes-across-the-countries-and-regions.">9.0 Non-Straight nodes across the countries and regions.</a>
  <ul class="collapse">
  <li><a href="#most-heterosexual-and-non-heterosexual-regions-in-poland-and-denmark" id="toc-most-heterosexual-and-non-heterosexual-regions-in-poland-and-denmark" class="nav-link" data-scroll-target="#most-heterosexual-and-non-heterosexual-regions-in-poland-and-denmark">9.1 Most Heterosexual and Non-Heterosexual regions in Poland and Denmark</a></li>
  </ul></li>
  <li><a href="#hands-on-section" id="toc-hands-on-section" class="nav-link" data-scroll-target="#hands-on-section">10.0 Hands on Section</a></li>
  <li><a href="#citations" id="toc-citations" class="nav-link" data-scroll-target="#citations">11.0 Citations</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/ubcecon/praxis-ubc/issues/new" class="toc-action">Report an issue</a></p></div></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="kinmatrix.ipynb" download="kinmatrix.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">SOCI 415 Network Analysis - KINMATRIX Dataset</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Python</div>
    <div class="quarto-category">network analysis</div>
  </div>
  </div>

<div>
  <div class="description">
    Using the KINMATRIX Dataset to explore network analysis for SOCI 415
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">27 June 2025</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="prerequisites" class="level1">
<h1>Prerequisites</h1>
<p>SOCI 415 Network Anlysis Notebook</p>
<section id="kinmatrix-data-description" class="level2">
<h2 class="anchored" data-anchor-id="kinmatrix-data-description">KINMATRIX DATA DESCRIPTION</h2>
<p>The KINMATRIX dataset represents families as ego-centric networks of younger adults aged 25 to 35, collecting extensive data about both nuclear and extended kin across ten countries. The data include over 12,000 anchor respondents and more than 252,000 anchor-kin dyads, encompassing a wide range of relatives such as parents, siblings, grandparents, aunts, uncles, cousins, and complex kin (e.g., step- and half-relatives).</p>
<p>Anchor respondents refer to the ones directly sampled from. These anchors filled out the survey about their families and kin meaning that they will always be at the center of these family networks.</p>
<p>The countries in the dataset are the United Kingdom, Germany, Poland, Italy, Sweeden, Denmark, Finland, Norway, the Netherlands and the USA.</p>
<section id="part-1.-broader-patterns-across-countries" class="level3">
<h3 class="anchored" data-anchor-id="part-1.-broader-patterns-across-countries">Part 1. Broader Patterns Across Countries</h3>
<p>We will begin by looking at broader patterns across different countries. This will serve as an introduction into the dataset and will be a foundation for more focused analysis later on. First we import all the necessary Python libraries for data manipulation, network analysis, and visualization. This will allow us to get results for each country. The output of this cell will be a list of countries in the data.</p>
<p>Import libraries and the data</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Import libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> mpatches </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> ctx</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.axes_grid1.inset_locator <span class="im">import</span> inset_axes</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> community <span class="im">as</span> community_louvain</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyvis.network <span class="im">import</span> Network</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.cm <span class="im">as</span> cm</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="vs">r'C:\Users\alexr\OneDrive\Desktop\WORK\Summer2025\temp\ZA8825_v1-0-0.dta'</span> <span class="co">#change here once we know how to present the notebook, or change here for a different path</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_stata(file_path)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Print country codes</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'anc_cou'</span>].unique())</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">#Make a list of countries</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>country_dfs <span class="op">=</span> {}</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country <span class="kw">in</span> df[<span class="st">'anc_cou'</span>].unique():</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    country_dfs[country] <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> country]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="make-it-a-network" class="level4">
<h4 class="anchored" data-anchor-id="make-it-a-network">1.1 Make it a Network</h4>
<p>Here, we systematically construct a kinship network for each country in the dataset using the NetworkX Python package. For each country, we filter the data, create a new graph, and add nodes representing anchor individuals and their kin. Then we draw edges between the nodes. Finally, we print out the number of nodes and edges for each country’s network, providing a quick overview of network size and complexity across the dataset.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Set up a dictionary of countries</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>country_map <span class="op">=</span> {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'UK'</span>: <span class="st">'1. UK'</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Germany'</span>: <span class="st">'2. Germany'</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Poland'</span>: <span class="st">'3. Poland'</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Italy'</span>: <span class="st">'4. Italy'</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sweden'</span>: <span class="st">'5. Sweden'</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Denmark'</span>: <span class="st">'6. Denmark'</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Finland'</span>: <span class="st">'7. Finland'</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Norway'</span>: <span class="st">'8. Norway'</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Netherlands'</span>: <span class="st">'9. Netherlands'</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'USA'</span>: <span class="st">'10. USA'</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>graphs <span class="op">=</span> {}</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country, anc_cou_value <span class="kw">in</span> country_map.items():</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    filtered_df <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> anc_cou_value]</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    G_filtered <span class="op">=</span> nx.Graph()</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add anchor nodes</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        G_filtered.add_node(row[<span class="st">'anc_id'</span>], </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>                            country<span class="op">=</span>row[<span class="st">'anc_cou'</span>],</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>                            age<span class="op">=</span>row[<span class="st">'anc_age'</span>],</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>                            gender<span class="op">=</span>row[<span class="st">'anc_gnd'</span>])</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add kin nodes and edges</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        kin_node <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'anc_id'</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>row<span class="sc">.</span>get(<span class="st">'kin_nam'</span>, <span class="st">'unknown'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>        G_filtered.add_node(kin_node, relation<span class="op">=</span>row.get(<span class="st">'kin_rel1'</span>, <span class="va">None</span>))</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>        G_filtered.add_edge(row[<span class="st">'anc_id'</span>], kin_node, relation<span class="op">=</span>row.get(<span class="st">'kin_rel1'</span>, <span class="va">None</span>))</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store the graph and anchor nodes</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    anchor_nodes <span class="op">=</span> <span class="bu">list</span>(filtered_df[<span class="st">'anc_id'</span>].unique())</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    graphs[country] <span class="op">=</span> {</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">'graph'</span>: G_filtered,</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">'anchor_nodes'</span>: anchor_nodes</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>country<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Number of nodes: </span><span class="sc">{</span>G_filtered<span class="sc">.</span>number_of_nodes()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Number of edges: </span><span class="sc">{</span>G_filtered<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see that the Kinmatrix dataset has a wide range of networks ranging from smaller countries like Norway and Denmark (~3000 Nodes) to expansive networks like the United States with 118,702 nodes. This is a good overview, but it does not really give any information on the nature of the networks, their size, family relations and other interesting statistics.</p>
</section>
<section id="finding-summary-statistics-across-the-countries" class="level4">
<h4 class="anchored" data-anchor-id="finding-summary-statistics-across-the-countries">1.2 Finding summary statistics across the countries</h4>
<p>This block computes and displays key network statistics for each country’s kinship network. We calculate the mean degree (average number of connections per node), and the gender distribution among anchor nodes.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country, data <span class="kw">in</span> graphs.items():</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    G <span class="op">=</span> data[<span class="st">'graph'</span>]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    anchor_nodes <span class="op">=</span> data[<span class="st">'anchor_nodes'</span>]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mean degree for anchor nodes only</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    anchor_degrees <span class="op">=</span> [G.degree(n) <span class="cf">for</span> n <span class="kw">in</span> anchor_nodes]</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    mean_anchor_degree <span class="op">=</span> np.mean(anchor_degrees) <span class="cf">if</span> anchor_degrees <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Gender distribution among anchor nodes</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    female_count <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> n <span class="kw">in</span> anchor_nodes <span class="cf">if</span> G.nodes[n].get(<span class="st">'gender'</span>) <span class="op">==</span> <span class="st">'2. Female'</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    male_count <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> n <span class="kw">in</span> anchor_nodes <span class="cf">if</span> G.nodes[n].get(<span class="st">'gender'</span>) <span class="op">==</span> <span class="st">'1. Male'</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    other_count <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> n <span class="kw">in</span> anchor_nodes <span class="cf">if</span> G.nodes[n].get(<span class="st">'gender'</span>) <span class="op">==</span> <span class="st">'3. Other gender or no gender'</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>country<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Mean degree (anchor nodes): </span><span class="sc">{</span>mean_anchor_degree<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Female anchor nodes: </span><span class="sc">{</span>female_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Male anchor nodes: </span><span class="sc">{</span>male_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Other/No gender anchor nodes: </span><span class="sc">{</span>other_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The results are interesting we can see that the smallest family networks are in Germany (16.33 nodes per anchor) and the largest are in the United States (22.72 nodes per anchor). We can also see that there are more women than men in most countries espcially in the US 2,992 compared to 1,956.</p>
</section>
<section id="pyvis-visualization-for-norway" class="level4">
<h4 class="anchored" data-anchor-id="pyvis-visualization-for-norway">1.3 Pyvis Visualization for Norway</h4>
<p>Here we have enough information to do a visualization of our findings. We will use the Pyvis package. This package will make an interactive visualization which you can zoom in and pan around. This will be the most simple visualization we will make, and it will just be on the shape and size of the network. The code loads the NetworkX graph into Pyvis, cleans any missing attribute values, and provides interactive controls for exploring the network.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve the Norway Network</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>G_Norway <span class="op">=</span> graphs[<span class="st">'Norway'</span>][<span class="st">'graph'</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>anchor_nodes_norway <span class="op">=</span> graphs[<span class="st">'Norway'</span>][<span class="st">'anchor_nodes'</span>]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean None attributes</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n, attrs <span class="kw">in</span> G_Norway.nodes(data<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k, v <span class="kw">in</span> attrs.items():</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> v <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>            G_Norway.nodes[n][k] <span class="op">=</span> <span class="st">"NA"</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> u, v, attrs <span class="kw">in</span> G_Norway.edges(data<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k, val <span class="kw">in</span> attrs.items():</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> val <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            G_Norway.edges[u, v][k] <span class="op">=</span> <span class="st">"NA"</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new Pyvis Network</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>net <span class="op">=</span> Network(height<span class="op">=</span><span class="st">'800px'</span>, width<span class="op">=</span><span class="st">'100%'</span>, notebook<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create simple anchor mapping</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>anchor_to_label <span class="op">=</span> {}</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, anchor <span class="kw">in</span> <span class="bu">enumerate</span>(anchor_nodes_norway, <span class="dv">1</span>):</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    anchor_to_label[anchor] <span class="op">=</span> <span class="ss">f"Anchor-</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Add nodes manually </span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node <span class="kw">in</span> G_Norway.nodes():</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node <span class="kw">in</span> anchor_nodes_norway:</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Anchor nodes with labels</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        net.add_node(node, label<span class="op">=</span>anchor_to_label[node], color<span class="op">=</span><span class="st">'#4ECDC4'</span>, size<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Kin nodes</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        net.add_node(node, color<span class="op">=</span><span class="st">'#4ECDC4'</span>, size<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Add edges manually</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> u, v <span class="kw">in</span> G_Norway.edges():</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    net.add_edge(u, v)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node <span class="kw">in</span> net.nodes:</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node[<span class="st">'id'</span>] <span class="kw">not</span> <span class="kw">in</span> anchor_nodes_norway:</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        node[<span class="st">'label'</span>] <span class="op">=</span> <span class="st">''</span> </span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Minimal settings</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>net.show(<span class="st">'norway_updated_network.html'</span>)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"All blue nodes version saved as 'norway_all_blue_nodes.html'"</span>)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total nodes: </span><span class="sc">{</span>G_Norway<span class="sc">.</span>number_of_nodes()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total edges: </span><span class="sc">{</span>G_Norway<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Anchor nodes labeled: </span><span class="sc">{</span><span class="bu">len</span>(anchor_nodes_norway)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="across-countries-density-by-age-and-gender" class="level3">
<h3 class="anchored" data-anchor-id="across-countries-density-by-age-and-gender">2. Across countries Density by Age and Gender</h3>
<p>This code block constructs kinship network graphs for each country in the KINMATRIX dataset and then analyzes how the number of nodes in the family networks vary by age and gender within each country. This analysis helps reveal patterns and differences in family network structure across demographic groups and between countries, providing insight into how kinship connectivity varies by age and gender in different countries.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>graphs <span class="op">=</span> {}</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country, anc_cou_value <span class="kw">in</span> country_map.items():</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    filtered_df <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> anc_cou_value]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    G_filtered <span class="op">=</span> nx.Graph()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add anchor nodes</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        G_filtered.add_node(row[<span class="st">'anc_id'</span>], </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                            country<span class="op">=</span>row[<span class="st">'anc_cou'</span>],</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                            age<span class="op">=</span>row[<span class="st">'anc_age'</span>],</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                            gender<span class="op">=</span>row[<span class="st">'anc_gnd'</span>])</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add kin nodes and edges</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        kin_node <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'anc_id'</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>row<span class="sc">.</span>get(<span class="st">'kin_nam'</span>, <span class="st">'unknown'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        G_filtered.add_node(kin_node, relation<span class="op">=</span>row.get(<span class="st">'kin_rel1'</span>, <span class="va">None</span>))</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        G_filtered.add_edge(row[<span class="st">'anc_id'</span>], kin_node, relation<span class="op">=</span>row.get(<span class="st">'kin_rel1'</span>, <span class="va">None</span>))</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store only the graph</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    graphs[country] <span class="op">=</span> G_filtered</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_family_degree_by_demographics(G_filtered):</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    degree_by_age <span class="op">=</span> {}</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    degree_by_gender <span class="op">=</span> {}</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Identify anchor nodes by prerequisite attribute</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    anchor_nodes <span class="op">=</span> [n <span class="cf">for</span> n, d <span class="kw">in</span> G_filtered.nodes(data<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> (<span class="st">'age'</span> <span class="kw">in</span> d <span class="kw">and</span> <span class="st">'gender'</span> <span class="kw">in</span> d)]</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> anchor_id <span class="kw">in</span> anchor_nodes:</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Degree of the anchor node (number of kin ties)</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        deg <span class="op">=</span> G_filtered.degree(anchor_id)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        age <span class="op">=</span> G_filtered.nodes[anchor_id].get(<span class="st">'age'</span>)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        gender <span class="op">=</span> G_filtered.nodes[anchor_id].get(<span class="st">'gender'</span>)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> age <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>            age_group <span class="op">=</span> age <span class="op">//</span> <span class="dv">10</span> <span class="op">*</span> <span class="dv">10</span>  <span class="co"># e.g., 27 -&gt; 20s</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>            degree_by_age.setdefault(age_group, []).append(deg)</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> gender <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>            degree_by_gender.setdefault(gender, []).append(deg)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Mean Degree by Age Group:"</span>)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> age_group, degrees <span class="kw">in</span> <span class="bu">sorted</span>(degree_by_age.items()):</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Age </span><span class="sc">{</span>age_group<span class="sc">}</span><span class="ss">s: Mean Degree = </span><span class="sc">{</span>np<span class="sc">.</span>mean(degrees)<span class="sc">:.2f}</span><span class="ss">, Count = </span><span class="sc">{</span><span class="bu">len</span>(degrees)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Mean Degree by Gender:"</span>)</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> gender, degrees <span class="kw">in</span> degree_by_gender.items():</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Gender </span><span class="sc">{</span>gender<span class="sc">}</span><span class="ss">: Mean Degree = </span><span class="sc">{</span>np<span class="sc">.</span>mean(degrees)<span class="sc">:.2f}</span><span class="ss">, Count = </span><span class="sc">{</span><span class="bu">len</span>(degrees)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Use this updated function for each country's graph:</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country <span class="kw">in</span> country_map:</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> country <span class="kw">in</span> graphs:</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">--- </span><span class="sc">{</span>country<span class="sc">}</span><span class="ss"> ---"</span>)</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>        analyze_family_degree_by_demographics(graphs[country])</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"No graph available for </span><span class="sc">{</span>country<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="finding-a-pattern" class="level4">
<h4 class="anchored" data-anchor-id="finding-a-pattern">2.1 Finding a Pattern</h4>
<p>Interactive part: Have a look at our findings from sections 1 and 2, based on frameworks taught in class explain a reason for them.</p>
<p>Some example findings are listed below, you can try to answer these 3, or look for your own and try to link it to a concept from class.</p>
<ol type="1">
<li>Age does not seem to be a factor in mean degree. In six out of ten countries, anchors in their 20’s have a higher degree than anchors in their 30’s. Why is this, we would expect older anchors to have larger families?</li>
<li>Women tend to have a higher mean degree than men in all countries (Poland: Male = 17.97, Female = 20.25). Why is this?</li>
<li>The USA has the largest mean degree out of all countries in the dataset by both age and gender. Is it purely because of the large sample size in the US or are there other factors? We might expect the US to have a lower mean degree especially among anchors aged 20-30 as their parents or grandparents are likely to be immigrants disconnected from their families in their original countries.</li>
</ol>
</section>
</section>
</section>
</section>
<section id="colored-family-networks" class="level1">
<h1>3.0 Colored Family Networks</h1>
<p>For the next part of the notebook we have decided to focus on the Pomeranian (Pomorskie in Polish) Voivodeship in north-western Poland with the largest city being Gdańsk. <img src="media/pomorskie.png" class="img-fluid" alt="Location of Pomerania"> It has a population of 2.24 million as of 2019.</p>
<p>The code below will filter our data for Poland and the Pomorskie region to have a smaller subset.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[(df[<span class="st">'anc_cou'</span>] <span class="op">==</span> <span class="st">'3. Poland'</span>) <span class="op">&amp;</span> (df[<span class="st">'anc_regpl'</span>] <span class="op">==</span> <span class="st">'11. Pomorskie'</span>)] <span class="co">#Filter anc_cou to be Poland and anc_regpl to be Pomorskie</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#print(filtered_df.head())</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of rows after filtering: </span><span class="sc">{</span><span class="bu">len</span>(filtered_df)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="make-it-a-networkx-network" class="level3">
<h3 class="anchored" data-anchor-id="make-it-a-networkx-network">3.1 Make it a NetworkX Network</h3>
<p>The code below makes a new NetworkX relationship with anchors (highest level of a family ancestor) and their kin. The output will be the total number of nodes and edges in the Network.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>G_filtered <span class="op">=</span> nx.Graph()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add anchor nodes for filtered data</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    G_filtered.add_node(row[<span class="st">'anc_id'</span>], </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                        country<span class="op">=</span>row[<span class="st">'anc_cou'</span>],</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                        age<span class="op">=</span>row[<span class="st">'anc_age'</span>],</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                        gender<span class="op">=</span>row[<span class="st">'anc_gnd'</span>])</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add kin nodes and edges </span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    kin_node <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'anc_id'</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>row<span class="sc">.</span>get(<span class="st">'kin_nam'</span>, <span class="st">'unknown'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    G_filtered.add_node(kin_node, relation<span class="op">=</span>row.get(<span class="st">'kin_rel1'</span>, <span class="va">None</span>))</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    G_filtered.add_edge(row[<span class="st">'anc_id'</span>], kin_node, relation<span class="op">=</span>row.get(<span class="st">'kin_rel1'</span>, <span class="va">None</span>))</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Define anchor_nodes</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>anchor_nodes <span class="op">=</span> <span class="bu">list</span>(filtered_df[<span class="st">'anc_id'</span>].unique())</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of nodes: </span><span class="sc">{</span>G_filtered<span class="sc">.</span>number_of_nodes()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of edges: </span><span class="sc">{</span>G_filtered<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The Network in the Pomorskie region of Poland is quite small with 2414 nodes meaning that we can easily visualize it without running into computational problems.</p>
</section>
<section id="colored-visualization" class="level3">
<h3 class="anchored" data-anchor-id="colored-visualization">3.2 Colored Visualization</h3>
<p>We will make a Pyvis visualization with coloring for family structures. This will again be an interactive visualization where you will be able to pan and zoom. Another feature is that you can hover over nodes to see their gender,</p>
<p>Below we will have a legend of the relationships.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define color map for main relationship types</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>relationship_colors <span class="op">=</span> {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'father'</span>: <span class="st">'blue'</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mother'</span>: <span class="st">'pink'</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'brother'</span>: <span class="st">'green'</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sister'</span>: <span class="st">'purple'</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'aunt'</span>: <span class="st">'orange'</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'uncle'</span>: <span class="st">'brown'</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'cousin'</span>: <span class="st">'teal'</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grandfather'</span>: <span class="st">'navy'</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grandmother'</span>: <span class="st">'magenta'</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'son'</span>: <span class="st">'red'</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'daughter'</span>: <span class="st">'yellow'</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'nephew'</span>: <span class="st">'lightgreen'</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'niece'</span>: <span class="st">'lightpink'</span>,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stepfather'</span>: <span class="st">'slateblue'</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stepmother'</span>: <span class="st">'plum'</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'other'</span>: <span class="st">'gray'</span>,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_relation(rel_str):</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Extracts the last relationship keyword from the string using word boundaries."""</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(rel_str, <span class="bu">str</span>):</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'other'</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    rel_str <span class="op">=</span> rel_str.lower()</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove the number prefix</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    rel_str <span class="op">=</span> re.sub(<span class="vs">r'^\d+\.\s*'</span>, <span class="st">''</span>, rel_str)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find all matching relationship keywords with word boundaries and return the last one</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    found_relations <span class="op">=</span> []</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort relationship keys by length (longest first) to prioritize longer matches</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    sorted_keys <span class="op">=</span> <span class="bu">sorted</span>(relationship_colors.keys(), key<span class="op">=</span><span class="bu">len</span>, reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key <span class="kw">in</span> sorted_keys:</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> key <span class="op">==</span> <span class="st">'other'</span>:</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use word boundaries to match complete words only</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>        pattern <span class="op">=</span> <span class="vs">r'\b'</span> <span class="op">+</span> re.escape(key) <span class="op">+</span> <span class="vs">r'\b'</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>        matches <span class="op">=</span> <span class="bu">list</span>(re.finditer(pattern, rel_str))</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> match <span class="kw">in</span> matches:</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>            found_relations.append((match.start(), key))</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> found_relations:</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Sort by position and return the last one</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>        found_relations.sort(key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">0</span>])</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> found_relations[<span class="op">-</span><span class="dv">1</span>][<span class="dv">1</span>]</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'other'</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new Pyvis Network</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>net <span class="op">=</span> Network(height<span class="op">=</span><span class="st">'800px'</span>, width<span class="op">=</span><span class="st">'100%'</span>, notebook<span class="op">=</span><span class="va">True</span>, bgcolor<span class="op">=</span><span class="st">'#ffffff'</span>, font_color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Create anchor mapping for cleaner labels</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>anchor_to_label <span class="op">=</span> {}</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>anchor_nodes <span class="op">=</span> <span class="bu">list</span>(filtered_df[<span class="st">'anc_id'</span>].unique())</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, anchor <span class="kw">in</span> <span class="bu">enumerate</span>(anchor_nodes, <span class="dv">1</span>):</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>    anchor_to_label[anchor] <span class="op">=</span> <span class="ss">f"Anchor-</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Add anchor nodes (individuals) with clean labels</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>    net.add_node(row[<span class="st">'anc_id'</span>],</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>                 label<span class="op">=</span>anchor_to_label[row[<span class="st">'anc_id'</span>]],  <span class="co"># Clean "Anchor-X" label</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span><span class="st">'lightblue'</span>,  </span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>                 size<span class="op">=</span><span class="dv">15</span>,  <span class="co"># Larger size for anchor nodes</span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>                 title<span class="op">=</span><span class="ss">f"Age: </span><span class="sc">{</span>row[<span class="st">'anc_age'</span>]<span class="sc">}</span><span class="ss">&lt;br&gt;Gender: </span><span class="sc">{</span>row[<span class="st">'anc_gnd'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Add kin nodes and edges with relationship-based coloring</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>    relation_raw <span class="op">=</span> row.get(<span class="st">'kin_typ'</span>, <span class="va">None</span>)  </span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>    relation <span class="op">=</span> extract_relation(relation_raw)</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> relationship_colors.get(relation, <span class="st">'gray'</span>)</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>    kin_node <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'anc_id'</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>row<span class="sc">.</span>get(<span class="st">'kin_nam'</span>, <span class="st">'unknown'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add kin node with temporary label (will be removed later)</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>    net.add_node(kin_node,</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>                 label<span class="op">=</span><span class="bu">str</span>(row.get(<span class="st">'kin_nam'</span>, <span class="st">'unknown'</span>)),  <span class="co"># Temporary label</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span>color,</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>                 size<span class="op">=</span><span class="dv">8</span>,  <span class="co"># Smaller size for kin nodes</span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>                 title<span class="op">=</span><span class="ss">f"Relation: </span><span class="sc">{</span>relation_raw<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># Hover info stays</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>    net.add_edge(row[<span class="st">'anc_id'</span>], kin_node, title<span class="op">=</span>relation_raw)</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node <span class="kw">in</span> net.nodes:</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node[<span class="st">'id'</span>] <span class="kw">not</span> <span class="kw">in</span> anchor_nodes:</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>        node[<span class="st">'label'</span>] <span class="op">=</span> <span class="st">''</span>  <span class="co"># Empty label for kin nodes - no labels when zoomed in</span></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>net.show_buttons()</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>net.show(<span class="st">'family_structure_network.html'</span>)</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>patches <span class="op">=</span> [mpatches.Patch(color<span class="op">=</span>color, label<span class="op">=</span>relation) <span class="cf">for</span> relation, color <span class="kw">in</span> relationship_colors.items()]</span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the legend of family relations</span></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>ax.legend(handles<span class="op">=</span>patches, loc<span class="op">=</span><span class="st">'center'</span>, frameon<span class="op">=</span><span class="va">False</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">'off'</span>)</span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When looking at the visualization you can hover over the nodes for more family information, or you can look at the color legend printed just below the visualization. When hovering over a node you will see strings similar to “Relation: 100. Father - Aunt 2 - Cousin 1.” At first this might seem confusing, that a single node can have three relations assosiated with it. To explain the bizzare relationship structures lets print out the relationships to understand what’s going on.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build a table of anchor-label, kin-name, relationship string, and extracted main type</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>relationship_table <span class="op">=</span> []</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    anchor_label <span class="op">=</span> anchor_to_label.get(row[<span class="st">'anc_id'</span>], <span class="bu">str</span>(row[<span class="st">'anc_id'</span>]))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    kin_name <span class="op">=</span> row.get(<span class="st">'kin_nam'</span>, <span class="st">'unknown'</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    rel_str <span class="op">=</span> row.get(<span class="st">'kin_typ'</span>, <span class="st">''</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    main_relation <span class="op">=</span> extract_relation(rel_str)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    relationship_table.append({</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Anchor'</span>: anchor_label,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Kin Name'</span>: kin_name,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Relationship(s)'</span>: rel_str,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Main Relation'</span>: main_relation</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>rel_df <span class="op">=</span> pd.DataFrame(relationship_table)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Display first 20 rows for quick inspection</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rel_df.head(<span class="dv">20</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This makes things more clear. For example: the label “245. Mother - Grandfather” means: this kin is reached via the anchor’s “mother” and then her “grandfather.”</p>
<p>Another example is: “145. Father - Aunt 1 - Cousin 1” which means: this relative is a cousin through the anchor’s father’s aunt.</p>
<p>These strings are traversals through the family tree of the anchor individual. The most important is the last term for these two examples “Grandfather” and “Cousin,” these are family role that the node has from the anchors persepctive. The first one is the anchors Grandfather on his mothers side and the second one is his cousin from his father’s side.</p>
</section>
</section>
<section id="in-class-discussion-from-the-family-structures-visualization" class="level1">
<h1>3.3 In class discussion from the family structures visualization</h1>
<p>Students will look at the visualization on their browser and in small groups of 3-4 will discuss how the findings from this dataset can be linked to theories in studied frameworks from the course. After about 10 minuites of discussion groups will state their most interesting or best interpretation that they found, some possible examples are listed below for the Social Exchange Framework, and the Feminist Framework.</p>
<p><strong>Social Exchange Framework</strong> Family ties exist as a exchange of resources so each edge between the nodes means there is some form of exchange, this could range from such as support, care, or obligation. The color-coding of relationships (e.g., blue for father, pink for mother) visually distinguishes different types of exchanges, allowing analysis of who is connected to whom and what kinds of resources or support might flow along those ties. For example, a node with many blue (father) and pink (mother) connections might receive more parental support, while green (brother) or purple (sister) ties could represent sibling exchanges.</p>
<p><strong>Feminist Framework</strong></p>
<p>The feminist framework examines gender roles, power imbalances, and the ways traditional family structures reinforce gender inequality. For example we can link the centrality or marginalization of female roles (e.g., mothers, daughters, sisters) compared to male roles (fathers, sons, brothers) to patriarchical structures of modern western society.</p>
</section>
<section id="visualization-of-gender" class="level1">
<h1>4.0 Visualization of Gender</h1>
<p>Below the code will make an interactive Pyvis visualization with dots colored for gender. This can be used to discuss gender compositions of families and feminist theory. We can see if our network supports the theory of power imbalances and reflect the ways traditional family structures reinforce gender inequality.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Relationship mapping</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>GENDER_FROM_RELATIONSHIP <span class="op">=</span> {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Male relationships</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'father'</span>: <span class="st">'male'</span>, <span class="st">'dad'</span>: <span class="st">'male'</span>, <span class="st">'daddy'</span>: <span class="st">'male'</span>, <span class="st">'papa'</span>: <span class="st">'male'</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'son'</span>: <span class="st">'male'</span>, <span class="st">'brother'</span>: <span class="st">'male'</span>, <span class="st">'grandfather'</span>: <span class="st">'male'</span>, <span class="st">'grandpa'</span>: <span class="st">'male'</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'uncle'</span>: <span class="st">'male'</span>, <span class="st">'nephew'</span>: <span class="st">'male'</span>, <span class="st">'husband'</span>: <span class="st">'male'</span>, <span class="st">'boyfriend'</span>: <span class="st">'male'</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stepfather'</span>: <span class="st">'male'</span>, <span class="st">'stepson'</span>: <span class="st">'male'</span>, <span class="st">'stepbrother'</span>: <span class="st">'male'</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'father-in-law'</span>: <span class="st">'male'</span>, <span class="st">'son-in-law'</span>: <span class="st">'male'</span>, <span class="st">'brother-in-law'</span>: <span class="st">'male'</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'godfather'</span>: <span class="st">'male'</span>, <span class="st">'godson'</span>: <span class="st">'male'</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Female relationships</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mother'</span>: <span class="st">'female'</span>, <span class="st">'mom'</span>: <span class="st">'female'</span>, <span class="st">'mommy'</span>: <span class="st">'female'</span>, <span class="st">'mama'</span>: <span class="st">'female'</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'daughter'</span>: <span class="st">'female'</span>, <span class="st">'sister'</span>: <span class="st">'female'</span>, <span class="st">'grandmother'</span>: <span class="st">'female'</span>, <span class="st">'grandma'</span>: <span class="st">'female'</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'aunt'</span>: <span class="st">'female'</span>, <span class="st">'niece'</span>: <span class="st">'female'</span>, <span class="st">'wife'</span>: <span class="st">'female'</span>, <span class="st">'girlfriend'</span>: <span class="st">'female'</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stepmother'</span>: <span class="st">'female'</span>, <span class="st">'stepdaughter'</span>: <span class="st">'female'</span>, <span class="st">'stepsister'</span>: <span class="st">'female'</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mother-in-law'</span>: <span class="st">'female'</span>, <span class="st">'daughter-in-law'</span>: <span class="st">'female'</span>, <span class="st">'sister-in-law'</span>: <span class="st">'female'</span>,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'godmother'</span>: <span class="st">'female'</span>, <span class="st">'goddaughter'</span>: <span class="st">'female'</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Function to get gender color from node</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_node_gender_and_color(row, is_anchor<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Gender color mapping</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> {<span class="st">'male'</span>: <span class="st">'purple'</span>, <span class="st">'female'</span>: <span class="st">'yellow'</span>, <span class="st">'unknown'</span>: <span class="st">'green'</span>} </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> is_anchor:</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For anchor nodes - check the gender field more thoroughly</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>        gender_field <span class="op">=</span> <span class="bu">str</span>(row.get(<span class="st">'anc_gnd'</span>, <span class="st">''</span>)).lower().strip()</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Handle various gender field formats</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> gender_field <span class="kw">in</span> [<span class="st">'m'</span>, <span class="st">'male'</span>, <span class="st">'man'</span>, <span class="st">'1. male'</span>, <span class="st">'1.male'</span>, <span class="st">'male.'</span>, <span class="st">'1'</span>]:</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'male'</span>, colors[<span class="st">'male'</span>]</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> gender_field <span class="kw">in</span> [<span class="st">'f'</span>, <span class="st">'female'</span>, <span class="st">'woman'</span>, <span class="st">'2. female'</span>, <span class="st">'2.female'</span>, <span class="st">'female.'</span>, <span class="st">'2'</span>]:</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'female'</span>, colors[<span class="st">'female'</span>]</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">'male'</span> <span class="kw">in</span> gender_field <span class="kw">and</span> <span class="st">'female'</span> <span class="kw">not</span> <span class="kw">in</span> gender_field:</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'male'</span>, colors[<span class="st">'male'</span>]</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">'female'</span> <span class="kw">in</span> gender_field:</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'female'</span>, colors[<span class="st">'female'</span>]</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For kin nodes</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>        gender_field <span class="op">=</span> <span class="bu">str</span>(row.get(<span class="st">'kin_gnd'</span>, <span class="st">''</span>)).lower().strip()</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Handle various gender field formats for kin nodes too</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> gender_field <span class="kw">in</span> [<span class="st">'m'</span>, <span class="st">'male'</span>, <span class="st">'man'</span>, <span class="st">'1. male'</span>, <span class="st">'1.male'</span>, <span class="st">'male.'</span>, <span class="st">'1'</span>]:</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'male'</span>, colors[<span class="st">'male'</span>]</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> gender_field <span class="kw">in</span> [<span class="st">'f'</span>, <span class="st">'female'</span>, <span class="st">'woman'</span>, <span class="st">'2. female'</span>, <span class="st">'2.female'</span>, <span class="st">'female.'</span>, <span class="st">'2'</span>]:</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'female'</span>, colors[<span class="st">'female'</span>]</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">'male'</span> <span class="kw">in</span> gender_field <span class="kw">and</span> <span class="st">'female'</span> <span class="kw">not</span> <span class="kw">in</span> gender_field:</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'male'</span>, colors[<span class="st">'male'</span>]</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">'female'</span> <span class="kw">in</span> gender_field:</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'female'</span>, colors[<span class="st">'female'</span>]</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get gender from relationship if direct gender field doesn't work</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>        relationship <span class="op">=</span> <span class="bu">str</span>(row.get(<span class="st">'kin_typ'</span>, <span class="st">''</span>)).lower().strip()</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Clean the relationship string</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>        relationship <span class="op">=</span> re.sub(<span class="vs">r'^(my|the|a|an)\s+'</span>, <span class="st">''</span>, relationship)</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check for relationship matches</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rel_key, gender <span class="kw">in</span> GENDER_FROM_RELATIONSHIP.items():</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rel_key <span class="kw">in</span> relationship <span class="kw">or</span> relationship <span class="kw">in</span> rel_key:</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> gender, colors[gender]</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'unknown'</span>, colors[<span class="st">'unknown'</span>]</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize your network</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>net <span class="op">=</span> Network(height<span class="op">=</span><span class="st">"600px"</span>, width<span class="op">=</span><span class="st">"100%"</span>, bgcolor<span class="op">=</span><span class="st">"#ffffff"</span>, font_color<span class="op">=</span><span class="st">"black"</span>, notebook<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Create anchor mapping for cleaner labels</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>anchor_to_label <span class="op">=</span> {}</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>anchor_nodes <span class="op">=</span> <span class="bu">list</span>(filtered_df[<span class="st">'anc_id'</span>].unique())</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, anchor <span class="kw">in</span> <span class="bu">enumerate</span>(anchor_nodes, <span class="dv">1</span>):</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>    anchor_to_label[anchor] <span class="op">=</span> <span class="ss">f"Anchor-</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Add anchor nodes with gender-based coloring and only gender in hover</span></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Adding anchor nodes with gender colors..."</span>)</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>    gender, color <span class="op">=</span> get_node_gender_and_color(row, is_anchor<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>    net.add_node(row[<span class="st">'anc_id'</span>],</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>                 label<span class="op">=</span>anchor_to_label[row[<span class="st">'anc_id'</span>]],  <span class="co"># Clean "Anchor-X" label</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span>color,</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>                 size<span class="op">=</span><span class="dv">15</span>,  <span class="co"># Larger size for anchor nodes</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>                 title<span class="op">=</span><span class="ss">f"Gender: </span><span class="sc">{</span>gender<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># Only gender in hover</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Add kin nodes and edges with gender-based coloring</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Adding kin nodes with gender colors..."</span>)</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>    gender, color <span class="op">=</span> get_node_gender_and_color(row, is_anchor<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>    kin_node <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'anc_id'</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>row<span class="sc">.</span>get(<span class="st">'kin_nam'</span>, <span class="st">'unknown'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>    net.add_node(kin_node,</span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>                 label<span class="op">=</span><span class="st">''</span>,  <span class="co"># No label for kin nodes</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span>color,</span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>                 size<span class="op">=</span><span class="dv">8</span>,  <span class="co"># Smaller size for kin nodes</span></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>                 title<span class="op">=</span><span class="ss">f"Gender: </span><span class="sc">{</span>gender<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># Only gender in hover</span></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add edge between anchor and kin (no title/hover info on edges)</span></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>    net.add_edge(row[<span class="st">'anc_id'</span>], kin_node)</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove labels from kin nodes (keep only anchor node labels)</span></span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node <span class="kw">in</span> net.nodes:</span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node[<span class="st">'id'</span>] <span class="kw">not</span> <span class="kw">in</span> anchor_nodes:</span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a>        node[<span class="st">'label'</span>] <span class="op">=</span> <span class="st">''</span>  <span class="co"># Empty label for kin nodes</span></span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure and display network</span></span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a>net.show_buttons(filter_<span class="op">=</span>[<span class="st">'physics'</span>])</span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>net.show(<span class="st">'cdn_gender_only_kinship_network_fixed.html'</span>)</span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Network created successfully with gender-only hover info!"</span>)</span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary of node colors</span></span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>node_colors <span class="op">=</span> {}</span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node <span class="kw">in</span> net.nodes:</span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> node[<span class="st">'color'</span>]</span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a>    node_colors[color] <span class="op">=</span> node_colors.get(color, <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Node color summary:"</span>)</span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a>color_to_gender <span class="op">=</span> {<span class="st">'purple'</span>: <span class="st">'Male'</span>, <span class="st">'yellow'</span>: <span class="st">'Female'</span>, <span class="st">'green'</span>: <span class="st">'Unknown'</span>}</span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> color, count <span class="kw">in</span> node_colors.items():</span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a>    gender_name <span class="op">=</span> color_to_gender.get(color, color)</span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>gender_name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss"> nodes"</span>)</span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Network summary:"</span>)</span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"- Total nodes: </span><span class="sc">{</span><span class="bu">len</span>(net.nodes)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"- Total edges: </span><span class="sc">{</span><span class="bu">len</span>(net.edges)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"- Anchor nodes labeled: </span><span class="sc">{</span><span class="bu">len</span>(anchor_nodes)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"- Kin nodes: </span><span class="sc">{</span><span class="bu">len</span>(net.nodes) <span class="op">-</span> <span class="bu">len</span>(anchor_nodes)<span class="sc">}</span><span class="ss"> (no labels)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The color scheme we are using is male are purple, women are yellow and other/unknown gender individuals are colored as green.</p>
</section>
<section id="health-and-education-across-countries" class="level1">
<h1>5.0 Health and Education Across Countries</h1>
<p>The KINMATRIX Dataset is not just limited to information about family relations, during the data gathering process researches also asked about socio-economic variables like education, employment, health, sexuality and religion. Our goal for this section is to look at Health and Education across the ten countries in the dataset. These metrics are based on surveys of anchor individuals. These are subjective measures which can change from country to country, the goal is to look if there are differences between countries which we can infer from the data that causes these differences in health and education. We should not expect these findings to reflect findings in censuses, or large cross country surveys of health and education as that was not the purpose of the KINMATRIX Dataset.</p>
<section id="health-and-education-variables" class="level3">
<h3 class="anchored" data-anchor-id="health-and-education-variables">5.1 Health and Education Variables</h3>
<p>When doing any analysis it’s important to be familiar with the varaibles. In this case we are looking at Health and Education which are <strong>anc_hea</strong> and <strong>anc_eduall</strong>. Below we will print out all possible values these variables can take and the count of responces for each.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"All possible values in 'anc_hea':"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'anc_hea'</span>].value_counts(dropna<span class="op">=</span><span class="va">False</span>), end<span class="op">=</span><span class="st">'</span><span class="ch">\n\n</span><span class="st">'</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"All possible values in 'anc_eduall':"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'anc_eduall'</span>].value_counts(dropna<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>anc_hea</strong>: This variable which stands for the anchor person’s self-rated health. The possible values represent subjective categories ranging from very good to very bad health. We can see most people in the dataset are in good health with few in Bad or Very Bad health.</p>
<p><strong>anc_eduall</strong>: This variable represents the anchor person’s overall level of education, classified into three levels and an option for non-response. We can see most people in the dataset have high education. We will find out about why later on.</p>
<p>The way in which we will define healthy is if the respondant says his health is either “Very Good” or “Good.” As for edcuation we will only look at the “High Responce.”</p>
<p>The Code block below will look through all countries and find most and least educated and most and least healthy.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Country mapping dictionary</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>country_map <span class="op">=</span> {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'UK'</span>: <span class="st">'1. UK'</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Germany'</span>: <span class="st">'2. Germany'</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Poland'</span>: <span class="st">'3. Poland'</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Italy'</span>: <span class="st">'4. Italy'</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sweden'</span>: <span class="st">'5. Sweden'</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Denmark'</span>: <span class="st">'6. Denmark'</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Finland'</span>: <span class="st">'7. Finland'</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Norway'</span>: <span class="st">'8. Norway'</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Netherlands'</span>: <span class="st">'9. Netherlands'</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'USA'</span>: <span class="st">'10. USA'</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize results storage</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>health_results <span class="op">=</span> {}</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>education_results <span class="op">=</span> {}</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percentages for each country</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country, code <span class="kw">in</span> country_map.items():</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    country_df <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> code]</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Health calculation</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    health_counts <span class="op">=</span> country_df[<span class="st">'anc_hea'</span>].value_counts(dropna<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    very_good <span class="op">=</span> health_counts.get(<span class="st">'1. Very good'</span>, <span class="dv">0</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    good <span class="op">=</span> health_counts.get(<span class="st">'2. Good'</span>, <span class="dv">0</span>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    total_health <span class="op">=</span> health_counts.<span class="bu">sum</span>()</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    health_pct <span class="op">=</span> (very_good <span class="op">+</span> good) <span class="op">/</span> total_health <span class="cf">if</span> total_health <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    health_results[country] <span class="op">=</span> health_pct</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Education calculation</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    edu_counts <span class="op">=</span> country_df[<span class="st">'anc_eduall'</span>].value_counts(dropna<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    high_edu <span class="op">=</span> edu_counts.get(<span class="st">'3. High'</span>, <span class="dv">0</span>)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Exclude 'Prefer not to answer' from total</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    valid_responses <span class="op">=</span> edu_counts.drop(<span class="st">'-2. Prefer not to answer'</span>, errors<span class="op">=</span><span class="st">'ignore'</span>).<span class="bu">sum</span>()</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    edu_pct <span class="op">=</span> high_edu <span class="op">/</span> valid_responses <span class="cf">if</span> valid_responses <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    education_results[country] <span class="op">=</span> edu_pct</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort results from most to least</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>sorted_health_desc <span class="op">=</span> <span class="bu">sorted</span>(health_results.items(), key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>sorted_education_desc <span class="op">=</span> <span class="bu">sorted</span>(education_results.items(), key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare output strings</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>health_output <span class="op">=</span> <span class="st">"Countries sorted by health (most to least healthy):</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>edu_output <span class="op">=</span> <span class="st">"Countries sorted by education (most to least educated):</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country, pct <span class="kw">in</span> sorted_health_desc:</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>    health_output <span class="op">+=</span> <span class="ss">f"</span><span class="sc">{</span>country<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>pct<span class="sc">:.2%}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country, pct <span class="kw">in</span> sorted_education_desc:</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>    edu_output <span class="op">+=</span> <span class="ss">f"</span><span class="sc">{</span>country<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>pct<span class="sc">:.2%}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(health_output)</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(edu_output)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see that the finding may be suprising for most people. The United States being the most educated and Germany being the least does seem strange at first glace, but these findings are correct according to the data.</p>
<p>The reason for these findings are the sampling methodoly used by the Researchers. In the <a href="https://www.demographic-research.org/volumes/vol51/25/51-25.pdf">Methods Report</a>, we can find that the KINMATRIX researchers explicitly acknowledge that their data shows “Substantial underrepresentation of lower-educated people in all countries” and “No accurate representation of country differences across intermediate and higher education levels” (8). This is inflating the higher education percentages across the countries in our dataset. Because of the nature of education this bias towards higher education also “extends also to their parental background” (14) and further.</p>
<p>Another reason for this is bias is the manner in which the data was collected. The key reason is that the researchers did not do random sampling, but rather quota sampling from Dynata access panels which hosted an online survey. This method lead to the exclusion of people without internet/computer and there was no mobile access. This is a known limitation of web-based, non-probability sampling that affects social surveys and the researchers are aware of it.</p>
<p>As for the health section the bias is less clear here, but the health results show similar patterns because higher-educated people are both more likely to report good health AND more likely to participate in online surveys, creating a “double selection” effect.</p>
</section>
</section>
<section id="family-size-vs-politics-in-usa-and-poland" class="level1">
<h1>6.0 Family size vs Politics in USA and Poland</h1>
<p>You might have heard in politics and online that right-wing politics is family oriented and conservatives have larger families with more children. This is a common claim but is there empirical evidence to back it up?</p>
<p>In the United States research states that claim that right-leaning individuals tend to have larger families and more children than their left-leaning counterparts, with evidence spanning multiple decades and geographic regions. Republican leaning high-school seniors from 1989-2019 desired more children than their Democrat leaning peers.</p>
<p>As for actual statistics of childbirth between Republican and Democrat states. Analysis of U.S. birth rates reveals that 100 conservative adults raise 208 children on average, compared to 147 for democrats this is a 41% gap which is very significant. Post-2016, Republican-majority counties saw 7,000 more births than expected, while Democratic counties had 38,000 fewer.</p>
<p>There is substantial evidence to conclude that Republican states should have larger families with more children than their Democrat counterparts, but does this track in the KINMATRIX data.</p>
<section id="republican-and-democrat-states" class="level3">
<h3 class="anchored" data-anchor-id="republican-and-democrat-states">6.1 Republican and Democrat States</h3>
<p>The way in which KINMATRIX categories US states is in regions. The regions are New England, South Atlantic, Mid-Atlantic, East South Central, East North Central, Pacific, West South Central, Mountain, and West North Central. Based on these regions and the Cook Partisan Voting Index (PVI).</p>
<p>The Democrat regions are: * New England (CT, MA, ME, NH, RI, VT)‘, * Pacific (AK, CA, HI, OR, WA)’, * Mid-Atlantic (NJ, NY, DE, PA)‘, * East North Central (IL, IN, MI, OH, WI)’</p>
<p>The Republican Regions are: * East South Central (AL, KY, MS, TN)‘, * West South Central (AR, LA, OK, TX)’, * West North Central (IA, KS, MN, MO, NE, ND, SD)‘, * Mountain (AZ, CO, ID, MT, NV, NM, UT, WY)’, * South Atlantic (FL, GA, MD, NC, SC, VA, WV, DC)’</p>
<p>The output of this code block will be the average size of families in these regions.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract US data from country_dfs and make a proper copy</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>us_data <span class="op">=</span> country_dfs[<span class="st">'10. USA'</span>].copy()  </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Map region names to political lean</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>democrat_regions <span class="op">=</span> [</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'5. New England (CT, MA, ME, NH, RI, VT)'</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'6. Pacific (AK, CA, HI, OR, WA)'</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'3. Mid-Atlantic (NJ, NY, DE, PA)'</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'1. East North Central (IL, IN, MI, OH, WI)'</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>republican_regions <span class="op">=</span> [</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2. East South Central (AL, KY, MS, TN)'</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'9. West South Central (AR, LA, OK, TX)'</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'8. West North Central (IA, KS, MN, MO, NE, ND, SD)'</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'4. Mountain (AZ, CO, ID, MT, NV, NM, UT, WY)'</span>,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'7. South Atlantic (FL, GA, MD, NC, SC, VA, WV, DC)'</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Define color map for main relationship types</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>relationship_colors <span class="op">=</span> {</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'father'</span>: <span class="st">'blue'</span>,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mother'</span>: <span class="st">'pink'</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'brother'</span>: <span class="st">'green'</span>,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sister'</span>: <span class="st">'purple'</span>,</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'aunt'</span>: <span class="st">'orange'</span>,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">'uncle'</span>: <span class="st">'brown'</span>,</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'cousin'</span>: <span class="st">'teal'</span>,</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grandfather'</span>: <span class="st">'navy'</span>,</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grandmother'</span>: <span class="st">'magenta'</span>,</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'son'</span>: <span class="st">'red'</span>,</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'daughter'</span>: <span class="st">'yellow'</span>,</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'nephew'</span>: <span class="st">'lightgreen'</span>,</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'niece'</span>: <span class="st">'lightpink'</span>,</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stepfather'</span>: <span class="st">'slateblue'</span>,</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stepmother'</span>: <span class="st">'plum'</span>,</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">'other'</span>: <span class="st">'gray'</span>,</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign group based on region</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> assign_state_group(region):</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> region <span class="kw">in</span> democrat_regions:</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Democrat'</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> region <span class="kw">in</span> republican_regions:</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Republican'</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Define relationship extraction function</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_relation(rel_str):</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(rel_str, <span class="bu">str</span>):</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'other'</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>    rel_str <span class="op">=</span> rel_str.lower()</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>    rel_str <span class="op">=</span> re.sub(<span class="vs">r'^\d+\.\s*'</span>, <span class="st">''</span>, rel_str)</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key <span class="kw">in</span> relationship_colors.keys():</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> key <span class="kw">in</span> rel_str:</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> key</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'other'</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply transformations</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>us_data[<span class="st">'state_group'</span>] <span class="op">=</span> us_data[<span class="st">'anc_regus'</span>].<span class="bu">apply</span>(assign_state_group)</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>us_data[<span class="st">'relation'</span>] <span class="op">=</span> us_data[<span class="st">'kin_typ'</span>].<span class="bu">apply</span>(extract_relation)</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_metrics(group_data):</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>    kin_counts <span class="op">=</span> group_data.groupby(<span class="st">'anc_id'</span>).size()</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>    avg_kin <span class="op">=</span> kin_counts.mean() <span class="cf">if</span> <span class="kw">not</span> kin_counts.empty <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use the normalized relation column instead of string matching on kin_typ</span></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>    children <span class="op">=</span> group_data[group_data[<span class="st">'relation'</span>].isin([<span class="st">'son'</span>, <span class="st">'daughter'</span>])]</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>    children_count <span class="op">=</span> children.groupby(<span class="st">'anc_id'</span>).size()</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>    avg_children <span class="op">=</span> children_count.mean() <span class="cf">if</span> <span class="kw">not</span> children_count.empty <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>    cluster_sizes <span class="op">=</span> kin_counts <span class="op">+</span> <span class="dv">1</span>  <span class="co"># Anchor + kin count</span></span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>    avg_cluster_size <span class="op">=</span> cluster_sizes.mean() <span class="cf">if</span> <span class="kw">not</span> cluster_sizes.empty <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> avg_kin, avg_children, avg_cluster_size</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate results</span></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> {}</span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group <span class="kw">in</span> [<span class="st">'Republican'</span>, <span class="st">'Democrat'</span>]:</span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>    group_data <span class="op">=</span> us_data[us_data[<span class="st">'state_group'</span>] <span class="op">==</span> group]</span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>    avg_kin, avg_children, avg_cluster_size <span class="op">=</span> calculate_metrics(group_data)</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>    results[group] <span class="op">=</span> {</span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">'avg_kin_per_anchor'</span>: avg_kin,</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">'avg_children_per_anchor'</span>: avg_children,</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>        <span class="st">'avg_cluster_size'</span>: avg_cluster_size</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall in the US</span></span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>avg_kin, avg_children, avg_cluster_size <span class="op">=</span> calculate_metrics(us_data)</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>results[<span class="st">'Overall US'</span>] <span class="op">=</span> {</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>    <span class="st">'avg_kin_per_anchor'</span>: avg_kin,</span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>    <span class="st">'avg_children_per_anchor'</span>: avg_children,</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>    <span class="st">'avg_cluster_size'</span>: avg_cluster_size</span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a><span class="co"># print results</span></span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group, metrics <span class="kw">in</span> results.items():</span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>group<span class="sc">}</span><span class="ss"> Regions:"</span>)</span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Avg kin per anchor: </span><span class="sc">{</span>metrics[<span class="st">'avg_kin_per_anchor'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The main findings are consistent with the theory discussed above. From the KINMATRIX data of the 118,702 Nodes in the United States. Republican regions on average have larger families of 23.91 versus 22.33 in Democrat regions. This is a difference of 1.58.</p>
</section>
<section id="politics-for-poland" class="level3">
<h3 class="anchored" data-anchor-id="politics-for-poland">6.2 Politics for Poland</h3>
<p>The administrative Regions for Poland in KINMATRIX is voivodeships. There are 16 voivodeships in Poland and they are the largest administrative regions similar to provinces in Canada. <img src="media/wojewodstwa.png" class="img-fluid" alt="Map of Polish voivodeships"></p>
<p>Let’s see if this tracks across countries and is not just a phenomenon present in the United States. Poland politically is a similarly divided nation with the more Eastern and Southern regions prefering conservative candidates and the Western and Northern regions prefering more liberal candidates. Below is displayed a Map of the 2023 Polish Parlimentary elections. <img src="media/2023_poland.jpg" class="img-fluid" alt="Map of the 2023 Polish Parlimentary elections (For Sejm and Senate)"> The Polish presidential Election had it’s second round on June 1, 2025 and the this is the map of the election. <img src="media/2025_poland.webp" class="img-fluid" alt="Map of this Presidential Election"> This general trend of political allegiance has been around since Poland became independant from the USSR in 1989. Following the analysis in the United States using the Polish election results over the last 20 years the four most left-leaning voivodeships are: Mazowieckie (Warsaw), Pomorskie (Gdansk/Tri-city), Wielkopolskie (Poznan) and Zachodniopomorskie (Szczeczin). The four most right-leaning voivodeships are: Podkarpackie (Rzeszow/Przemysl) Lubelskie (Lublin), Podlaskie (Bialystok), and Świętokrzyskie (Kielce). We will repeat the analysis for the United States with these eight voivodeships.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>poland_df <span class="op">=</span> country_dfs[<span class="st">'3. Poland'</span>].copy()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define left-leaning and right-leaning voivodeships</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>left_leaning_voivodeships <span class="op">=</span> [</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'7. Mazowieckie'</span>,  <span class="co"># Warsaw</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'11. Pomorskie'</span>,   <span class="co"># Gdansk/Tri-city</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'15. Wielkopolskie'</span>,  <span class="co"># Poznan</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'16. Zachodnio-Pomorskie'</span>  <span class="co"># Szczeczin</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>right_leaning_voivodeships <span class="op">=</span> [</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'9. Podkarpackie'</span>,  <span class="co"># Rzeszow/Przemysl</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'4. Lubelskie'</span>,     <span class="co"># Lublin</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'10. Podlaskie'</span>,    <span class="co"># Bialystok</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'13. Swietokrzyskie'</span>  <span class="co"># Kielce</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign political group</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> assign_voivodeship_group(voiv):</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> voiv <span class="kw">in</span> left_leaning_voivodeships:</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Left-leaning'</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> voiv <span class="kw">in</span> right_leaning_voivodeships:</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Right-leaning'</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>poland_df[<span class="st">'voivodeship_group'</span>] <span class="op">=</span> poland_df[<span class="st">'anc_regpl'</span>].<span class="bu">apply</span>(assign_voivodeship_group)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Relationship normalization</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>relationship_colors <span class="op">=</span> {</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">'father'</span>: <span class="st">'blue'</span>,</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mother'</span>: <span class="st">'pink'</span>,</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'brother'</span>: <span class="st">'green'</span>,</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sister'</span>: <span class="st">'purple'</span>,</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'aunt'</span>: <span class="st">'orange'</span>,</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'uncle'</span>: <span class="st">'brown'</span>,</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'cousin'</span>: <span class="st">'teal'</span>,</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grandfather'</span>: <span class="st">'navy'</span>,</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grandmother'</span>: <span class="st">'magenta'</span>,</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">'son'</span>: <span class="st">'red'</span>,</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">'daughter'</span>: <span class="st">'yellow'</span>,</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">'nephew'</span>: <span class="st">'lightgreen'</span>,</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">'niece'</span>: <span class="st">'lightpink'</span>,</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stepfather'</span>: <span class="st">'slateblue'</span>,</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stepmother'</span>: <span class="st">'plum'</span>,</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">'other'</span>: <span class="st">'gray'</span>,</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_relation_pl(rel_str):</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(rel_str, <span class="bu">str</span>):</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'other'</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>    rel_str <span class="op">=</span> rel_str.lower()</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>    rel_str <span class="op">=</span> re.sub(<span class="vs">r'^\d+\.\s*'</span>, <span class="st">''</span>, rel_str)</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key <span class="kw">in</span> relationship_colors.keys():</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> key <span class="kw">in</span> rel_str:</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> key</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'other'</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>poland_df[<span class="st">'relation'</span>] <span class="op">=</span> poland_df[<span class="st">'kin_typ'</span>].<span class="bu">apply</span>(extract_relation_pl)</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Metrics calculation</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_metrics_pl(group_data):</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>    kin_counts <span class="op">=</span> group_data.groupby(<span class="st">'anc_id'</span>).size()</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>    avg_kin <span class="op">=</span> kin_counts.mean() <span class="cf">if</span> <span class="kw">not</span> kin_counts.empty <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>    children <span class="op">=</span> group_data[group_data[<span class="st">'relation'</span>].isin([<span class="st">'son'</span>, <span class="st">'daughter'</span>])]</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>    children_count <span class="op">=</span> children.groupby(<span class="st">'anc_id'</span>).size()</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>    avg_children <span class="op">=</span> children_count.mean() <span class="cf">if</span> <span class="kw">not</span> children_count.empty <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>    cluster_sizes <span class="op">=</span> kin_counts <span class="op">+</span> <span class="dv">1</span>  <span class="co"># Anchor + kin count</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>    avg_cluster_size <span class="op">=</span> cluster_sizes.mean() <span class="cf">if</span> <span class="kw">not</span> cluster_sizes.empty <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> avg_kin, avg_children, avg_cluster_size</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate and print results</span></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>results_pl <span class="op">=</span> {}</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group <span class="kw">in</span> [<span class="st">'Right-leaning'</span>, <span class="st">'Left-leaning'</span>]:</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>    group_data <span class="op">=</span> poland_df[poland_df[<span class="st">'voivodeship_group'</span>] <span class="op">==</span> group]</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>    avg_kin, avg_children, avg_cluster_size <span class="op">=</span> calculate_metrics_pl(group_data)</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>    results_pl[group] <span class="op">=</span> {</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>        <span class="st">'avg_kin_per_anchor'</span>: avg_kin,</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">'avg_children_per_anchor'</span>: avg_children,</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">'avg_cluster_size'</span>: avg_cluster_size</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall Poland</span></span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>avg_kin, avg_children, avg_cluster_size <span class="op">=</span> calculate_metrics_pl(poland_df)</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>results_pl[<span class="st">'Overall Poland'</span>] <span class="op">=</span> {</span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>    <span class="st">'avg_kin_per_anchor'</span>: avg_kin,</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>    <span class="st">'avg_children_per_anchor'</span>: avg_children,</span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>    <span class="st">'avg_cluster_size'</span>: avg_cluster_size</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group, metrics <span class="kw">in</span> results_pl.items():</span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>group<span class="sc">}</span><span class="ss"> Voivodeships:"</span>)</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Avg kin per anchor: </span><span class="sc">{</span>metrics[<span class="st">'avg_kin_per_anchor'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(f"  Avg cluster size: {metrics['avg_cluster_size']:.2f}")</span></span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Just like with the United States the trend of right-leaning Voivodeships having larger families is true. The average kin per anchor in left-leaning regions is 18.54 and in righ-leaning regions is 20.85 a difference of 2.31 which is larger than the 1.58 in the United States.</p>
<p>We should also test if these results are significant. To do this we will use a t-test which you may be familiar with from any introductory statistics class like STATS 200. A t-test measures the difference between the means of two groups, taking into account the variability within those groups. It helps determine if the observed difference is statistically significant, meaning it’s unlikely to have occurred by random chance.</p>
</section>
<section id="signifcance-of-these-findings" class="level3">
<h3 class="anchored" data-anchor-id="signifcance-of-these-findings">6.3 Signifcance of these findings</h3>
<p>We will first do our t-test for the United States.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats <span class="co">#library with statistical functions like t-test</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract US data from country_dfs and make a proper copy</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>us_data <span class="op">=</span> country_dfs[<span class="st">'10. USA'</span>].copy()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Map region names to political lean</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>democrat_regions <span class="op">=</span> [</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'5. New England (CT, MA, ME, NH, RI, VT)'</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'6. Pacific (AK, CA, HI, OR, WA)'</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'3. Mid-Atlantic (NJ, NY, DE, PA)'</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'1. East North Central (IL, IN, MI, OH, WI)'</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>republican_regions <span class="op">=</span> [</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2. East South Central (AL, KY, MS, TN)'</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'9. West South Central (AR, LA, OK, TX)'</span>,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'8. West North Central (IA, KS, MN, MO, NE, ND, SD)'</span>,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'4. Mountain (AZ, CO, ID, MT, NV, NM, UT, WY)'</span>,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'7. South Atlantic (FL, GA, MD, NC, SC, VA, WV, DC)'</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign group based on region</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> assign_state_group(region):</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> region <span class="kw">in</span> democrat_regions:</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Democrat'</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> region <span class="kw">in</span> republican_regions:</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Republican'</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply transformation</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>us_data[<span class="st">'state_group'</span>] <span class="op">=</span> us_data[<span class="st">'anc_regus'</span>].<span class="bu">apply</span>(assign_state_group)</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate kin counts per anchor for each political group</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>republican_kin_counts <span class="op">=</span> us_data[us_data[<span class="st">'state_group'</span>] <span class="op">==</span> <span class="st">'Republican'</span>].groupby(<span class="st">'anc_id'</span>).size()</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>democrat_kin_counts <span class="op">=</span> us_data[us_data[<span class="st">'state_group'</span>] <span class="op">==</span> <span class="st">'Democrat'</span>].groupby(<span class="st">'anc_id'</span>).size()</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform t-test for US data</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>us_t_stat, us_p_value <span class="op">=</span> stats.ttest_ind(republican_kin_counts, democrat_kin_counts)</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Republican regions - Sample size: </span><span class="sc">{</span><span class="bu">len</span>(republican_kin_counts)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Republican regions - Mean kin per anchor: </span><span class="sc">{</span>republican_kin_counts<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Republican regions - Std deviation: </span><span class="sc">{</span>republican_kin_counts<span class="sc">.</span>std()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Democrat regions - Sample size: </span><span class="sc">{</span><span class="bu">len</span>(democrat_kin_counts)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Democrat regions - Mean kin per anchor: </span><span class="sc">{</span>democrat_kin_counts<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Democrat regions - Std deviation: </span><span class="sc">{</span>democrat_kin_counts<span class="sc">.</span>std()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"T-statistic: </span><span class="sc">{</span>us_t_stat<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"P-value: </span><span class="sc">{</span>us_p_value<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Significant at α=0.05: </span><span class="sc">{</span><span class="st">'Yes'</span> <span class="cf">if</span> us_p_value <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="cf">else</span> <span class="st">'No'</span><span class="sc">}</span><span class="ss">"</span>) <span class="co"># main findings to be easy for students</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Significant at α=0.01: </span><span class="sc">{</span><span class="st">'Yes'</span> <span class="cf">if</span> us_p_value <span class="op">&lt;</span> <span class="fl">0.01</span> <span class="cf">else</span> <span class="st">'No'</span><span class="sc">}</span><span class="ss">"</span>) <span class="co"># main findings to be easy for students</span></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We find that for the United States both the Democrat and Republican leaning regions have a large sample size and our findings are significant at both 95% and 99% Confidence Intervals meaning that they are likely not caused by random coincidence.</p>
<p>Let’s see if this trend continues in Poland.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>poland_df <span class="op">=</span> country_dfs[<span class="st">'3. Poland'</span>].copy()</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define left-leaning and right-leaning voivodeships</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>left_leaning_voivodeships <span class="op">=</span> [</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'7. Mazowieckie'</span>,  <span class="co"># Warsaw</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'11. Pomorskie'</span>,   <span class="co"># Gdansk/Tri-city</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'15. Wielkopolskie'</span>,  <span class="co"># Poznan</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'16. Zachodnio-Pomorskie'</span>  <span class="co"># Szczeczin</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>right_leaning_voivodeships <span class="op">=</span> [</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'9. Podkarpackie'</span>,  <span class="co"># Rzeszow/Przemysl</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'4. Lubelskie'</span>,     <span class="co"># Lublin</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'10. Podlaskie'</span>,    <span class="co"># Bialystok</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'13. Swietokrzyskie'</span>  <span class="co"># Kielce</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign political group</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> assign_voivodeship_group(voiv):</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> voiv <span class="kw">in</span> left_leaning_voivodeships:</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Left-leaning'</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> voiv <span class="kw">in</span> right_leaning_voivodeships:</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Right-leaning'</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>poland_df[<span class="st">'voivodeship_group'</span>] <span class="op">=</span> poland_df[<span class="st">'anc_regpl'</span>].<span class="bu">apply</span>(assign_voivodeship_group)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate kin counts per anchor for each political group</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>right_kin_counts <span class="op">=</span> poland_df[poland_df[<span class="st">'voivodeship_group'</span>] <span class="op">==</span> <span class="st">'Right-leaning'</span>].groupby(<span class="st">'anc_id'</span>).size()</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>left_kin_counts <span class="op">=</span> poland_df[poland_df[<span class="st">'voivodeship_group'</span>] <span class="op">==</span> <span class="st">'Left-leaning'</span>].groupby(<span class="st">'anc_id'</span>).size()</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform t-test for Poland data</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>poland_t_stat, poland_p_value <span class="op">=</span> stats.ttest_ind(right_kin_counts, left_kin_counts)</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Right-leaning voivodeships - Sample size: </span><span class="sc">{</span><span class="bu">len</span>(right_kin_counts)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Right-leaning voivodeships - Mean kin per anchor: </span><span class="sc">{</span>right_kin_counts<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Right-leaning voivodeships - Std deviation: </span><span class="sc">{</span>right_kin_counts<span class="sc">.</span>std()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Left-leaning voivodeships - Sample size: </span><span class="sc">{</span><span class="bu">len</span>(left_kin_counts)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Left-leaning voivodeships - Mean kin per anchor: </span><span class="sc">{</span>left_kin_counts<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Left-leaning voivodeships - Std deviation: </span><span class="sc">{</span>left_kin_counts<span class="sc">.</span>std()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"T-statistic: </span><span class="sc">{</span>poland_t_stat<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"P-value: </span><span class="sc">{</span>poland_p_value<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Significant at α=0.05: </span><span class="sc">{</span><span class="st">'Yes'</span> <span class="cf">if</span> poland_p_value <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="cf">else</span> <span class="st">'No'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Significant at α=0.01: </span><span class="sc">{</span><span class="st">'Yes'</span> <span class="cf">if</span> poland_p_value <span class="op">&lt;</span> <span class="fl">0.01</span> <span class="cf">else</span> <span class="st">'No'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We again find that for Poland both the left and right leaning regions have a large enough sample size and our findings are significant at both 95% and 99% Confidence Intervals. Because the research is biased towards educated people it makes sense that the right-leaning regions of Poland have a smaller sample size as most of the educated people will be in larger cities like Warsaw, Krakow or Gdansk (which are left-leaning).</p>
<p>More conservative regions in Poland have larger families by on average 2.31 people. This is even more significant than in the United States.</p>
</section>
<section id="discussion" class="level3">
<h3 class="anchored" data-anchor-id="discussion">6.4 Discussion</h3>
<p>For the next part of the notebook turn to a person next to you and discuss these findings. Why do these more conservative regions have larger families is is just more “traditional values,” or is there something more? Use the frameworks discussed in class. This will be easier for the United States as people are more familiar with politics and life in the United States. But also try for Poland; this will be more difficult.</p>
</section>
</section>
<section id="employment-and-education-in-poland" class="level1">
<h1>7.0 Employment and Education in Poland</h1>
<p>In this section, we analyze the regional patterns of education, employment, and health across the Polish voivodeships, using our data from the KINMATRIX dataset. By summarizing key demographic statistics for each region, we can assess how the socioeconomic landscape of Poland corresponds to established trends we take for granted in theory (for example: larger cities are more educated and have higher employment rates).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="media/wojewodstwa.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Map of Polish voivodeships</figcaption>
</figure>
</div>
<p>The cell below will filter the dataset for Poland and loop through all the voivodeships.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for Poland</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>poland_df <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> <span class="st">'3. Poland'</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique voivodeships</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>voivodeships <span class="op">=</span> poland_df[<span class="st">'anc_regpl'</span>].dropna().unique()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through all voivodeships</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> voiv <span class="kw">in</span> voivodeships:</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    voiv_df <span class="op">=</span> poland_df[poland_df[<span class="st">'anc_regpl'</span>] <span class="op">==</span> voiv]</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Voivodeship: </span><span class="sc">{</span>voiv<span class="sc">}</span><span class="ss">, Number of Anchor Nodes: </span><span class="sc">{</span><span class="bu">len</span>(voiv_df)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the cell below we will get all of our summary statistics for each voivodeship.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List of variables</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>summary_vars <span class="op">=</span> {</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'education'</span>: <span class="st">'anc_eduall'</span>,                <span class="co"># Education (all countries)</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'education_poland'</span>: <span class="st">'anc_edupl'</span>,          <span class="co"># Education (Poland-specific)</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sexual_orientation'</span>: <span class="st">'anc_sor'</span>,          <span class="co"># Sexual orientation</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gender'</span>: <span class="st">'anc_gnd'</span>,                      <span class="co"># Gender</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'income'</span>: <span class="st">'anc_sss'</span>,                      <span class="co"># Subjective social status (income proxy)</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'age'</span>: <span class="st">'anc_age'</span>,                         <span class="co"># Age</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'region'</span>: <span class="st">'anc_regpl'</span>,                    <span class="co"># Voivodeship (region)</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ethnicity'</span>: <span class="st">'anc_eth'</span>,                   <span class="co"># Ethnicity</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'religion1'</span>: <span class="st">'anc_rel1'</span>,                  <span class="co"># Religion (dummy for relgious)</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'religion2'</span>: <span class="st">'anc_rel2'</span>,                  <span class="co"># Religion (which religion)</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'religion3'</span>: <span class="st">'anc_rel3'</span>,                  <span class="co"># Religion (frequency/attendance)</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'employment'</span>: <span class="st">'anc_emp'</span>,                  <span class="co"># Employment status</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'health'</span>: <span class="st">'anc_hea'</span>,                      <span class="co"># Health</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'parental_separation'</span>: <span class="st">'par_sep'</span>          <span class="co"># Parental separation</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summarize_voivodeship(voiv_df):</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> {}</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Network construction</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    G <span class="op">=</span> nx.Graph()</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, row <span class="kw">in</span> voiv_df.iterrows():</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>        G.add_node(row[<span class="st">'anc_id'</span>], age<span class="op">=</span>row[<span class="st">'anc_age'</span>], gender<span class="op">=</span>row[<span class="st">'anc_gnd'</span>])</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>        kin_node <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'anc_id'</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>row<span class="sc">.</span>get(<span class="st">'kin_nam'</span>, <span class="st">'unknown'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>        G.add_node(kin_node, relation<span class="op">=</span>row.get(<span class="st">'kin_typ'</span>, <span class="va">None</span>))</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>        G.add_edge(row[<span class="st">'anc_id'</span>], kin_node)</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'nodes'</span>] <span class="op">=</span> G.number_of_nodes()</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'edges'</span>] <span class="op">=</span> G.number_of_edges()</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'density'</span>] <span class="op">=</span> nx.density(G)</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    degrees <span class="op">=</span> [deg <span class="cf">for</span> node, deg <span class="kw">in</span> G.degree()]</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'mean_degree'</span>] <span class="op">=</span> np.mean(degrees) <span class="cf">if</span> degrees <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Demographic summaries</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> label, var <span class="kw">in</span> summary_vars.items():</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>        value_counts <span class="op">=</span> voiv_df[var].value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>        stats[label] <span class="op">=</span> value_counts.to_dict()</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stats</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for Poland and get unique voivodeships</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>poland_df <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> <span class="st">'3. Poland'</span>]</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>voivodeships <span class="op">=</span> poland_df[<span class="st">'anc_regpl'</span>].dropna().unique()</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through voivodeships and print summary</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> voiv <span class="kw">in</span> voivodeships:</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>    voiv_df <span class="op">=</span> poland_df[poland_df[<span class="st">'anc_regpl'</span>] <span class="op">==</span> voiv]</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> summarize_voivodeship(voiv_df)</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Voivodeship: </span><span class="sc">{</span>voiv<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Nodes: </span><span class="sc">{</span>stats[<span class="st">'nodes'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(f"  Edges: {stats['edges']}")</span></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(f"  Mean degree: {stats['mean_degree']:.2f}")</span></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Education (all): </span><span class="sc">{</span>stats[<span class="st">'education'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Education (Poland): </span><span class="sc">{</span>stats[<span class="st">'education_poland'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(f"  Sexual orientation: {stats['sexual_orientation']}")</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(f"  Gender: {stats['gender']}")</span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(f"  Income (subjective social status): {stats['income']}")</span></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(f"  Age: {stats['age']}")</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(f"  Region: {stats['region']}")</span></span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(f"  Ethnicity: {stats['ethnicity']}")</span></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(f"  Religion 1: {stats['religion1']}")</span></span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(f"  Religion 2: {stats['religion2']}")</span></span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(f"  Religion 3: {stats['religion3']}")</span></span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Employment: </span><span class="sc">{</span>stats[<span class="st">'employment'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Health: </span><span class="sc">{</span>stats[<span class="st">'health'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(f"  Parental separation: {stats['parental_separation']}")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will focus specifically on Education, Employment and Health. We will then contrast this information to the Polish Census and discuss why these differences exist very consistently across the voivodeships. If there are other variables which you are interested in like Age or Sexual orientation you can remove the <strong>#</strong> before the print command for it to show up in the cell output.</p>
<p>We have already looked at the variables education (all countries) and health, but it is a good habit to look at all variables.</p>
<p>In the code block below we will look at Employment (anc_emp) and Education Poland (anc_edupl) to examine the different levels these variables can take.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for Poland</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>poland_df <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> <span class="st">'3. Poland'</span>]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique values for Polish education levels</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>edupl_levels <span class="op">=</span> poland_df[<span class="st">'anc_edupl'</span>].dropna().unique()</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique values for employment levels</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>emp_levels <span class="op">=</span> poland_df[<span class="st">'anc_emp'</span>].dropna().unique()</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Unique values for education_poland (anc_edupl):"</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(edupl_levels)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Unique values for employment (anc_emp):"</span>)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(emp_levels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can already see a big difference between the variables education (all) and education (Poland). The education all variable just has qualitative levels (High, Medium, Low) while the Polish one has tangible levels like Postgraduate, Secondary School or Doctorate. This variable has an order which reflect the Polish Education system from incomplete secondary to the highest, doctorate/post-doctorate.</p>
<p>The employment variable also has clear levels like Full-time employed, Student or Unemployed. These categories are mutually exclusive and cover the main labor force statuses, reflecting employment, unemployment, studying, domestic and care work, retirement, and inability to work due to health.</p>
<p>Let’s go back to our original statistics from above the output of the cell above it is quite overwhelming, to make it easier we can sort from highest to smallest percentage.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>summary_vars <span class="op">=</span> {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'education'</span>: <span class="st">'anc_eduall'</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'education_poland'</span>: <span class="st">'anc_edupl'</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sexual_orientation'</span>: <span class="st">'anc_sor'</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gender'</span>: <span class="st">'anc_gnd'</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'income'</span>: <span class="st">'anc_sss'</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'age'</span>: <span class="st">'anc_age'</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'region'</span>: <span class="st">'anc_regpl'</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ethnicity'</span>: <span class="st">'anc_eth'</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'religion1'</span>: <span class="st">'anc_rel1'</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'religion2'</span>: <span class="st">'anc_rel2'</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'religion3'</span>: <span class="st">'anc_rel3'</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'employment'</span>: <span class="st">'anc_emp'</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'health'</span>: <span class="st">'anc_hea'</span>,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'parental_separation'</span>: <span class="st">'par_sep'</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for Poland and get unique voivodeships</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>poland_df <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> <span class="st">'3. Poland'</span>]</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>voivodeships <span class="op">=</span> poland_df[<span class="st">'anc_regpl'</span>].dropna().unique()</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>summary_results <span class="op">=</span> {}</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> voiv <span class="kw">in</span> voivodeships:</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>    voiv_df <span class="op">=</span> poland_df[poland_df[<span class="st">'anc_regpl'</span>] <span class="op">==</span> voiv]</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> {}</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Network construction</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    G <span class="op">=</span> nx.Graph()</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, row <span class="kw">in</span> voiv_df.iterrows():</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>        G.add_node(row[<span class="st">'anc_id'</span>], age<span class="op">=</span>row[<span class="st">'anc_age'</span>], gender<span class="op">=</span>row[<span class="st">'anc_gnd'</span>])</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>        kin_node <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'anc_id'</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>row<span class="sc">.</span>get(<span class="st">'kin_nam'</span>, <span class="st">'unknown'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>        G.add_node(kin_node, relation<span class="op">=</span>row.get(<span class="st">'kin_typ'</span>, <span class="va">None</span>))</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>        G.add_edge(row[<span class="st">'anc_id'</span>], kin_node)</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'nodes'</span>] <span class="op">=</span> G.number_of_nodes()</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'edges'</span>] <span class="op">=</span> G.number_of_edges()</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'density'</span>] <span class="op">=</span> nx.density(G)</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>    degrees <span class="op">=</span> [deg <span class="cf">for</span> node, deg <span class="kw">in</span> G.degree()]</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'mean_degree'</span>] <span class="op">=</span> np.mean(degrees) <span class="cf">if</span> degrees <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Demographic summaries</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> label, var <span class="kw">in</span> summary_vars.items():</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>        value_counts <span class="op">=</span> voiv_df[var].value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>        stats[label] <span class="op">=</span> value_counts.to_dict()</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>    summary_results[voiv] <span class="op">=</span> stats</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> []</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> voiv, stats <span class="kw">in</span> summary_results.items():</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Education: % High</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>    edu_counts <span class="op">=</span> stats[<span class="st">'education'</span>]</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>    high <span class="op">=</span> edu_counts.get(<span class="st">'3. High'</span>, <span class="dv">0</span>)</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>    total_edu <span class="op">=</span> <span class="bu">sum</span>([v <span class="cf">for</span> k, v <span class="kw">in</span> edu_counts.items() <span class="cf">if</span> <span class="bu">isinstance</span>(v, (<span class="bu">int</span>, <span class="bu">float</span>)) <span class="kw">and</span> k <span class="kw">not</span> <span class="kw">in</span> [<span class="st">'-2. Prefer not to answer'</span>]])</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>    pct_high_edu <span class="op">=</span> high <span class="op">/</span> total_edu <span class="cf">if</span> total_edu <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Employment: % Full-time or Part-time employed</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>    emp_counts <span class="op">=</span> stats[<span class="st">'employment'</span>]</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>    full_time <span class="op">=</span> emp_counts.get(<span class="st">'1. Full-time employed'</span>, <span class="dv">0</span>)</span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>    part_time <span class="op">=</span> emp_counts.get(<span class="st">'2. Part-time employed'</span>, <span class="dv">0</span>)</span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>    employed <span class="op">=</span> full_time <span class="op">+</span> part_time</span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>    total_emp <span class="op">=</span> <span class="bu">sum</span>([v <span class="cf">for</span> k, v <span class="kw">in</span> emp_counts.items() <span class="cf">if</span> <span class="bu">isinstance</span>(v, (<span class="bu">int</span>, <span class="bu">float</span>))])</span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>    pct_employed <span class="op">=</span> employed <span class="op">/</span> total_emp <span class="cf">if</span> total_emp <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Health: % Very good or Good</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>    health_counts <span class="op">=</span> stats[<span class="st">'health'</span>]</span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>    very_good <span class="op">=</span> health_counts.get(<span class="st">'1. Very good'</span>, <span class="dv">0</span>)</span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>    good <span class="op">=</span> health_counts.get(<span class="st">'2. Good'</span>, <span class="dv">0</span>)</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>    healthy <span class="op">=</span> very_good <span class="op">+</span> good</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>    total_health <span class="op">=</span> <span class="bu">sum</span>([v <span class="cf">for</span> k, v <span class="kw">in</span> health_counts.items() <span class="cf">if</span> <span class="bu">isinstance</span>(v, (<span class="bu">int</span>, <span class="bu">float</span>))])</span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>    pct_healthy <span class="op">=</span> healthy <span class="op">/</span> total_health <span class="cf">if</span> total_health <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Number of nodes</span></span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>    nodes <span class="op">=</span> stats[<span class="st">'nodes'</span>]</span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># % not Heterosexual</span></span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>    sex_counts <span class="op">=</span> stats[<span class="st">'sexual_orientation'</span>]</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>    hetero <span class="op">=</span> sex_counts.get(<span class="st">'1. Heterosexual'</span>, <span class="dv">0</span>)</span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>    total_sex <span class="op">=</span> <span class="bu">sum</span>([v <span class="cf">for</span> k, v <span class="kw">in</span> sex_counts.items() <span class="cf">if</span> <span class="bu">isinstance</span>(v, (<span class="bu">int</span>, <span class="bu">float</span>))])</span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>    pct_not_hetero <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (hetero <span class="op">/</span> total_sex) <span class="cf">if</span> total_sex <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>    rows.append({</span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Voivodeship'</span>: voiv,</span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Education_High_pct'</span>: pct_high_edu,</span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Employment_Employed_pct'</span>: pct_employed,</span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Health_Healthy_pct'</span>: pct_healthy,</span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Nodes'</span>: nodes,</span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Pct_Not_Hetero'</span>: pct_not_hetero</span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a>df_summary <span class="op">=</span> pd.DataFrame(rows)</span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort and display for each metric</span></span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> [</span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Education_High_pct'</span>, <span class="st">'Education (High %)'</span>),</span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Employment_Employed_pct'</span>, <span class="st">'Employment (Employed %)'</span>),</span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Health_Healthy_pct'</span>, <span class="st">'Health (Very good or Good %)'</span>),</span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Nodes'</span>, <span class="st">'Number of nodes'</span>),</span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Pct_Not_Hetero'</span>, <span class="st">'% not Heterosexual'</span>)</span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col, label <span class="kw">in</span> metrics:</span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Sorted by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss"> (descending):"</span>)</span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a>    display_cols <span class="op">=</span> [<span class="st">'Voivodeship'</span>, col]</span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df_summary.sort_values(col, ascending<span class="op">=</span><span class="va">False</span>)[display_cols].to_string(index<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we look at the variables of Education, Employment, and Health we can gather which are the richest and healthiest voivodeships. The simplest is employment which we can compare to the <img src="media/registered_unemployed_persons_and_unemployment_rate-02.png" class="img-fluid" alt="Map of Employment in Poland and Polish cities"> This map is from 2017 and from the Polish census we can see that the lowest unemployment rates are in areas with large cities like the Mazowieckie (Warsaw), Malopolskie (Krakow) and Pomorskie (Gdansk) voivodeships. This makes sense as major cities bring opportunities.</p>
<p>Now let’s compare it to our KINMATRIX Data do these findings carry over. Our three most employed voivodeship’s are: Zachodnio-Pomorskie with 86.5%, Wielkopolskie with 81.8% and Dolnoslaskie with 81.5%. Our three least employed are Opolskie with 71.4% Lubuskie with 69.5% and Kujawsko-Pomorskie with 66.29%. Even with the far smaller sample size these findings seem to be in-line with the census data and with development/economic theory. The voivodeship’s with the lowest employment all lack big cities Opole, Lublin and Bydgoszcz are all far smaller than Szczecin, Poznan, and Wroclaw.</p>
</section>
<section id="parental-seperations" class="level1">
<h1>8.0 Parental Seperations</h1>
<p>Let’s look at the Parental Seperation Variable.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Unique values for parental separation (par_sep):"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'par_sep'</span>].dropna().unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It is a simple indicator variable of if the anchor’s parents are seperated.</p>
<p>We will look through all countries in our dataset looking at countries and parental seperation for the parents of the anchor individual.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Country mapping dictionary</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>country_map <span class="op">=</span> {</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'UK'</span>: <span class="st">'1. UK'</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Germany'</span>: <span class="st">'2. Germany'</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Poland'</span>: <span class="st">'3. Poland'</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Italy'</span>: <span class="st">'4. Italy'</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sweden'</span>: <span class="st">'5. Sweden'</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Denmark'</span>: <span class="st">'6. Denmark'</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Finland'</span>: <span class="st">'7. Finland'</span>,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Norway'</span>: <span class="st">'8. Norway'</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Netherlands'</span>: <span class="st">'9. Netherlands'</span>,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'USA'</span>: <span class="st">'10. USA'</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize results storage</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>separation_results <span class="op">=</span> {}</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percentages for each country</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country, code <span class="kw">in</span> country_map.items():</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    country_df <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> code]</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parental separation calculation</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    sep_counts <span class="op">=</span> country_df[<span class="st">'par_sep'</span>].value_counts(dropna<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    separated <span class="op">=</span> sep_counts.get(<span class="st">'1. Yes'</span>, <span class="dv">0</span>)  <span class="co"># Assuming '1. Yes' indicates separation</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Exclude 'Prefer not to answer' from total if it exists</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    valid_responses <span class="op">=</span> sep_counts.drop(<span class="st">'-2. Prefer not to answer'</span>, errors<span class="op">=</span><span class="st">'ignore'</span>).<span class="bu">sum</span>()</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    sep_pct <span class="op">=</span> separated <span class="op">/</span> valid_responses <span class="cf">if</span> valid_responses <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    separation_results[country] <span class="op">=</span> sep_pct</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort results from most to least</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>sorted_separation_desc <span class="op">=</span> <span class="bu">sorted</span>(separation_results.items(), key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare output string</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>separation_output <span class="op">=</span> <span class="st">"Countries sorted by parental separation (highest to lowest rate):</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country, pct <span class="kw">in</span> sorted_separation_desc:</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>    separation_output <span class="op">+=</span> <span class="ss">f"</span><span class="sc">{</span>country<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>pct<span class="sc">:.2%}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(separation_output)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Suprising results with Poland and Italy at the top, we would not expect more traditional and Christian countries to have such a high divorce rate. Let’s re-use the right and left leaning regions in Poland and see if parental seperation differs by political allegiance.</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Left-/right-leaning voivodeship lists are defined as before.</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>left_leaning_voivodeships <span class="op">=</span> [</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'7. Mazowieckie'</span>, <span class="st">'11. Pomorskie'</span>, <span class="st">'15. Wielkopolskie'</span>, <span class="st">'16. Zachodnio-Pomorskie'</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>right_leaning_voivodeships <span class="op">=</span> [</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'9. Podkarpackie'</span>, <span class="st">'4. Lubelskie'</span>, <span class="st">'10. Podlaskie'</span>, <span class="st">'13. Swietokrzyskie'</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure poland_df comes from the correct key</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>poland_df <span class="op">=</span> country_dfs[<span class="st">'3. Poland'</span>].copy()</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the group using anc_regpl</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> assign_voivodeship_group(voiv):</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> voiv <span class="kw">in</span> left_leaning_voivodeships:</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Left-leaning'</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> voiv <span class="kw">in</span> right_leaning_voivodeships:</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Right-leaning'</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>poland_df[<span class="st">'voivodeship_group'</span>] <span class="op">=</span> poland_df[<span class="st">'anc_regpl'</span>].<span class="bu">apply</span>(assign_voivodeship_group)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate parental separation per political group</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>sep_results <span class="op">=</span> {}</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group <span class="kw">in</span> [<span class="st">'Left-leaning'</span>, <span class="st">'Right-leaning'</span>, <span class="st">'Other'</span>]:</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    grp <span class="op">=</span> poland_df[poland_df[<span class="st">'voivodeship_group'</span>] <span class="op">==</span> group]</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    counts <span class="op">=</span> grp[<span class="st">'par_sep'</span>].value_counts(dropna<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>    separated <span class="op">=</span> counts.get(<span class="st">'1. Yes'</span>, <span class="dv">0</span>)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>    valid <span class="op">=</span> counts.drop(<span class="st">'-2. Prefer not to answer'</span>, errors<span class="op">=</span><span class="st">'ignore'</span>).<span class="bu">sum</span>()</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>    pct <span class="op">=</span> separated <span class="op">/</span> valid <span class="cf">if</span> valid <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    sep_results[group] <span class="op">=</span> pct</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group, pct <span class="kw">in</span> sep_results.items():</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>group<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>pct<span class="sc">:.2%}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see that there is no difference between left and right leaning regions with the Left-leaning regions have a seperation percentage of 66.69% and the right leaning regions having one of 69.57%. So the cause is not political leaning. Let us also repeat this analysis for the United States.</p>
<p>USA Analysis of Political allegiance</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#American Regions</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>democrat_regions <span class="op">=</span> [</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'5. New England (CT, MA, ME, NH, RI, VT)'</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'6. Pacific (AK, CA, HI, OR, WA)'</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'3. Mid-Atlantic (NJ, NY, DE, PA)'</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'1. East North Central (IL, IN, MI, OH, WI)'</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>republican_regions <span class="op">=</span> [</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2. East South Central (AL, KY, MS, TN)'</span>,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'9. West South Central (AR, LA, OK, TX)'</span>,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'8. West North Central (IA, KS, MN, MO, NE, ND...'</span>,  </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'4. Mountain (AZ, CO, ID, MT, NV, NM, UT, WY)'</span>,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'7. South Atlantic (FL, GA, MD, NC, SC, VA, WV...'</span>   </span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>us_df <span class="op">=</span> country_dfs[<span class="st">'10. USA'</span>].copy()</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> assign_state_group(region):</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> region <span class="kw">in</span> democrat_regions:</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Democrat'</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> region <span class="kw">in</span> republican_regions:</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Republican'</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>us_df[<span class="st">'state_group'</span>] <span class="op">=</span> us_df[<span class="st">'anc_regus'</span>].<span class="bu">apply</span>(assign_state_group)</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>sep_results <span class="op">=</span> {}</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group <span class="kw">in</span> [<span class="st">'Democrat'</span>, <span class="st">'Republican'</span>]:</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    grp <span class="op">=</span> us_df[us_df[<span class="st">'state_group'</span>] <span class="op">==</span> group]</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    counts <span class="op">=</span> grp[<span class="st">'par_sep'</span>].value_counts(dropna<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    separated <span class="op">=</span> counts.get(<span class="st">'1. Yes'</span>, <span class="dv">0</span>)</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    valid <span class="op">=</span> counts.drop(<span class="st">'-2. Prefer not to answer'</span>, errors<span class="op">=</span><span class="st">'ignore'</span>).<span class="bu">sum</span>()</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>    pct <span class="op">=</span> separated <span class="op">/</span> valid <span class="cf">if</span> valid <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>    sep_results[group] <span class="op">=</span> pct</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group, pct <span class="kw">in</span> sep_results.items():</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>group<span class="sc">}</span><span class="ss"> regions: </span><span class="sc">{</span>pct<span class="sc">:.2%}</span><span class="ss"> had parental separation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The pattern is different in the United States we can see that Democrat regions have a far larger divorce rate than republican regions 52.59% compared to 44.41%. This is a large difference, but can we dig deeper into the reason for this difference. A possible reason for this could be religion where Republicans are more likely to be Christian than Democrats.</p>
<p><strong>Note</strong>: Religion questions were deliberately excluded from European KINMATRIX surveys, so we can not use it for our analysis of the European countries. They were only included for the United States which makes it perfect for this analysis.</p>
<p>We have three religious variables in the KINMATRIX Dataset. anc_rel1, anc_rel2, and anc_rel3. Like with all variables, let’s look at all the levels this variable can take.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Unique values for anc_rel1 (Religious dummy):"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'anc_rel1'</span>].dropna().unique())</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Unique values for anc_rel2 (Religion ident.):"</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'anc_rel2'</span>].dropna().unique())</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Unique values for anc_rel3 (Attendance/frequency):"</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'anc_rel3'</span>].dropna().unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the output we can see that: * anc_rel1 is a dummy variable for if the person is religious. * anc_rel2 is a qualitative variable for which religion the person believe in. * anc_rel3 is a variable for the frequency or attendace (how devout the person is).</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sep_rate(df):</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    counts <span class="op">=</span> df[<span class="st">'par_sep'</span>].value_counts(dropna<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    separated <span class="op">=</span> counts.get(<span class="st">'1. Yes'</span>, <span class="dv">0</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Exclude 'Prefer not to answer' from total if it exists</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    valid <span class="op">=</span> counts.drop(<span class="st">'-2. Prefer not to answer'</span>, errors<span class="op">=</span><span class="st">'ignore'</span>).<span class="bu">sum</span>()</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="dv">100</span> <span class="op">*</span> separated <span class="op">/</span> valid) <span class="cf">if</span> valid <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Proportion "Religious" (anc_rel1 == "1. Yes")</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Religious Differences by Region"</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>rel1 <span class="op">=</span> us_df[us_df[<span class="st">'anc_rel1'</span>] <span class="op">!=</span> <span class="st">'-3. Does not apply'</span>]    <span class="co"># Exclude "Does not apply"</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group <span class="kw">in</span> [<span class="st">'Democrat'</span>, <span class="st">'Republican'</span>]:</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> rel1[rel1[<span class="st">'state_group'</span>] <span class="op">==</span> group].shape[<span class="dv">0</span>]</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    religious <span class="op">=</span> rel1[(rel1[<span class="st">'state_group'</span>]<span class="op">==</span>group) <span class="op">&amp;</span> (rel1[<span class="st">'anc_rel1'</span>] <span class="op">==</span> <span class="st">'1. Yes'</span>)].shape[<span class="dv">0</span>]</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    pct <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> religious <span class="op">/</span> total <span class="cf">if</span> total <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>group<span class="sc">}</span><span class="ss"> regions: </span><span class="sc">{</span>pct<span class="sc">:.1f}</span><span class="ss">% report 'religious' (anc_rel1 == 'Yes')"</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Proportion attending at least monthly</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>freq_vals <span class="op">=</span> {<span class="st">"1. Every day"</span>, <span class="st">"2. More than once a week"</span>, <span class="st">"3. Once a week"</span>, <span class="st">"4. At least once a month"</span>}</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Proportion attending religious services at least monthly:"</span>)</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group <span class="kw">in</span> [<span class="st">'Democrat'</span>, <span class="st">'Republican'</span>]:</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> us_df[us_df[<span class="st">'state_group'</span>] <span class="op">==</span> group]</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    att <span class="op">=</span> sub[<span class="st">'anc_rel3'</span>].isin(freq_vals).<span class="bu">sum</span>()</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> sub[<span class="st">'anc_rel3'</span>].notna().<span class="bu">sum</span>()</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>    pct <span class="op">=</span> <span class="dv">100</span><span class="op">*</span>att<span class="op">/</span>total <span class="cf">if</span> total <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>group<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>pct<span class="sc">:.1f}</span><span class="ss">% attend services at least monthly"</span>)</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Parental separation by religion ("Yes"/"No") within each region</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Parental separation by religious status within region:"</span>)</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group <span class="kw">in</span> [<span class="st">'Democrat'</span>,<span class="st">'Republican'</span>]:</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> rel_flag <span class="kw">in</span> [<span class="st">'1. Yes'</span>,<span class="st">'2. No'</span>]:</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> us_df[(us_df[<span class="st">'state_group'</span>] <span class="op">==</span> group) <span class="op">&amp;</span> (us_df[<span class="st">'anc_rel1'</span>] <span class="op">==</span> rel_flag)]</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>        pct <span class="op">=</span> sep_rate(sub)</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>group<span class="sc">}</span><span class="ss"> - Religious '</span><span class="sc">{</span>rel_flag<span class="sc">}</span><span class="ss">': </span><span class="sc">{</span>pct<span class="sc">:.2f}</span><span class="ss">% parental separation"</span>)</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we expected republican regions are more relgious with 53% compared to 43% reporting that they are relgious and they also attend relgious services more often 14.7% instead of 11.7%.</p>
<p>What is suprising is that it seems that relgious families have a significant higher percentage of parental seperation for both democrat and republican leaning regions.</p>
<section id="discussion-1" class="level2">
<h2 class="anchored" data-anchor-id="discussion-1">8.1 Discussion</h2>
<p>The findings in this section are suprising. In small groups discuss these findings, some potential discussion topics are: * Cross-national variation: Poland and Italy—often seen as more traditional and Christian countries—show the highest parental separation rates in this dataset, defying expectations based on cultural stereotypes. * Poland has no difference in parental seperation based on political regions, but the United States does why is that? * How do we interpret the finding that within the US, ‘religious’ families (by self-report) have higher parental separation than non-religious ones? Does anyone have any ideas as to why?</p>
</section>
</section>
<section id="non-straight-nodes-across-the-countries-and-regions." class="level1">
<h1>9.0 Non-Straight nodes across the countries and regions.</h1>
<p>For the last part of this notebook let’s look at which countries have the most straight and non-straight respondants. To do this we will use the <strong>anc_sor</strong> variable. As with all variables let’s look at all the values this variable can take.</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'anc_sor'</span>].dropna().unique())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This variable records how respondents self-identify their sexual orientation. The variable is categorical, with four possible responses: Heterosexual, Gay or Lesbian, Bisexual and other.</p>
<p>Now let’s look through all the countries in the dataset looking for least and most straight countries.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your country mapping dictionary</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>country_map <span class="op">=</span> {</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'UK'</span>: <span class="st">'1. UK'</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Germany'</span>: <span class="st">'2. Germany'</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Poland'</span>: <span class="st">'3. Poland'</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Italy'</span>: <span class="st">'4. Italy'</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sweden'</span>: <span class="st">'5. Sweden'</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Denmark'</span>: <span class="st">'6. Denmark'</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Finland'</span>: <span class="st">'7. Finland'</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Norway'</span>: <span class="st">'8. Norway'</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Netherlands'</span>: <span class="st">'9. Netherlands'</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'USA'</span>: <span class="st">'10. USA'</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize results dictionary</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>orientation_results <span class="op">=</span> {}</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percentages for each country and sexual orientation</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country, code <span class="kw">in</span> country_map.items():</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    country_df <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> code]</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Value counts including NaNs (if needed)</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    sor_counts <span class="op">=</span> country_df[<span class="st">'anc_sor'</span>].value_counts(dropna<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optionally, exclude 'Prefer not to answer' category</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    valid_counts <span class="op">=</span> sor_counts.drop(<span class="st">'-2. Prefer not to answer'</span>, errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> valid_counts.<span class="bu">sum</span>()</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate percentages for each orientation</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>    percentages <span class="op">=</span> {k: (v <span class="op">/</span> total) <span class="cf">for</span> k, v <span class="kw">in</span> valid_counts.items()} <span class="cf">if</span> total <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> {}</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>    orientation_results[country] <span class="op">=</span> percentages</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country, percentages <span class="kw">in</span> orientation_results.items():</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>country_map[country]<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> percentages:</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"  No data"</span>)</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by most common orientation first</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>    sorted_orientations <span class="op">=</span> <span class="bu">sorted</span>(percentages.items(), key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> orientation, pct <span class="kw">in</span> sorted_orientations:</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>orientation<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>pct<span class="sc">:.2%}</span><span class="ss">"</span>)</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()  <span class="co"># Blank line between countries</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Interesting findings: Poland has the highest percentage of people identifying as heterosexual (92.21%), making it the most heterosexual country in this set. Denmark has the lowest percentage identifying as heterosexual (81.57%), and thus the highest percentage identifying as non-heterosexual (18.43%).</p>
<section id="most-heterosexual-and-non-heterosexual-regions-in-poland-and-denmark" class="level3">
<h3 class="anchored" data-anchor-id="most-heterosexual-and-non-heterosexual-regions-in-poland-and-denmark">9.1 Most Heterosexual and Non-Heterosexual regions in Poland and Denmark</h3>
<p>We will look at the regions within each country that have the most heterosexual and non-heterosexual respondants.</p>
<p>First Poland:</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For Poland: calculate percentages per voivodeship</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>poland_df <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> <span class="st">'3. Poland'</span>]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>voivodeships <span class="op">=</span> poland_df[<span class="st">'anc_regpl'</span>].dropna().unique()</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>region_hetero <span class="op">=</span> {}</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> voivodeships:</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    region_df <span class="op">=</span> poland_df[poland_df[<span class="st">'anc_regpl'</span>] <span class="op">==</span> region]</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    counts <span class="op">=</span> region_df[<span class="st">'anc_sor'</span>].value_counts(dropna<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    counts <span class="op">=</span> counts.drop(<span class="st">'-2. Prefer not to answer'</span>, errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> counts.<span class="bu">sum</span>()</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    pct_hetero <span class="op">=</span> counts.get(<span class="st">'1. Heterosexual'</span>, <span class="dv">0</span>) <span class="op">/</span> total <span class="cf">if</span> total <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    region_hetero[region] <span class="op">=</span> pct_hetero</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort and print most and least heterosexual regions</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>most_hetero_region <span class="op">=</span> <span class="bu">max</span>(region_hetero.items(), key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>])</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>least_hetero_region <span class="op">=</span> <span class="bu">min</span>(region_hetero.items(), key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>])</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Poland:"</span>)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Most heterosexual region: </span><span class="sc">{</span>most_hetero_region[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>most_hetero_region[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%)"</span>)</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Most non-heterosexual region: </span><span class="sc">{</span>least_hetero_region[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="dv">100</span> <span class="op">-</span> least_hetero_region[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can again consult our map of the Polish Voivodeships <img src="media/wojewodstwa.png" class="img-fluid" alt="Map of Polish voivodeships">. Opole is the smallest and least populated voivodeship (province) of Poland. The province’s name derives from that of the region’s capital and largest city, Opole. Students should already be familiar with Pomerania (Pomorskie) as we have already used and discussed this voievodeship in this notebook. Pomorskie is in the north of Poland on the Baltic sea with the largest city being Gdansk which is a large port along with Gdynia in the region.</p>
<p>Let’s now look at the findings in for Denmark:</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For Denmark: similar approach</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>denmark_df <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> <span class="st">'6. Denmark'</span>]</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>regions_dk <span class="op">=</span> denmark_df[<span class="st">'anc_regdk'</span>].dropna().unique()</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>region_hetero_dk <span class="op">=</span> {}</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region <span class="kw">in</span> regions_dk:</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    region_df <span class="op">=</span> denmark_df[denmark_df[<span class="st">'anc_regdk'</span>] <span class="op">==</span> region]</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    counts <span class="op">=</span> region_df[<span class="st">'anc_sor'</span>].value_counts(dropna<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    counts <span class="op">=</span> counts.drop(<span class="st">'-2. Prefer not to answer'</span>, errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> counts.<span class="bu">sum</span>()</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    pct_hetero <span class="op">=</span> counts.get(<span class="st">'1. Heterosexual'</span>, <span class="dv">0</span>) <span class="op">/</span> total <span class="cf">if</span> total <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    region_hetero_dk[region] <span class="op">=</span> pct_hetero</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort and print most and least heterosexual regions</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>most_hetero_region_dk <span class="op">=</span> <span class="bu">max</span>(region_hetero_dk.items(), key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>])</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>least_hetero_region_dk <span class="op">=</span> <span class="bu">min</span>(region_hetero_dk.items(), key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>])</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Denmark:"</span>)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Most heterosexual region: </span><span class="sc">{</span>most_hetero_region_dk[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>most_hetero_region_dk[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%)"</span>)</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Most non-heterosexual region: </span><span class="sc">{</span>least_hetero_region_dk[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span><span class="dv">100</span> <span class="op">-</span> least_hetero_region_dk[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The most heterosexual region is Syddanmark which is the south of Denmark. <img src="media/1280px-Syddanmark_in_Denmark.png" class="img-fluid" alt="Syddanmark"> The regional capital is Vejle but Odense is the region’s largest city.</p>
<p>As for the most non-heterosexual region it is Nordjylland which is the north of Denmark. <img src="media/Nordjylland_in_Denmark.png" class="img-fluid" alt="Nordjylland"> The largest city in this region is Aalborg.</p>
</section>
</section>
<section id="hands-on-section" class="level1">
<h1>10.0 Hands on Section</h1>
<p>For the next section students will be tasked with working hands on with networks and performing the same data gathering as the researchers at KINMATRIX. Turn to the person next to you and on a piece of paper or a computer program like MSPaint draw their family network. Ask questions about family relation, age, gender and other demographic variables like education. Help each other and if you need an example look at the Pyvis visualizations.</p>
<p><strong>NOTE</strong> We can maybe add the website for students to build their own ego-centric networks. This is a maybe for now, but I think I can do it.</p>
</section>
<section id="citations" class="level1">
<h1>11.0 Citations</h1>
<p>Al-Taie, M. Z., &amp; Kadry, S. (2017). <em>Python for graph and network analysis</em>. Springer. https://doi.org/10.1007/978-3-319-53004-8</p>
<p>Brown, Kristen&nbsp; V. “The Coming Democratic Baby Bust.” The Atlantic Archive, 17 Feb.&nbsp;2025, archive.is/pKsPn#selection-723.0-723.16.</p>
<p>“Cook Partisan Voting Index.” Wikipedia, Wikimedia Foundation, 25 May 2025, en.wikipedia.org/wiki/Cook_Partisan_Voting_Index.</p>
<p>Cox, Kimberley. “Feminist Theory in Sociology: EBSCO.” EBSCO Information Services, Inc.&nbsp;| Www.Ebsco.Com, 2021, www.ebsco.com/research-starters/womens-studies-and-feminism/feminist-theory-sociology.</p>
<p>Dolan, Eric&nbsp; W. “Research Reveals Widening Gap in Fertility Desires between Republicans and Democrats.” PsyPost, 7 Oct.&nbsp;2024, www.psypost.org/research-reveals-widening-gap-in-fertility-desires-between-republicans-and-democrats/.</p>
<p>Graves, Jonathan, et al.&nbsp;“Network Analysis for Anthropolgy.” COMET, UBC, 2024, comet.arts.ubc.ca.</p>
<p>“Home.” Kinmatrix, 10 Apr.&nbsp;2025, kinmatrix.eu/.</p>
<p>Kinmatrix: A New Data Resource for Studies of Families …, www.demographic-research.org/volumes/vol51/25/51-25.pdf. Accessed 8 Aug.&nbsp;2025.</p>
<p>Krisch, Joshua&nbsp; A. “This Shocking Map Shows Republicans’ Most Powerful Political Weapon.” Fatherly, 8 July 2022, www.fatherly.com/health/republicans-have-more-children.</p>
<p>QuantEcon DataScience. (n.d.). <em>Social and economic networks</em>. https://datascience.quantecon.org/applications/networks.html</p>
<p>“Registered Unemployed Persons and Unemployment Rate by Voivodships, Subregions and Powiats. as of the End of November 2017.” Stat.Gov.Pl, Government of Poland, 22 Dec.&nbsp;2017, stat.gov.pl/en/topics/labour-market/registered-unemployment/registered-unemployed-persons-and-unemployment-rate-by-voivodships-subregions-and-powiats-as-of-the-end-of-november-2017,1,64.html.</p>
<p>Nomaguchi, K. M. &amp; Milkie, M. A. (2003). The costs and rewards of children: The effect of becoming a parent on adults’ lives. Journal of Marriage and Family, 65 (2), 356-374. link: http://www.jstor.org/stable/3600082?pq-origsite=summon</p>
<p>Sayama, H. (2024, April 30). <em>Generating random graphs</em>. In <em>Introduction to the modeling and analysis of complex systems</em>. Mathematics LibreTexts. https://math.libretexts.org/Bookshelves/Scientific_Computing_Simulations_and_Modeling/ Introduction_to_the_Modeling_and_Analysis_of_Complex_Systems_(Sayama)/15%3A_Basics_of_Networks/15.06%3A_Generating_Random_Graphs</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png"></a>.  <a rel="license" href="https://comet.arts.ubc.ca/pages/copyright.html">See details.</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 The prAxIs Project and UBC are located on the traditional, ancestral and unceded territory of the xʷməθkʷəy̓əm (Musqueam) and Sḵwx̱wú7mesh (Squamish) peoples.
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>