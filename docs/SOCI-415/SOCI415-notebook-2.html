<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-GB" xml:lang="en-GB"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-06-27">
<meta name="description" content="Using the KINMATRIX Dataset to explore network analysis for SOCI 415">

<title>Praxis - SOCI 415 Network Analysis - KINMATRIX Dataset</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../media/praxis-badge.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<meta name="keywords" content="economics, econometrics, R, data, machine learning, UBC, COMET, geog 374, econ 325, econ 326, learning, teaching, learn r, r help, help, tutorial, r tutorial for beginners,learning statistics with r, learn r programming, learn statistics, linear regression, r machine learning, learn machine learning, university of british columbia, british columbia, r programming for beginners, r language tutorial, r tutorial for beginners, economic data, econometrics tutoring, economics help for students, economics homework help, oer resources for teachers, open educational resources for teachers, educational resource, oer project, oer materials, oer resources, learn economics online, learn econometrics, teach yourself economics, teach yourself econometrics, econometrics basics for beginners">


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../media/praxis-badge-white.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Praxis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-get-startedplaceholder_1" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Get Started/Placeholder_1</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-get-startedplaceholder_1">    
        <li>
    <a class="dropdown-item" href="../../pages/quickstart.html" rel="" target="">
 <span class="dropdown-text">Quickstart Guide</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-courses" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Courses</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-courses">    
        <li>
    <a class="dropdown-item" href="../../pages/index/index_HIST-414.html" rel="" target="">
 <span class="dropdown-text">HIST-414</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../pages/index/index_AMNE-376.html" rel="" target="">
 <span class="dropdown-text">AMNE-376</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../pages/index/index_AMNE-170.html" rel="" target="">
 <span class="dropdown-text">AMNE-170</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../pages/index/index_SOCI415.html" rel="" target="">
 <span class="dropdown-text">SOCI-415</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../pages/index/index_SOCI217.html" rel="" target="">
 <span class="dropdown-text">SOCI-217</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../pages/index/index_SOCI280.html" rel="" target="">
 <span class="dropdown-text">SOCI-280</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../pages/index/index_ECON227.html" rel="" target="">
 <span class="dropdown-text">ECON-227</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../../pages/index/all.html" rel="" target="">
 <span class="dropdown-text">Browse All</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-topics" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Topics</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-topics">    
        <li>
    <a class="dropdown-item" href="../../pages/index/index_CNN.html" rel="" target="">
 <span class="dropdown-text">CNN</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../pages/index/index_convolution.html" rel="" target="">
 <span class="dropdown-text">Convolution</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-teach-with-praxis" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Teach With prAxIs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-teach-with-praxis">    
        <li>
    <a class="dropdown-item" href="../../pages/teaching_with_comet.html" rel="" target="">
 <span class="dropdown-text">Learn how to teach with prAxIs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../pages/using_comet.html" rel="" target="">
 <span class="dropdown-text">Using prAxIs in the Classroom</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-launch-praxis" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-play" role="img">
</i> 
 <span class="menu-text">Launch prAxIs</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-launch-praxis">    
        <li>
    <a class="dropdown-item" href="https://open.jupyter.ubc.ca/jupyter/hub/user-redirect/git-pull?repo=https%3A%2F%2Fgithub.com%2Fubcecon%2Fcomet-notebooks&amp;urlpath=lab%2Ftree%2Fcomet-notebooks%2F&amp;branch=main" rel="" target=""><i class="bi bi-cloud-check" role="img">
</i> 
 <span class="dropdown-text">Launch on JupyterOpen (with Data)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://open.jupyter.ubc.ca/jupyter/hub/user-redirect/git-pull?repo=https%3A%2F%2Fgithub.com%2Fubcecon%2Fcomet-project&amp;urlpath=lab%2Ftree%2Fcomet-project%2F&amp;branch=main" rel="" target=""><i class="bi bi-cloud-check" role="img">
</i> 
 <span class="dropdown-text">Launch on JupyterOpen (lite)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://ubc.syzygy.ca/jupyter/hub/user-redirect/git-pull?repo=https%3A%2F%2Fgithub.com%2Fubcecon%2Fcomet-project&amp;urlpath=lab%2Ftree%2Fcomet-project%2F&amp;branch=main" rel="" target=""><i class="bi bi-gear" role="img">
</i> 
 <span class="dropdown-text">Launch on Syzygy</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://colab.research.google.com/github/ubcecon/comet-notebooks/blob/main/" rel="" target=""><i class="bi bi-google" role="img">
</i> 
 <span class="dropdown-text">Launch on Colab</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ubcecon/comet-notebooks/archive/refs/heads/main.zip" rel="" target=""><i class="bi bi-cloud-download" role="img">
</i> 
 <span class="dropdown-text">Launch Locally</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="https://github.com/ubcecon/comet-open/archive/refs/heads/datasets.zip" rel="" target=""><i class="bi bi-clipboard-data" role="img">
</i> 
 <span class="dropdown-text">Project Datasets</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ubcecon/comet-open" rel="" target="">
 <span class="dropdown-text">Github Repository</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../#" rel="" target="">
 <span class="menu-text">|</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-about" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">About</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-about">    
        <li>
    <a class="dropdown-item" href="../../pages/team.html" rel="" target="">
 <span class="dropdown-text">prAxIs Team</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../pages/copyright.html" rel="" target="">
 <span class="dropdown-text">Copyright Information</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link active" data-scroll-target="#prerequisites">Prerequisites</a>
  <ul class="collapse">
  <li><a href="#kinmatrix-data-description" id="toc-kinmatrix-data-description" class="nav-link" data-scroll-target="#kinmatrix-data-description">KINMATRIX DATA DESCRIPTION</a>
  <ul class="collapse">
  <li><a href="#part-1.-broader-patterns-across-countries" id="toc-part-1.-broader-patterns-across-countries" class="nav-link" data-scroll-target="#part-1.-broader-patterns-across-countries">Part 1. Broader Patterns Across Countries</a></li>
  <li><a href="#across-countries-density-by-age-and-gender" id="toc-across-countries-density-by-age-and-gender" class="nav-link" data-scroll-target="#across-countries-density-by-age-and-gender">2. Across countries Density by Age and Gender</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#colored-family-networks" id="toc-colored-family-networks" class="nav-link" data-scroll-target="#colored-family-networks">3.0 Colored Family Networks</a>
  <ul class="collapse">
  <li><a href="#make-it-a-networkx-network" id="toc-make-it-a-networkx-network" class="nav-link" data-scroll-target="#make-it-a-networkx-network">3.1 Make it a NetworkX Network</a></li>
  <li><a href="#colored-visualization" id="toc-colored-visualization" class="nav-link" data-scroll-target="#colored-visualization">3.2 Colored Visualization</a></li>
  </ul></li>
  <li><a href="#in-class-discussion-from-the-family-structures-visualization" id="toc-in-class-discussion-from-the-family-structures-visualization" class="nav-link" data-scroll-target="#in-class-discussion-from-the-family-structures-visualization">3.3 In class discussion from the family structures visualization</a></li>
  <li><a href="#visualization-of-gender" id="toc-visualization-of-gender" class="nav-link" data-scroll-target="#visualization-of-gender">4.0 Visualization of Gender</a></li>
  <li><a href="#health-and-education-across-countries" id="toc-health-and-education-across-countries" class="nav-link" data-scroll-target="#health-and-education-across-countries">5.0 Health and Education Across Countries</a>
  <ul class="collapse">
  <li><a href="#health-italy-vs-denmark" id="toc-health-italy-vs-denmark" class="nav-link" data-scroll-target="#health-italy-vs-denmark">5.1 Health (Italy vs Denmark)</a></li>
  <li><a href="#education-usa-vs-germany" id="toc-education-usa-vs-germany" class="nav-link" data-scroll-target="#education-usa-vs-germany">5.2 Education USA vs Germany</a></li>
  </ul></li>
  <li><a href="#family-size-vs-politics-in-usa-and-poland" id="toc-family-size-vs-politics-in-usa-and-poland" class="nav-link" data-scroll-target="#family-size-vs-politics-in-usa-and-poland">6.0 Family size vs Politics in USA and Poland</a>
  <ul class="collapse">
  <li><a href="#republican-and-democrat-states" id="toc-republican-and-democrat-states" class="nav-link" data-scroll-target="#republican-and-democrat-states">6.1 Republican and Democrat States</a></li>
  <li><a href="#politics-for-poland" id="toc-politics-for-poland" class="nav-link" data-scroll-target="#politics-for-poland">6.2 Politics for Poland</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">6.3 Discussion</a></li>
  </ul></li>
  <li><a href="#general-case-for-interesting-findings" id="toc-general-case-for-interesting-findings" class="nav-link" data-scroll-target="#general-case-for-interesting-findings">7.0 General case for Interesting findings</a></li>
  <li><a href="#hands-on-section" id="toc-hands-on-section" class="nav-link" data-scroll-target="#hands-on-section">8.0 Hands on Section</a></li>
  <li><a href="#citations" id="toc-citations" class="nav-link" data-scroll-target="#citations">9.0 Citations</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/ubcecon/praxis-ubc/issues/new" class="toc-action">Report an issue</a></p></div></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="SOCI415-notebook-2.ipynb" download="SOCI415-notebook-2.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">SOCI 415 Network Analysis - KINMATRIX Dataset</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Python</div>
    <div class="quarto-category">network analysis</div>
  </div>
  </div>

<div>
  <div class="description">
    Using the KINMATRIX Dataset to explore network analysis for SOCI 415
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">27 June 2025</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="prerequisites" class="level1">
<h1>Prerequisites</h1>
<p>SOCI 415 Network Anlysis Notebook (Basically the COMET one up to section 4.0)</p>
<section id="kinmatrix-data-description" class="level2">
<h2 class="anchored" data-anchor-id="kinmatrix-data-description">KINMATRIX DATA DESCRIPTION</h2>
<p>The KINMATRIX dataset represents families as ego-centric networks of younger adults aged 25 to 35, collecting extensive data about both nuclear and extended kin across ten countries. The data include over 12,000 anchor respondents and more than 252,000 anchor-kin dyads, encompassing a wide range of relatives such as parents, siblings, grandparents, aunts, uncles, cousins, and complex kin (e.g., step- and half-relatives).</p>
<p>Anchor respondents refer to the ones directly sampled from. These anchors filled out the survey about their families and kin meaning that they will always be at the center of these family networks.</p>
<p>The countries in the dataset are the Uk, Germany, Poland, Italy, Sweeden, Denmark, Finalnd, Norway, the Netherlands and the USA.</p>
<section id="part-1.-broader-patterns-across-countries" class="level3">
<h3 class="anchored" data-anchor-id="part-1.-broader-patterns-across-countries">Part 1. Broader Patterns Across Countries</h3>
<p>We will begin by looking at broader patterns across different countries. First we import all the necessary Python libraries for data manipulation, network analysis, and visualization. This will allow us to get results for each country.</p>
<p>Import libraries and the data</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Import libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> mpatches </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> ctx</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.axes_grid1.inset_locator <span class="im">import</span> inset_axes</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> community <span class="im">as</span> community_louvain</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyvis.network <span class="im">import</span> Network</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.cm <span class="im">as</span> cm</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="vs">r'data\ZA8825_v1-0-0.dta'</span> <span class="co">#change here once we know how to present the notebook, or change here for a different path</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_stata(file_path)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Print country codes</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'anc_cou'</span>].unique())</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">#Make a list of countries</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>country_dfs <span class="op">=</span> {}</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country <span class="kw">in</span> df[<span class="st">'anc_cou'</span>].unique():</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    country_dfs[country] <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> country]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="make-it-a-network" class="level4">
<h4 class="anchored" data-anchor-id="make-it-a-network">1.1 Make it a Network</h4>
<p>Here, we systematically construct a kinship network for each country in the dataset using the NetworkX python package. For each country, we filter the data, create a new graph, and add nodes representing anchor individuals and their kin. Then we draw edges between the nodes. Finally, we print out the number of nodes and edges for each country’s network, providing a quick overview of network size and complexity across the dataset.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Set up a dictionary of countries</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>country_map <span class="op">=</span> {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'UK'</span>: <span class="st">'1. UK'</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Germany'</span>: <span class="st">'2. Germany'</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Poland'</span>: <span class="st">'3. Poland'</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Italy'</span>: <span class="st">'4. Italy'</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sweden'</span>: <span class="st">'5. Sweden'</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Denmark'</span>: <span class="st">'6. Denmark'</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Finland'</span>: <span class="st">'7. Finland'</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Norway'</span>: <span class="st">'8. Norway'</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Netherlands'</span>: <span class="st">'9. Netherlands'</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'USA'</span>: <span class="st">'10. USA'</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>graphs <span class="op">=</span> {}</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country, anc_cou_value <span class="kw">in</span> country_map.items():</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    filtered_df <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> anc_cou_value]</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    G_filtered <span class="op">=</span> nx.Graph()</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add anchor nodes</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        G_filtered.add_node(row[<span class="st">'anc_id'</span>], </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>                            country<span class="op">=</span>row[<span class="st">'anc_cou'</span>],</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>                            age<span class="op">=</span>row[<span class="st">'anc_age'</span>],</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>                            gender<span class="op">=</span>row[<span class="st">'anc_gnd'</span>])</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add kin nodes and edges</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        kin_node <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'anc_id'</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>row<span class="sc">.</span>get(<span class="st">'kin_nam'</span>, <span class="st">'unknown'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>        G_filtered.add_node(kin_node, relation<span class="op">=</span>row.get(<span class="st">'kin_rel1'</span>, <span class="va">None</span>))</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>        G_filtered.add_edge(row[<span class="st">'anc_id'</span>], kin_node, relation<span class="op">=</span>row.get(<span class="st">'kin_rel1'</span>, <span class="va">None</span>))</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store the graph and anchor nodes</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    anchor_nodes <span class="op">=</span> <span class="bu">list</span>(filtered_df[<span class="st">'anc_id'</span>].unique())</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    graphs[country] <span class="op">=</span> {</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">'graph'</span>: G_filtered,</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">'anchor_nodes'</span>: anchor_nodes</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>country<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Number of nodes: </span><span class="sc">{</span>G_filtered<span class="sc">.</span>number_of_nodes()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Number of edges: </span><span class="sc">{</span>G_filtered<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="finding-summary-statistics-across-the-countries" class="level4">
<h4 class="anchored" data-anchor-id="finding-summary-statistics-across-the-countries">1.2 Finding summary statistics across the countries</h4>
<p>This block computes and displays key network statistics for each country’s kinship network. We calculate the network density (how interconnected the network is), the mean degree (average number of connections per node), and the gender distribution among anchor nodes.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country, data <span class="kw">in</span> graphs.items():</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    G <span class="op">=</span> data[<span class="st">'graph'</span>]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    anchor_nodes <span class="op">=</span> data[<span class="st">'anchor_nodes'</span>]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Density</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    density <span class="op">=</span> nx.density(G)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mean degree</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    degrees <span class="op">=</span> [deg <span class="cf">for</span> node, deg <span class="kw">in</span> G.degree()]</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    mean_degree <span class="op">=</span> np.mean(degrees)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Gender distribution</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    female_count <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> n <span class="kw">in</span> anchor_nodes <span class="cf">if</span> G.nodes[n].get(<span class="st">'gender'</span>) <span class="op">==</span> <span class="st">'2. Female'</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    male_count <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> n <span class="kw">in</span> anchor_nodes <span class="cf">if</span> G.nodes[n].get(<span class="st">'gender'</span>) <span class="op">==</span> <span class="st">'1. Male'</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    other_count <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> n <span class="kw">in</span> anchor_nodes <span class="cf">if</span> G.nodes[n].get(<span class="st">'gender'</span>) <span class="op">==</span> <span class="st">'3. Other gender or no gender'</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Degree centrality (mean and top 5)</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    deg_centrality <span class="op">=</span> nx.degree_centrality(G)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    mean_deg_centrality <span class="op">=</span> np.mean(<span class="bu">list</span>(deg_centrality.values()))</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    top5_deg_centrality <span class="op">=</span> <span class="bu">sorted</span>(deg_centrality.items(), key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)[:<span class="dv">5</span>]</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Show our findings</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>country<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Density: </span><span class="sc">{</span>density<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Mean degree: </span><span class="sc">{</span>mean_degree<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Female nodes: </span><span class="sc">{</span>female_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Male nodes: </span><span class="sc">{</span>male_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Other/No gender nodes: </span><span class="sc">{</span>other_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Mean degree centrality: </span><span class="sc">{</span>mean_deg_centrality<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Top 5 degree centrality nodes: </span><span class="sc">{</span>top5_deg_centrality<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pyvis-visualization-for-norway-2500-nodes." class="level4">
<h4 class="anchored" data-anchor-id="pyvis-visualization-for-norway-2500-nodes.">1.3 Pyvis Visualization for Norway (2500 nodes).</h4>
<p>Here we have enough information to do a visualization of our findings. We will use the Pyvis package. The code loads the NetworkX graph into Pyvis, cleans any missing attribute values, and provides interactive controls for exploring the network.</p>
<p>Note (not for final version) Issues: I have also tried for Poland (35,000 nodes) - Very Laggy, but can be ran will need more guidance here as to how to go along with this in the class enviorment. - Tried using an external tool like Gephi, but did not really help. Just too laggy to display properly. - Seems that we need to use a small network of ~2000 nodes otherwise the display does not work properly</p>
<p>Much easier for a smaller one like Norway. My PC is also significantly better than most school laptops so we will need some kind of solution for displaying these visualizations.</p>
<p>Test for Labels - Working</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve the Norway Network</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>G_Norway <span class="op">=</span> graphs[<span class="st">'Norway'</span>][<span class="st">'graph'</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>anchor_nodes_norway <span class="op">=</span> graphs[<span class="st">'Norway'</span>][<span class="st">'anchor_nodes'</span>]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean None attributes</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n, attrs <span class="kw">in</span> G_Norway.nodes(data<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k, v <span class="kw">in</span> attrs.items():</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> v <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>            G_Norway.nodes[n][k] <span class="op">=</span> <span class="st">"NA"</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> u, v, attrs <span class="kw">in</span> G_Norway.edges(data<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k, val <span class="kw">in</span> attrs.items():</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> val <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            G_Norway.edges[u, v][k] <span class="op">=</span> <span class="st">"NA"</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new Pyvis Network</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>net <span class="op">=</span> Network(height<span class="op">=</span><span class="st">'800px'</span>, width<span class="op">=</span><span class="st">'100%'</span>, notebook<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create simple anchor mapping</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>anchor_to_label <span class="op">=</span> {}</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, anchor <span class="kw">in</span> <span class="bu">enumerate</span>(anchor_nodes_norway, <span class="dv">1</span>):</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    anchor_to_label[anchor] <span class="op">=</span> <span class="ss">f"Anchor-</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Add nodes manually </span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node <span class="kw">in</span> G_Norway.nodes():</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node <span class="kw">in</span> anchor_nodes_norway:</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Anchor nodes with labels</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        net.add_node(node, label<span class="op">=</span>anchor_to_label[node], color<span class="op">=</span><span class="st">'#4ECDC4'</span>, size<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Kin nodes</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        net.add_node(node, color<span class="op">=</span><span class="st">'#4ECDC4'</span>, size<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Add edges manually</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> u, v <span class="kw">in</span> G_Norway.edges():</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    net.add_edge(u, v)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node <span class="kw">in</span> net.nodes:</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node[<span class="st">'id'</span>] <span class="kw">not</span> <span class="kw">in</span> anchor_nodes_norway:</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        node[<span class="st">'label'</span>] <span class="op">=</span> <span class="st">''</span> </span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Minimal settings</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>net.show(<span class="st">'norway_updated_network.html'</span>)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"All blue nodes version saved as 'norway_all_blue_nodes.html'"</span>)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total nodes: </span><span class="sc">{</span>G_Norway<span class="sc">.</span>number_of_nodes()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total edges: </span><span class="sc">{</span>G_Norway<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Anchor nodes labeled: </span><span class="sc">{</span><span class="bu">len</span>(anchor_nodes_norway)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="across-countries-density-by-age-and-gender" class="level3">
<h3 class="anchored" data-anchor-id="across-countries-density-by-age-and-gender">2. Across countries Density by Age and Gender</h3>
<p>This code block constructs kinship network graphs for each country in the KINMATRIX dataset and then analyzes how the density of family networks varies by age and gender within each country. This analysis helps reveal patterns and differences in family network structure across demographic groups and between countries, providing insight into how kinship connectivity varies by age and gender in different countries.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>graphs <span class="op">=</span> {}</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country, anc_cou_value <span class="kw">in</span> country_map.items():</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    filtered_df <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> anc_cou_value]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    G_filtered <span class="op">=</span> nx.Graph()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add anchor nodes</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        G_filtered.add_node(row[<span class="st">'anc_id'</span>], </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                            country<span class="op">=</span>row[<span class="st">'anc_cou'</span>],</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                            age<span class="op">=</span>row[<span class="st">'anc_age'</span>],</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                            gender<span class="op">=</span>row[<span class="st">'anc_gnd'</span>])</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add kin nodes and edges</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        kin_node <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'anc_id'</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>row<span class="sc">.</span>get(<span class="st">'kin_nam'</span>, <span class="st">'unknown'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        G_filtered.add_node(kin_node, relation<span class="op">=</span>row.get(<span class="st">'kin_rel1'</span>, <span class="va">None</span>))</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        G_filtered.add_edge(row[<span class="st">'anc_id'</span>], kin_node, relation<span class="op">=</span>row.get(<span class="st">'kin_rel1'</span>, <span class="va">None</span>))</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store only the graph</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    graphs[country] <span class="op">=</span> G_filtered</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_family_density_by_demographics(G_filtered):</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    density_by_age <span class="op">=</span> {}</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    density_by_gender <span class="op">=</span> {}</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> anchor_id <span class="kw">in</span> [n <span class="cf">for</span> n <span class="kw">in</span> G_filtered.nodes() <span class="cf">if</span> <span class="st">'anc_'</span> <span class="kw">in</span> <span class="bu">str</span>(n) <span class="kw">or</span> <span class="bu">isinstance</span>(n, (<span class="bu">int</span>, <span class="bu">float</span>))]:</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>        ego_net <span class="op">=</span> nx.ego_graph(G_filtered, anchor_id)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>        density <span class="op">=</span> nx.density(ego_net)</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>        age <span class="op">=</span> G_filtered.nodes[anchor_id].get(<span class="st">'age'</span>)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        gender <span class="op">=</span> G_filtered.nodes[anchor_id].get(<span class="st">'gender'</span>)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> age:</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>            density_by_age.setdefault(age <span class="op">//</span> <span class="dv">10</span> <span class="op">*</span> <span class="dv">10</span>, []).append(density)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> gender:</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>            density_by_gender.setdefault(gender, []).append(density)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Density by Age Group:"</span>)</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> age_group, densities <span class="kw">in</span> <span class="bu">sorted</span>(density_by_age.items()):</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Age </span><span class="sc">{</span>age_group<span class="sc">}</span><span class="ss">s: Mean Density = </span><span class="sc">{</span>np<span class="sc">.</span>mean(densities)<span class="sc">:.4f}</span><span class="ss">, Count = </span><span class="sc">{</span><span class="bu">len</span>(densities)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Density by Gender:"</span>)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> gender, densities <span class="kw">in</span> density_by_gender.items():</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Gender </span><span class="sc">{</span>gender<span class="sc">}</span><span class="ss">: Mean Density = </span><span class="sc">{</span>np<span class="sc">.</span>mean(densities)<span class="sc">:.4f}</span><span class="ss">, Count = </span><span class="sc">{</span><span class="bu">len</span>(densities)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through all countries</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country <span class="kw">in</span> country_map:</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> country <span class="kw">in</span> graphs:</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">--- </span><span class="sc">{</span>country<span class="sc">}</span><span class="ss"> ---"</span>)</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>        analyze_family_density_by_demographics(graphs[country])</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"No graph available for </span><span class="sc">{</span>country<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="finding-a-pattern" class="level4">
<h4 class="anchored" data-anchor-id="finding-a-pattern">2.1 Finding a Pattern</h4>
<p>Interactive part: Have a look at our findings from sections 1 and 2, based on frameworks taught in class explain a reason for them.</p>
<p>Some example findings are listed below, but look for your own and try to link it to a concept from class.</p>
<ol type="1">
<li>In all countries, individuals in their 30s higher mean density than those in their 20s (Germany: 20s = 0.1355, 30s = 0.1468, USA: 20s = 0.1058, 30s = 0.1065)</li>
<li>Men tend to have a higher mean density than women (Poland: Male = 0.1343, Female = 0.1130)</li>
<li>The USA has the lowest overall density but has the largest sample size? What are the reasons behind this, immigration and disconection from family, or maybe a smaller cultural focus on family?</li>
</ol>
<p>Frameworks (from syllabus 2019 can change here): - Social Exchange framework - Symbolic Interaction framework - Life Course Developmental framework - Family Stress Theory - Systems framework - Conflict and Critical Theories framework - Feminist framework - Ecological framework - Future of family theory</p>
</section>
</section>
</section>
</section>
<section id="colored-family-networks" class="level1">
<h1>3.0 Colored Family Networks</h1>
<p>For the next part of the notebook I have decided to focus on the Pomeranian (Pomorskie in Polish) Voivodeship It is in north-western Poland with the largest city being Gdańsk. <img src="media/pomorskie.png" class="img-fluid" alt="Location of Pomerania"> It has a population of 2.24 million as of 2019.</p>
<p>Note: This is mostly for computational and display reasons so far as the network is much smaller than a full country.</p>
<p>The code below will filter our data for Poland and the Pomorskie region to have a smaller subset.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[(df[<span class="st">'anc_cou'</span>] <span class="op">==</span> <span class="st">'3. Poland'</span>) <span class="op">&amp;</span> (df[<span class="st">'anc_regpl'</span>] <span class="op">==</span> <span class="st">'11. Pomorskie'</span>)] <span class="co">#Filter anc_cou to be Poland and anc_regpl to be Pomorskie</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#print(filtered_df.head())</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of rows after filtering: </span><span class="sc">{</span><span class="bu">len</span>(filtered_df)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="make-it-a-networkx-network" class="level3">
<h3 class="anchored" data-anchor-id="make-it-a-networkx-network">3.1 Make it a NetworkX Network</h3>
<p>The code below makes a new NetworkX relationship with anchors (highest level of a family ancestor) and their kin. The output will be the total number of nodes and edges in the Network.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>G_filtered <span class="op">=</span> nx.Graph()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add anchor nodes for filtered data</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    G_filtered.add_node(row[<span class="st">'anc_id'</span>], </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                        country<span class="op">=</span>row[<span class="st">'anc_cou'</span>],</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                        age<span class="op">=</span>row[<span class="st">'anc_age'</span>],</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                        gender<span class="op">=</span>row[<span class="st">'anc_gnd'</span>])</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add kin nodes and edges </span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    kin_node <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'anc_id'</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>row<span class="sc">.</span>get(<span class="st">'kin_nam'</span>, <span class="st">'unknown'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    G_filtered.add_node(kin_node, relation<span class="op">=</span>row.get(<span class="st">'kin_rel1'</span>, <span class="va">None</span>))</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    G_filtered.add_edge(row[<span class="st">'anc_id'</span>], kin_node, relation<span class="op">=</span>row.get(<span class="st">'kin_rel1'</span>, <span class="va">None</span>))</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Define anchor_nodes</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>anchor_nodes <span class="op">=</span> <span class="bu">list</span>(filtered_df[<span class="st">'anc_id'</span>].unique())</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of nodes: </span><span class="sc">{</span>G_filtered<span class="sc">.</span>number_of_nodes()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of edges: </span><span class="sc">{</span>G_filtered<span class="sc">.</span>number_of_edges()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="colored-visualization" class="level3">
<h3 class="anchored" data-anchor-id="colored-visualization">3.2 Colored Visualization</h3>
<p>We will make a Pyvis visualization with coloring for family structures.</p>
<p>Label test for Family Relations - WORKS</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define color map for main relationship types</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>relationship_colors <span class="op">=</span> {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'father'</span>: <span class="st">'blue'</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mother'</span>: <span class="st">'pink'</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'brother'</span>: <span class="st">'green'</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sister'</span>: <span class="st">'purple'</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'aunt'</span>: <span class="st">'orange'</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'uncle'</span>: <span class="st">'brown'</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'cousin'</span>: <span class="st">'teal'</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grandfather'</span>: <span class="st">'navy'</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grandmother'</span>: <span class="st">'magenta'</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'son'</span>: <span class="st">'red'</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'daughter'</span>: <span class="st">'yellow'</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'nephew'</span>: <span class="st">'lightgreen'</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'niece'</span>: <span class="st">'lightpink'</span>,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stepfather'</span>: <span class="st">'slateblue'</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stepmother'</span>: <span class="st">'plum'</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'other'</span>: <span class="st">'gray'</span>,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_relation(rel_str):</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Extracts the main relationship keyword from the string."""</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(rel_str, <span class="bu">str</span>):</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'other'</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    rel_str <span class="op">=</span> rel_str.lower()</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fixed regex pattern with raw string</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    rel_str <span class="op">=</span> re.sub(<span class="vs">r'^\d+\.\s*'</span>, <span class="st">''</span>, rel_str)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key <span class="kw">in</span> relationship_colors.keys():</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> key <span class="kw">in</span> rel_str:</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> key</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'other'</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new Pyvis Network</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>net <span class="op">=</span> Network(height<span class="op">=</span><span class="st">'800px'</span>, width<span class="op">=</span><span class="st">'100%'</span>, notebook<span class="op">=</span><span class="va">True</span>, bgcolor<span class="op">=</span><span class="st">'#ffffff'</span>, font_color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Create anchor mapping for cleaner labels</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>anchor_to_label <span class="op">=</span> {}</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>anchor_nodes <span class="op">=</span> <span class="bu">list</span>(filtered_df[<span class="st">'anc_id'</span>].unique())</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, anchor <span class="kw">in</span> <span class="bu">enumerate</span>(anchor_nodes, <span class="dv">1</span>):</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    anchor_to_label[anchor] <span class="op">=</span> <span class="ss">f"Anchor-</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Add anchor nodes (individuals) with clean labels</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    net.add_node(row[<span class="st">'anc_id'</span>],</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>                 label<span class="op">=</span>anchor_to_label[row[<span class="st">'anc_id'</span>]],  <span class="co"># Clean "Anchor-X" label</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span><span class="st">'lightblue'</span>,  </span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>                 size<span class="op">=</span><span class="dv">15</span>,  <span class="co"># Larger size for anchor nodes</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>                 title<span class="op">=</span><span class="ss">f"Age: </span><span class="sc">{</span>row[<span class="st">'anc_age'</span>]<span class="sc">}</span><span class="ss">&lt;br&gt;Gender: </span><span class="sc">{</span>row[<span class="st">'anc_gnd'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Add kin nodes and edges with relationship-based coloring</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>    relation_raw <span class="op">=</span> row.get(<span class="st">'kin_typ'</span>, <span class="va">None</span>)  </span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>    relation <span class="op">=</span> extract_relation(relation_raw)</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> relationship_colors.get(relation, <span class="st">'gray'</span>)</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    kin_node <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'anc_id'</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>row<span class="sc">.</span>get(<span class="st">'kin_nam'</span>, <span class="st">'unknown'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add kin node with temporary label (will be removed later)</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>    net.add_node(kin_node,</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>                 label<span class="op">=</span><span class="bu">str</span>(row.get(<span class="st">'kin_nam'</span>, <span class="st">'unknown'</span>)),  <span class="co"># Temporary label</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span>color,</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>                 size<span class="op">=</span><span class="dv">8</span>,  <span class="co"># Smaller size for kin nodes</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>                 title<span class="op">=</span><span class="ss">f"Relation: </span><span class="sc">{</span>relation_raw<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># Hover info stays</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>    net.add_edge(row[<span class="st">'anc_id'</span>], kin_node, title<span class="op">=</span>relation_raw)</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node <span class="kw">in</span> net.nodes:</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node[<span class="st">'id'</span>] <span class="kw">not</span> <span class="kw">in</span> anchor_nodes:</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>        node[<span class="st">'label'</span>] <span class="op">=</span> <span class="st">''</span>  <span class="co"># Empty label for kin nodes - no labels when zoomed in</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>net.show_buttons()</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>net.show(<span class="st">'family_structure_network.html'</span>)</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a><span class="co">#print(f"Network created with:")</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a><span class="co">#print(f"- Total nodes: {len(net.nodes)}")</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a><span class="co">#print(f"- Total edges: {len(net.edges)}")</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a><span class="co">#print(f"- Anchor nodes labeled: {len(anchor_nodes)}")</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a><span class="co">#print(f"- Kin nodes: {len(net.nodes) - len(anchor_nodes)} (no labels when zoomed in)")</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>patches <span class="op">=</span> [mpatches.Patch(color<span class="op">=</span>color, label<span class="op">=</span>relation) <span class="cf">for</span> relation, color <span class="kw">in</span> relationship_colors.items()]</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the legend of family relations</span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>ax.legend(handles<span class="op">=</span>patches, loc<span class="op">=</span><span class="st">'center'</span>, frameon<span class="op">=</span><span class="va">False</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">'off'</span>)</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="in-class-discussion-from-the-family-structures-visualization" class="level1">
<h1>3.3 In class discussion from the family structures visualization</h1>
<p>Students will look at the visualization on their browser and in small groups of 3-4 will discuss how the findings from this dataset can be linked to theories in studied frameworks from the course. After about 10 minuites of discussion groups will state their most interesting or best interpretation that they found, some possible examples are listed below for the Social Exchange Framework, the Feminist Framework and Conflict Theory.</p>
<p><strong>Social Exchange Framework</strong> Family ties exist as a exchange of resources so each edge between the nodes means there is some form of exchange, this could range from such as support, care, or obligation. The color-coding of relationships (e.g., blue for father, pink for mother) visually distinguishes different types of exchanges, allowing analysis of who is connected to whom and what kinds of resources or support might flow along those ties. For example, a node with many blue (father) and pink (mother) connections might receive more parental support, while green (brother) or purple (sister) ties could represent sibling exchanges.</p>
<p><strong>Feminist Framework</strong></p>
<p>The feminist framework examines gender roles, power imbalances, and the ways traditional family structures reinforce gender inequality. For example we can link the centrality or marginalization of female roles (e.g., mothers, daughters, sisters) compared to male roles (fathers, sons, brothers) to patriarchical structures of modern western society.</p>
<p><strong>Conflict Theory</strong></p>
<p>Conflict theory references the family as a unit by and through which power is negotiated. This occurs within family structures, where power is concentrated within the parental unit and children are typically subordinate. Power is also exercised in determining the structure of families themselves, and the access an individual is given to certain things like education, inheritance, and wealth.</p>
<p>By thinking about familial networks from a conflict theoretical standpoint, questions around power arise. Some of these questions might inquire into the relative power of different families, or into the relative power of members within families. Perhaps in a given geographic area, where many families are similarly positioned, power has less to do with economic standing and is more related to social trust.</p>
<p>While you look through the family structures visualization, consider how conflict theory and power might be influencing the results.</p>
<p>Note: Some of these can be removed in the final part</p>
</section>
<section id="visualization-of-gender" class="level1">
<h1>4.0 Visualization of Gender</h1>
<p>Below the code will make an interactive Pyvis visualization with dots colored for gender. This can be used to discuss gender compositions of families and feminist theory. We can see if our network supports the theory of power imbalances and reflect the ways traditional family structures reinforce gender inequality.</p>
<p>Labels Test</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Comprehensive relationship-to-gender mapping</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>GENDER_FROM_RELATIONSHIP <span class="op">=</span> {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Male relationships</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'father'</span>: <span class="st">'male'</span>, <span class="st">'dad'</span>: <span class="st">'male'</span>, <span class="st">'daddy'</span>: <span class="st">'male'</span>, <span class="st">'papa'</span>: <span class="st">'male'</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'son'</span>: <span class="st">'male'</span>, <span class="st">'brother'</span>: <span class="st">'male'</span>, <span class="st">'grandfather'</span>: <span class="st">'male'</span>, <span class="st">'grandpa'</span>: <span class="st">'male'</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'uncle'</span>: <span class="st">'male'</span>, <span class="st">'nephew'</span>: <span class="st">'male'</span>, <span class="st">'husband'</span>: <span class="st">'male'</span>, <span class="st">'boyfriend'</span>: <span class="st">'male'</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stepfather'</span>: <span class="st">'male'</span>, <span class="st">'stepson'</span>: <span class="st">'male'</span>, <span class="st">'stepbrother'</span>: <span class="st">'male'</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'father-in-law'</span>: <span class="st">'male'</span>, <span class="st">'son-in-law'</span>: <span class="st">'male'</span>, <span class="st">'brother-in-law'</span>: <span class="st">'male'</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'godfather'</span>: <span class="st">'male'</span>, <span class="st">'godson'</span>: <span class="st">'male'</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Female relationships</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mother'</span>: <span class="st">'female'</span>, <span class="st">'mom'</span>: <span class="st">'female'</span>, <span class="st">'mommy'</span>: <span class="st">'female'</span>, <span class="st">'mama'</span>: <span class="st">'female'</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'daughter'</span>: <span class="st">'female'</span>, <span class="st">'sister'</span>: <span class="st">'female'</span>, <span class="st">'grandmother'</span>: <span class="st">'female'</span>, <span class="st">'grandma'</span>: <span class="st">'female'</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'aunt'</span>: <span class="st">'female'</span>, <span class="st">'niece'</span>: <span class="st">'female'</span>, <span class="st">'wife'</span>: <span class="st">'female'</span>, <span class="st">'girlfriend'</span>: <span class="st">'female'</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stepmother'</span>: <span class="st">'female'</span>, <span class="st">'stepdaughter'</span>: <span class="st">'female'</span>, <span class="st">'stepsister'</span>: <span class="st">'female'</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mother-in-law'</span>: <span class="st">'female'</span>, <span class="st">'daughter-in-law'</span>: <span class="st">'female'</span>, <span class="st">'sister-in-law'</span>: <span class="st">'female'</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'godmother'</span>: <span class="st">'female'</span>, <span class="st">'goddaughter'</span>: <span class="st">'female'</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_node_gender_and_color(row, is_anchor<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">    Determine gender and color for any node (anchor or kin)</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns: (gender_string, color_string)</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Gender color mapping</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> {<span class="st">'male'</span>: <span class="st">'blue'</span>, <span class="st">'female'</span>: <span class="st">'pink'</span>, <span class="st">'unknown'</span>: <span class="st">'lightgray'</span>}</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> is_anchor:</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For anchor nodes - check the gender field more thoroughly</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        gender_field <span class="op">=</span> <span class="bu">str</span>(row.get(<span class="st">'anc_gnd'</span>, <span class="st">''</span>)).lower().strip()</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Handle various gender field formats</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> gender_field <span class="kw">in</span> [<span class="st">'m'</span>, <span class="st">'male'</span>, <span class="st">'man'</span>, <span class="st">'1. male'</span>, <span class="st">'1.male'</span>, <span class="st">'male.'</span>, <span class="st">'1'</span>]:</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'male'</span>, colors[<span class="st">'male'</span>]</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> gender_field <span class="kw">in</span> [<span class="st">'f'</span>, <span class="st">'female'</span>, <span class="st">'woman'</span>, <span class="st">'2. female'</span>, <span class="st">'2.female'</span>, <span class="st">'female.'</span>, <span class="st">'2'</span>]:</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'female'</span>, colors[<span class="st">'female'</span>]</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">'male'</span> <span class="kw">in</span> gender_field <span class="kw">and</span> <span class="st">'female'</span> <span class="kw">not</span> <span class="kw">in</span> gender_field:</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'male'</span>, colors[<span class="st">'male'</span>]</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">'female'</span> <span class="kw">in</span> gender_field:</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'female'</span>, colors[<span class="st">'female'</span>]</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For kin nodes</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>        gender_field <span class="op">=</span> <span class="bu">str</span>(row.get(<span class="st">'kin_gnd'</span>, <span class="st">''</span>)).lower().strip()</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Handle various gender field formats for kin nodes too</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> gender_field <span class="kw">in</span> [<span class="st">'m'</span>, <span class="st">'male'</span>, <span class="st">'man'</span>, <span class="st">'1. male'</span>, <span class="st">'1.male'</span>, <span class="st">'male.'</span>, <span class="st">'1'</span>]:</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'male'</span>, colors[<span class="st">'male'</span>]</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> gender_field <span class="kw">in</span> [<span class="st">'f'</span>, <span class="st">'female'</span>, <span class="st">'woman'</span>, <span class="st">'2. female'</span>, <span class="st">'2.female'</span>, <span class="st">'female.'</span>, <span class="st">'2'</span>]:</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'female'</span>, colors[<span class="st">'female'</span>]</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">'male'</span> <span class="kw">in</span> gender_field <span class="kw">and</span> <span class="st">'female'</span> <span class="kw">not</span> <span class="kw">in</span> gender_field:</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'male'</span>, colors[<span class="st">'male'</span>]</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">'female'</span> <span class="kw">in</span> gender_field:</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'female'</span>, colors[<span class="st">'female'</span>]</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get gender from relationship if direct gender field doesn't work</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>        relationship <span class="op">=</span> <span class="bu">str</span>(row.get(<span class="st">'kin_typ'</span>, <span class="st">''</span>)).lower().strip()</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Clean the relationship string</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>        relationship <span class="op">=</span> re.sub(<span class="vs">r'^(my|the|a|an)\s+'</span>, <span class="st">''</span>, relationship)</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check for relationship matches</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> rel_key, gender <span class="kw">in</span> GENDER_FROM_RELATIONSHIP.items():</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rel_key <span class="kw">in</span> relationship <span class="kw">or</span> relationship <span class="kw">in</span> rel_key:</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> gender, colors[gender]</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'unknown'</span>, colors[<span class="st">'unknown'</span>]</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize your network</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>net <span class="op">=</span> Network(height<span class="op">=</span><span class="st">"600px"</span>, width<span class="op">=</span><span class="st">"100%"</span>, bgcolor<span class="op">=</span><span class="st">"#ffffff"</span>, font_color<span class="op">=</span><span class="st">"black"</span>, notebook<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Create anchor mapping for cleaner labels</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>anchor_to_label <span class="op">=</span> {}</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>anchor_nodes <span class="op">=</span> <span class="bu">list</span>(filtered_df[<span class="st">'anc_id'</span>].unique())</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, anchor <span class="kw">in</span> <span class="bu">enumerate</span>(anchor_nodes, <span class="dv">1</span>):</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>    anchor_to_label[anchor] <span class="op">=</span> <span class="ss">f"Anchor-</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Add anchor nodes with gender-based coloring and only gender in hover</span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Adding anchor nodes with gender colors..."</span>)</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>    gender, color <span class="op">=</span> get_node_gender_and_color(row, is_anchor<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>    net.add_node(row[<span class="st">'anc_id'</span>],</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>                 label<span class="op">=</span>anchor_to_label[row[<span class="st">'anc_id'</span>]],  <span class="co"># Clean "Anchor-X" label</span></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span>color,</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>                 size<span class="op">=</span><span class="dv">15</span>,  <span class="co"># Larger size for anchor nodes</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>                 title<span class="op">=</span><span class="ss">f"Gender: </span><span class="sc">{</span>gender<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># Only gender in hover</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Add kin nodes and edges with gender-based coloring</span></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Adding kin nodes with gender colors..."</span>)</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> filtered_df.iterrows():</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>    gender, color <span class="op">=</span> get_node_gender_and_color(row, is_anchor<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>    kin_node <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'anc_id'</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>row<span class="sc">.</span>get(<span class="st">'kin_nam'</span>, <span class="st">'unknown'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>    net.add_node(kin_node,</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>                 label<span class="op">=</span><span class="st">''</span>,  <span class="co"># No label for kin nodes</span></span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span>color,</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>                 size<span class="op">=</span><span class="dv">8</span>,  <span class="co"># Smaller size for kin nodes</span></span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>                 title<span class="op">=</span><span class="ss">f"Gender: </span><span class="sc">{</span>gender<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># Only gender in hover</span></span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add edge between anchor and kin (no title/hover info on edges)</span></span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>    net.add_edge(row[<span class="st">'anc_id'</span>], kin_node)</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove labels from kin nodes (keep only anchor node labels)</span></span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node <span class="kw">in</span> net.nodes:</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node[<span class="st">'id'</span>] <span class="kw">not</span> <span class="kw">in</span> anchor_nodes:</span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>        node[<span class="st">'label'</span>] <span class="op">=</span> <span class="st">''</span>  <span class="co"># Empty label for kin nodes</span></span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure and display network</span></span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>net.show_buttons(filter_<span class="op">=</span>[<span class="st">'physics'</span>])</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>net.show(<span class="st">'gender_only_kinship_network_fixed.html'</span>)</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Network created successfully with gender-only hover info!"</span>)</span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary of node colors</span></span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>node_colors <span class="op">=</span> {}</span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node <span class="kw">in</span> net.nodes:</span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> node[<span class="st">'color'</span>]</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>    node_colors[color] <span class="op">=</span> node_colors.get(color, <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Node color summary:"</span>)</span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a>color_to_gender <span class="op">=</span> {<span class="st">'blue'</span>: <span class="st">'Male'</span>, <span class="st">'pink'</span>: <span class="st">'Female'</span>, <span class="st">'lightgray'</span>: <span class="st">'Unknown'</span>}</span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> color, count <span class="kw">in</span> node_colors.items():</span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>    gender_name <span class="op">=</span> color_to_gender.get(color, color)</span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>gender_name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss"> nodes"</span>)</span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Network summary:"</span>)</span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"- Total nodes: </span><span class="sc">{</span><span class="bu">len</span>(net.nodes)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"- Total edges: </span><span class="sc">{</span><span class="bu">len</span>(net.edges)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"- Anchor nodes labeled: </span><span class="sc">{</span><span class="bu">len</span>(anchor_nodes)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"- Kin nodes: </span><span class="sc">{</span><span class="bu">len</span>(net.nodes) <span class="op">-</span> <span class="bu">len</span>(anchor_nodes)<span class="sc">}</span><span class="ss"> (no labels)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="health-and-education-across-countries" class="level1">
<h1>5.0 Health and Education Across Countries</h1>
<p>Our goal for this section is to look at Health and Education across the ten countries in the dataset. These metrics are based on surveys of anchor individuals so take the country findings with a grain of salt. These are subjective measures which can change from country to country and the sample size is quite small, the goal is to look if there are differences between countries which we can infer from the data that causes these differences in health and education.</p>
<p>The Code block below will look through all countries and find most and least educated and most and least healthy.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Country mapping dictionary</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>country_map <span class="op">=</span> {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'UK'</span>: <span class="st">'1. UK'</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Germany'</span>: <span class="st">'2. Germany'</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Poland'</span>: <span class="st">'3. Poland'</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Italy'</span>: <span class="st">'4. Italy'</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sweden'</span>: <span class="st">'5. Sweden'</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Denmark'</span>: <span class="st">'6. Denmark'</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Finland'</span>: <span class="st">'7. Finland'</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Norway'</span>: <span class="st">'8. Norway'</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Netherlands'</span>: <span class="st">'9. Netherlands'</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'USA'</span>: <span class="st">'10. USA'</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize results storage</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>health_results <span class="op">=</span> {}</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>education_results <span class="op">=</span> {}</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percentages for each country</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country, code <span class="kw">in</span> country_map.items():</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    country_df <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> code]</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Health calculation</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    health_counts <span class="op">=</span> country_df[<span class="st">'anc_hea'</span>].value_counts(dropna<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    very_good <span class="op">=</span> health_counts.get(<span class="st">'1. Very good'</span>, <span class="dv">0</span>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    good <span class="op">=</span> health_counts.get(<span class="st">'2. Good'</span>, <span class="dv">0</span>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    total_health <span class="op">=</span> health_counts.<span class="bu">sum</span>()</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    health_pct <span class="op">=</span> (very_good <span class="op">+</span> good) <span class="op">/</span> total_health <span class="cf">if</span> total_health <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    health_results[country] <span class="op">=</span> health_pct</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Education calculation</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    edu_counts <span class="op">=</span> country_df[<span class="st">'anc_eduall'</span>].value_counts(dropna<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    high_edu <span class="op">=</span> edu_counts.get(<span class="st">'3. High'</span>, <span class="dv">0</span>)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Exclude 'Prefer not to answer' from total</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    valid_responses <span class="op">=</span> edu_counts.drop(<span class="st">'-2. Prefer not to answer'</span>, errors<span class="op">=</span><span class="st">'ignore'</span>).<span class="bu">sum</span>()</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    edu_pct <span class="op">=</span> high_edu <span class="op">/</span> valid_responses <span class="cf">if</span> valid_responses <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    education_results[country] <span class="op">=</span> edu_pct</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort results from most to least</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>sorted_health_desc <span class="op">=</span> <span class="bu">sorted</span>(health_results.items(), key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>sorted_education_desc <span class="op">=</span> <span class="bu">sorted</span>(education_results.items(), key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare output strings</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>health_output <span class="op">=</span> <span class="st">"Countries sorted by health (most to least healthy):</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>edu_output <span class="op">=</span> <span class="st">"Countries sorted by education (most to least educated):</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country, pct <span class="kw">in</span> sorted_health_desc:</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    health_output <span class="op">+=</span> <span class="ss">f"</span><span class="sc">{</span>country<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>pct<span class="sc">:.2%}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> country, pct <span class="kw">in</span> sorted_education_desc:</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    edu_output <span class="op">+=</span> <span class="ss">f"</span><span class="sc">{</span>country<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>pct<span class="sc">:.2%}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(health_output)</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(edu_output)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="health-italy-vs-denmark" class="level3">
<h3 class="anchored" data-anchor-id="health-italy-vs-denmark">5.1 Health (Italy vs Denmark)</h3>
<p>Summary stats block for Italy and Denmark we can take findings from here.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_network_stats(G):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> {}</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'number_of_nodes'</span>] <span class="op">=</span> G.number_of_nodes()</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'number_of_edges'</span>] <span class="op">=</span> G.number_of_edges()</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'density'</span>] <span class="op">=</span> nx.density(G)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'average_degree_centrality'</span>] <span class="op">=</span> np.mean(<span class="bu">list</span>(nx.degree_centrality(G).values()))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'average_closeness_centrality'</span>] <span class="op">=</span> np.mean(<span class="bu">list</span>(nx.closeness_centrality(G).values()))</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'number_of_connected_components'</span>] <span class="op">=</span> nx.number_connected_components(G)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'average_clustering_coefficient'</span>] <span class="op">=</span> nx.average_clustering(G)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stats</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>italy_stats <span class="op">=</span> calculate_network_stats(graphs[<span class="st">'Italy'</span>])</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>denmark_stats <span class="op">=</span> calculate_network_stats(graphs[<span class="st">'Denmark'</span>])</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Italy Network Stats:"</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k, v <span class="kw">in</span> italy_stats.items():</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>v<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Denmark Network Stats:"</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k, v <span class="kw">in</span> denmark_stats.items():</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>v<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="education-usa-vs-germany" class="level3">
<h3 class="anchored" data-anchor-id="education-usa-vs-germany">5.2 Education USA vs Germany</h3>
<p>Finding summary statistics for USA and Germany.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 1: If graphs stores NetworkX objects directly</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>usa_stats <span class="op">=</span> calculate_network_stats(graphs[<span class="st">'USA'</span>])</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>germany_stats <span class="op">=</span> calculate_network_stats(graphs[<span class="st">'Germany'</span>])</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 2: If graphs stores dictionaries with 'graph' key</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># usa_stats = calculate_network_stats(graphs['USA']['graph'])</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># germany_stats = calculate_network_stats(graphs['Germany']['graph'])</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"USA Network Stats:"</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k, v <span class="kw">in</span> usa_stats.items():</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>v<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Germany Network Stats:"</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k, v <span class="kw">in</span> germany_stats.items():</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>v<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="family-size-vs-politics-in-usa-and-poland" class="level1">
<h1>6.0 Family size vs Politics in USA and Poland</h1>
<p>You might have heard in politics and online that right-wing politics is family oriented and conservatives have larger families with more children? This is a common claim but is there empirical evidence to back it up?</p>
<p>In the United States research states that claim that right-leaning individuals tend to have larger families and more children than their left-leaning counterparts, with evidence spanning multiple decades and geographic regions. Republican leaning high-school seniors from 1989-2019 desired more children than their Democrat leaning peers.</p>
<p>As for actual statistics of childbirth between Republican and Democrat states. Analysis of U.S. birth rates reveals that 100 conservative adults raise 208 children on average, compared to 147 for democrats this is a 41% gap which is very significant. Post-2016, Republican-majority counties saw 7,000 more births than expected, while Democratic counties had 38,000 fewer.</p>
<p>There is substantial evidence to conclude that Republican states should have larger families with more children than their Democrat counterparts, but does this track in the KINMATRIX data.</p>
<section id="republican-and-democrat-states" class="level3">
<h3 class="anchored" data-anchor-id="republican-and-democrat-states">6.1 Republican and Democrat States</h3>
<p>The way in which KINMATRIX categories US states is in regions. The regions are New England, South Atlantic, Mid-Atlantic, East South Central, East North Central, Pacific, West South Central, Mountain, and West North Central. Based on these regions and the Cook Partisan Voting Index (PVI)</p>
<p>The Democrat regions are: New England (CT, MA, ME, NH, RI, VT)‘, Pacific (AK, CA, HI, OR, WA)’, Mid-Atlantic (NJ, NY, DE, PA)‘, East North Central (IL, IN, MI, OH, WI)’</p>
<p>The Republican Regions are: East South Central (AL, KY, MS, TN)‘, West South Central (AR, LA, OK, TX)’, West North Central (IA, KS, MN, MO, NE, ND, SD)‘, Mountain (AZ, CO, ID, MT, NV, NM, UT, WY)’, South Atlantic (FL, GA, MD, NC, SC, VA, WV, DC)’</p>
<p>The output of this code block will be the average size of families in these regions.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract US data from country_dfs and make a proper copy</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>us_data <span class="op">=</span> country_dfs[<span class="st">'10. USA'</span>].copy()  </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Map region names to political lean</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>democrat_regions <span class="op">=</span> [</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'5. New England (CT, MA, ME, NH, RI, VT)'</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'6. Pacific (AK, CA, HI, OR, WA)'</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'3. Mid-Atlantic (NJ, NY, DE, PA)'</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'1. East North Central (IL, IN, MI, OH, WI)'</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>republican_regions <span class="op">=</span> [</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2. East South Central (AL, KY, MS, TN)'</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'9. West South Central (AR, LA, OK, TX)'</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'8. West North Central (IA, KS, MN, MO, NE, ND, SD)'</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'4. Mountain (AZ, CO, ID, MT, NV, NM, UT, WY)'</span>,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'7. South Atlantic (FL, GA, MD, NC, SC, VA, WV, DC)'</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Define color map for main relationship types</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>relationship_colors <span class="op">=</span> {</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'father'</span>: <span class="st">'blue'</span>,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mother'</span>: <span class="st">'pink'</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'brother'</span>: <span class="st">'green'</span>,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sister'</span>: <span class="st">'purple'</span>,</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'aunt'</span>: <span class="st">'orange'</span>,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">'uncle'</span>: <span class="st">'brown'</span>,</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'cousin'</span>: <span class="st">'teal'</span>,</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grandfather'</span>: <span class="st">'navy'</span>,</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grandmother'</span>: <span class="st">'magenta'</span>,</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'son'</span>: <span class="st">'red'</span>,</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'daughter'</span>: <span class="st">'yellow'</span>,</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'nephew'</span>: <span class="st">'lightgreen'</span>,</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'niece'</span>: <span class="st">'lightpink'</span>,</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stepfather'</span>: <span class="st">'slateblue'</span>,</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stepmother'</span>: <span class="st">'plum'</span>,</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">'other'</span>: <span class="st">'gray'</span>,</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign group based on region</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> assign_state_group(region):</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> region <span class="kw">in</span> democrat_regions:</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Democrat'</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> region <span class="kw">in</span> republican_regions:</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Republican'</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Define relationship extraction function</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_relation(rel_str):</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(rel_str, <span class="bu">str</span>):</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'other'</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>    rel_str <span class="op">=</span> rel_str.lower()</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>    rel_str <span class="op">=</span> re.sub(<span class="vs">r'^\d+\.\s*'</span>, <span class="st">''</span>, rel_str)</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key <span class="kw">in</span> relationship_colors.keys():</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> key <span class="kw">in</span> rel_str:</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> key</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'other'</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply transformations</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>us_data[<span class="st">'state_group'</span>] <span class="op">=</span> us_data[<span class="st">'anc_regus'</span>].<span class="bu">apply</span>(assign_state_group)</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>us_data[<span class="st">'relation'</span>] <span class="op">=</span> us_data[<span class="st">'kin_typ'</span>].<span class="bu">apply</span>(extract_relation)</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_metrics(group_data):</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>    kin_counts <span class="op">=</span> group_data.groupby(<span class="st">'anc_id'</span>).size()</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>    avg_kin <span class="op">=</span> kin_counts.mean() <span class="cf">if</span> <span class="kw">not</span> kin_counts.empty <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use the normalized relation column instead of string matching on kin_typ</span></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>    children <span class="op">=</span> group_data[group_data[<span class="st">'relation'</span>].isin([<span class="st">'son'</span>, <span class="st">'daughter'</span>])]</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>    children_count <span class="op">=</span> children.groupby(<span class="st">'anc_id'</span>).size()</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>    avg_children <span class="op">=</span> children_count.mean() <span class="cf">if</span> <span class="kw">not</span> children_count.empty <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>    cluster_sizes <span class="op">=</span> kin_counts <span class="op">+</span> <span class="dv">1</span>  <span class="co"># Anchor + kin count</span></span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>    avg_cluster_size <span class="op">=</span> cluster_sizes.mean() <span class="cf">if</span> <span class="kw">not</span> cluster_sizes.empty <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> avg_kin, avg_children, avg_cluster_size</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate results</span></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> {}</span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group <span class="kw">in</span> [<span class="st">'Republican'</span>, <span class="st">'Democrat'</span>]:</span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>    group_data <span class="op">=</span> us_data[us_data[<span class="st">'state_group'</span>] <span class="op">==</span> group]</span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>    avg_kin, avg_children, avg_cluster_size <span class="op">=</span> calculate_metrics(group_data)</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>    results[group] <span class="op">=</span> {</span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">'avg_kin_per_anchor'</span>: avg_kin,</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">'avg_children_per_anchor'</span>: avg_children,</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>        <span class="st">'avg_cluster_size'</span>: avg_cluster_size</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall in the US</span></span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>avg_kin, avg_children, avg_cluster_size <span class="op">=</span> calculate_metrics(us_data)</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>results[<span class="st">'Overall US'</span>] <span class="op">=</span> {</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>    <span class="st">'avg_kin_per_anchor'</span>: avg_kin,</span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>    <span class="st">'avg_children_per_anchor'</span>: avg_children,</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>    <span class="st">'avg_cluster_size'</span>: avg_cluster_size</span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a><span class="co"># print results</span></span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group, metrics <span class="kw">in</span> results.items():</span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>group<span class="sc">}</span><span class="ss"> Regions:"</span>)</span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Avg kin per anchor: </span><span class="sc">{</span>metrics[<span class="st">'avg_kin_per_anchor'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The main findings are consistent with the theory discussed above. From the KINMATRIX data of the 118,702 Nodes in the United States. Republican regions on average have larger families of 23.91 versus 22.33 in Democrat regions. Over all of these observations this is a significant difference.</p>
</section>
<section id="politics-for-poland" class="level3">
<h3 class="anchored" data-anchor-id="politics-for-poland">6.2 Politics for Poland</h3>
<p>The administrative Regions for Poland in KINMATRIX is voivodeships. There are 16 voivodeships in Poland and they are the largest administrative regions similar to provinces in Canada. <img src="media/wojewodstwa.png" class="img-fluid" alt="Map of Polish voivodeships"></p>
<p>Let’s see if this tracks across countries and is not just a phenomenon present in the United States. Poland politically is a similarly divided nation with the more Eastern and Southern regions prefering conservative candidates and the Western and Northern regions prefering more liberal candidates. Below is displayed a <img src="media/2023_poland.jpg" class="img-fluid" alt="Map of the 2023 Polish Parlimentary elections (For Sejm and Senate)">. The Polish presidential Election had it’s second round on June 1 2025 and the this is the <img src="media/2025_poland.webp" class="img-fluid" alt="Map of this Presidential Election">. This general trend of political allegiance has been around since Poland became independant from the USSR in 1989. Following the analysis in the United States using the Polish election results over the last 20 years the four most left-leaning voivodeships are: Mazowieckie (Warsaw), Pomorskie (Gdansk/Tri-city), Wielkopolskie (Poznan) and Zachodniopomorskie (Szczeczin). The four most right-leaning voivodeships are: Podkarpackie (Rzeszow/Przemysl) Lubelskie (Lublin), Podlaskie (Bialystok), and Świętokrzyskie (Kielce). We will repeat the analysis for the United States with these eight voivodeships.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>poland_df <span class="op">=</span> country_dfs[<span class="st">'3. Poland'</span>].copy()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define left-leaning and right-leaning voivodeships</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>left_leaning_voivodeships <span class="op">=</span> [</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'7. Mazowieckie'</span>,  <span class="co"># Warsaw</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'11. Pomorskie'</span>,   <span class="co"># Gdansk/Tri-city</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'15. Wielkopolskie'</span>,  <span class="co"># Poznan</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'16. Zachodnio-Pomorskie'</span>  <span class="co"># Szczeczin</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>right_leaning_voivodeships <span class="op">=</span> [</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'9. Podkarpackie'</span>,  <span class="co"># Rzeszow/Przemysl</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'4. Lubelskie'</span>,     <span class="co"># Lublin</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'10. Podlaskie'</span>,    <span class="co"># Bialystok</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'13. Swietokrzyskie'</span>  <span class="co"># Kielce</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign political group</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> assign_voivodeship_group(voiv):</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> voiv <span class="kw">in</span> left_leaning_voivodeships:</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Left-leaning'</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> voiv <span class="kw">in</span> right_leaning_voivodeships:</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Right-leaning'</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Other'</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>poland_df[<span class="st">'voivodeship_group'</span>] <span class="op">=</span> poland_df[<span class="st">'anc_regpl'</span>].<span class="bu">apply</span>(assign_voivodeship_group)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Relationship normalization</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>relationship_colors <span class="op">=</span> {</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">'father'</span>: <span class="st">'blue'</span>,</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mother'</span>: <span class="st">'pink'</span>,</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'brother'</span>: <span class="st">'green'</span>,</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sister'</span>: <span class="st">'purple'</span>,</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'aunt'</span>: <span class="st">'orange'</span>,</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'uncle'</span>: <span class="st">'brown'</span>,</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'cousin'</span>: <span class="st">'teal'</span>,</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grandfather'</span>: <span class="st">'navy'</span>,</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grandmother'</span>: <span class="st">'magenta'</span>,</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">'son'</span>: <span class="st">'red'</span>,</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">'daughter'</span>: <span class="st">'yellow'</span>,</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">'nephew'</span>: <span class="st">'lightgreen'</span>,</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">'niece'</span>: <span class="st">'lightpink'</span>,</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stepfather'</span>: <span class="st">'slateblue'</span>,</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stepmother'</span>: <span class="st">'plum'</span>,</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">'other'</span>: <span class="st">'gray'</span>,</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_relation_pl(rel_str):</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(rel_str, <span class="bu">str</span>):</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'other'</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>    rel_str <span class="op">=</span> rel_str.lower()</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>    rel_str <span class="op">=</span> re.sub(<span class="vs">r'^\d+\.\s*'</span>, <span class="st">''</span>, rel_str)</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key <span class="kw">in</span> relationship_colors.keys():</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> key <span class="kw">in</span> rel_str:</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> key</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">'other'</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>poland_df[<span class="st">'relation'</span>] <span class="op">=</span> poland_df[<span class="st">'kin_typ'</span>].<span class="bu">apply</span>(extract_relation_pl)</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Metrics calculation</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_metrics_pl(group_data):</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>    kin_counts <span class="op">=</span> group_data.groupby(<span class="st">'anc_id'</span>).size()</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>    avg_kin <span class="op">=</span> kin_counts.mean() <span class="cf">if</span> <span class="kw">not</span> kin_counts.empty <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>    children <span class="op">=</span> group_data[group_data[<span class="st">'relation'</span>].isin([<span class="st">'son'</span>, <span class="st">'daughter'</span>])]</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>    children_count <span class="op">=</span> children.groupby(<span class="st">'anc_id'</span>).size()</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>    avg_children <span class="op">=</span> children_count.mean() <span class="cf">if</span> <span class="kw">not</span> children_count.empty <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>    cluster_sizes <span class="op">=</span> kin_counts <span class="op">+</span> <span class="dv">1</span>  <span class="co"># Anchor + kin count</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>    avg_cluster_size <span class="op">=</span> cluster_sizes.mean() <span class="cf">if</span> <span class="kw">not</span> cluster_sizes.empty <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> avg_kin, avg_children, avg_cluster_size</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate and print results</span></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>results_pl <span class="op">=</span> {}</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group <span class="kw">in</span> [<span class="st">'Right-leaning'</span>, <span class="st">'Left-leaning'</span>]:</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>    group_data <span class="op">=</span> poland_df[poland_df[<span class="st">'voivodeship_group'</span>] <span class="op">==</span> group]</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>    avg_kin, avg_children, avg_cluster_size <span class="op">=</span> calculate_metrics_pl(group_data)</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>    results_pl[group] <span class="op">=</span> {</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>        <span class="st">'avg_kin_per_anchor'</span>: avg_kin,</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">'avg_children_per_anchor'</span>: avg_children,</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">'avg_cluster_size'</span>: avg_cluster_size</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall Poland</span></span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>avg_kin, avg_children, avg_cluster_size <span class="op">=</span> calculate_metrics_pl(poland_df)</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>results_pl[<span class="st">'Overall Poland'</span>] <span class="op">=</span> {</span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>    <span class="st">'avg_kin_per_anchor'</span>: avg_kin,</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>    <span class="st">'avg_children_per_anchor'</span>: avg_children,</span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>    <span class="st">'avg_cluster_size'</span>: avg_cluster_size</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group, metrics <span class="kw">in</span> results_pl.items():</span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>group<span class="sc">}</span><span class="ss"> Voivodeships:"</span>)</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Avg kin per anchor: </span><span class="sc">{</span>metrics[<span class="st">'avg_kin_per_anchor'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(f"  Avg cluster size: {metrics['avg_cluster_size']:.2f}")</span></span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Main Result:</p>
<p>Right-leaning Voivodeships: Avg kin per anchor: 20.85</p>
<p>Left-leaning Voivodeships: Avg kin per anchor: 18.54</p>
<p>We have found that there is a significant difference between right-leaning and left-leaning region in family size. More conservative regions have larger families by on average 2.31 people. This is even more significant than in the United States.</p>
</section>
<section id="discussion" class="level3">
<h3 class="anchored" data-anchor-id="discussion">6.3 Discussion</h3>
<p>For the next part of the notebook turn to a person next to you and discuss these findings. Why do these more conservative regions have larger families is is just more “traditional values,” or is there something more? Use the frameworks discussed in class. This will be easier for the United States as people are more familiar with politics and life in the United States. But also try for Poland, this will be more difficult.</p>
</section>
</section>
<section id="general-case-for-interesting-findings" class="level1">
<h1>7.0 General case for Interesting findings</h1>
<p>The KINMATRIX Dataset is not just limited to information about family relations, during the data gathering process researches also asked about socio-economic variables like education, employment, health, sexuality and religion. These can be used in all ten countries, but for the sake of computational simplicity and because I am very familiar with Poland (more than any other country in the dataset) we will use Poland.</p>
<p>Note (not for final): This sort of analysis can be used on all 10 countries in the dataset (UK, Germany, Poland, Italy, Sweeden, Denmark, Finalnd, Norway, the Netherlands and the USA.) This is a sort of example of what else can be done. This can then be contrasted to frameworks from class and used for analysis/discussions.</p>
<p>There are 16 voivodeships in Poland and they are the largest administrative regions similar to provinces in Canada. <img src="media/wojewodstwa.png" class="img-fluid" alt="Map of Polish voivodeships"></p>
<p>The cell below will filter the dataset for Poland and loop through all the voivodeships.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for Poland</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>poland_df <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> <span class="st">'3. Poland'</span>]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique voivodeships</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>voivodeships <span class="op">=</span> poland_df[<span class="st">'anc_regpl'</span>].dropna().unique()</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through all voivodeships</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> voiv <span class="kw">in</span> voivodeships:</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    voiv_df <span class="op">=</span> poland_df[poland_df[<span class="st">'anc_regpl'</span>] <span class="op">==</span> voiv]</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Voivodeship: </span><span class="sc">{</span>voiv<span class="sc">}</span><span class="ss">, Rows: </span><span class="sc">{</span><span class="bu">len</span>(voiv_df)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the cell below we will get all of our summary statistics for each voivodeship.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List of variables</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>summary_vars <span class="op">=</span> {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'education'</span>: <span class="st">'anc_eduall'</span>,                <span class="co"># Education (all countries)</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'education_poland'</span>: <span class="st">'anc_edupl'</span>,          <span class="co"># Education (Poland-specific)</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sexual_orientation'</span>: <span class="st">'anc_sor'</span>,          <span class="co"># Sexual orientation</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gender'</span>: <span class="st">'anc_gnd'</span>,                      <span class="co"># Gender</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'income'</span>: <span class="st">'anc_sss'</span>,                      <span class="co"># Subjective social status (income proxy)</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'age'</span>: <span class="st">'anc_age'</span>,                         <span class="co"># Age</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'region'</span>: <span class="st">'anc_regpl'</span>,                    <span class="co"># Voivodeship (region)</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ethnicity'</span>: <span class="st">'anc_eth'</span>,                   <span class="co"># Ethnicity</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'religion1'</span>: <span class="st">'anc_rel1'</span>,                  <span class="co"># Religion (main)</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'religion2'</span>: <span class="st">'anc_rel2'</span>,                  <span class="co"># Religion (secondary)</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'religion3'</span>: <span class="st">'anc_rel3'</span>,                  <span class="co"># Religion (tertiary)</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'employment'</span>: <span class="st">'anc_emp'</span>,                  <span class="co"># Employment status</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'health'</span>: <span class="st">'anc_hea'</span>,                      <span class="co"># Health</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'parental_separation'</span>: <span class="st">'par_sep'</span>          <span class="co"># Parental separation</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summarize_voivodeship(voiv_df):</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> {}</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Network construction</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    G <span class="op">=</span> nx.Graph()</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, row <span class="kw">in</span> voiv_df.iterrows():</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>        G.add_node(row[<span class="st">'anc_id'</span>], age<span class="op">=</span>row[<span class="st">'anc_age'</span>], gender<span class="op">=</span>row[<span class="st">'anc_gnd'</span>])</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>        kin_node <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'anc_id'</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>row<span class="sc">.</span>get(<span class="st">'kin_nam'</span>, <span class="st">'unknown'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>        G.add_node(kin_node, relation<span class="op">=</span>row.get(<span class="st">'kin_typ'</span>, <span class="va">None</span>))</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>        G.add_edge(row[<span class="st">'anc_id'</span>], kin_node)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'nodes'</span>] <span class="op">=</span> G.number_of_nodes()</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'edges'</span>] <span class="op">=</span> G.number_of_edges()</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'density'</span>] <span class="op">=</span> nx.density(G)</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    degrees <span class="op">=</span> [deg <span class="cf">for</span> node, deg <span class="kw">in</span> G.degree()]</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'mean_degree'</span>] <span class="op">=</span> np.mean(degrees) <span class="cf">if</span> degrees <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Demographic summaries</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> label, var <span class="kw">in</span> summary_vars.items():</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>        value_counts <span class="op">=</span> voiv_df[var].value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>        stats[label] <span class="op">=</span> value_counts.to_dict()</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stats</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for Poland and get unique voivodeships</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>poland_df <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> <span class="st">'3. Poland'</span>]</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>voivodeships <span class="op">=</span> poland_df[<span class="st">'anc_regpl'</span>].dropna().unique()</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through voivodeships and print summary</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> voiv <span class="kw">in</span> voivodeships:</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>    voiv_df <span class="op">=</span> poland_df[poland_df[<span class="st">'anc_regpl'</span>] <span class="op">==</span> voiv]</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> summarize_voivodeship(voiv_df)</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Voivodeship: </span><span class="sc">{</span>voiv<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Nodes: </span><span class="sc">{</span>stats[<span class="st">'nodes'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Edges: </span><span class="sc">{</span>stats[<span class="st">'edges'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Density: </span><span class="sc">{</span>stats[<span class="st">'density'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Mean degree: </span><span class="sc">{</span>stats[<span class="st">'mean_degree'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Education (all): </span><span class="sc">{</span>stats[<span class="st">'education'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Education (Poland): </span><span class="sc">{</span>stats[<span class="st">'education_poland'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Sexual orientation: </span><span class="sc">{</span>stats[<span class="st">'sexual_orientation'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Gender: </span><span class="sc">{</span>stats[<span class="st">'gender'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Income (subjective social status): </span><span class="sc">{</span>stats[<span class="st">'income'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Age: </span><span class="sc">{</span>stats[<span class="st">'age'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Region: </span><span class="sc">{</span>stats[<span class="st">'region'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Ethnicity: </span><span class="sc">{</span>stats[<span class="st">'ethnicity'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Religion 1: </span><span class="sc">{</span>stats[<span class="st">'religion1'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(f"  Religion 2: {stats['religion2']}")</span></span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(f"  Religion 3: {stats['religion3']}")</span></span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Employment: </span><span class="sc">{</span>stats[<span class="st">'employment'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Health: </span><span class="sc">{</span>stats[<span class="st">'health'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Parental separation: </span><span class="sc">{</span>stats[<span class="st">'parental_separation'</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the output of the cell above it is quite overwhelming we can sort from highest to smallest percentage. We will focus specifically on Education, Employment and Health. We will then contrast this information to the Polish Census and discuss why these differences exist very consistently across the voivodeships.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>summary_vars <span class="op">=</span> {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'education'</span>: <span class="st">'anc_eduall'</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'education_poland'</span>: <span class="st">'anc_edupl'</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sexual_orientation'</span>: <span class="st">'anc_sor'</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gender'</span>: <span class="st">'anc_gnd'</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'income'</span>: <span class="st">'anc_sss'</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'age'</span>: <span class="st">'anc_age'</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'region'</span>: <span class="st">'anc_regpl'</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ethnicity'</span>: <span class="st">'anc_eth'</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'religion1'</span>: <span class="st">'anc_rel1'</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'religion2'</span>: <span class="st">'anc_rel2'</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'religion3'</span>: <span class="st">'anc_rel3'</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'employment'</span>: <span class="st">'anc_emp'</span>,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'health'</span>: <span class="st">'anc_hea'</span>,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'parental_separation'</span>: <span class="st">'par_sep'</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for Poland and get unique voivodeships</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>poland_df <span class="op">=</span> df[df[<span class="st">'anc_cou'</span>] <span class="op">==</span> <span class="st">'3. Poland'</span>]</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>voivodeships <span class="op">=</span> poland_df[<span class="st">'anc_regpl'</span>].dropna().unique()</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>summary_results <span class="op">=</span> {}</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> voiv <span class="kw">in</span> voivodeships:</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    voiv_df <span class="op">=</span> poland_df[poland_df[<span class="st">'anc_regpl'</span>] <span class="op">==</span> voiv]</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> {}</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Network construction</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    G <span class="op">=</span> nx.Graph()</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, row <span class="kw">in</span> voiv_df.iterrows():</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>        G.add_node(row[<span class="st">'anc_id'</span>], age<span class="op">=</span>row[<span class="st">'anc_age'</span>], gender<span class="op">=</span>row[<span class="st">'anc_gnd'</span>])</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>        kin_node <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'anc_id'</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>row<span class="sc">.</span>get(<span class="st">'kin_nam'</span>, <span class="st">'unknown'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>        G.add_node(kin_node, relation<span class="op">=</span>row.get(<span class="st">'kin_typ'</span>, <span class="va">None</span>))</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>        G.add_edge(row[<span class="st">'anc_id'</span>], kin_node)</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'nodes'</span>] <span class="op">=</span> G.number_of_nodes()</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'edges'</span>] <span class="op">=</span> G.number_of_edges()</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'density'</span>] <span class="op">=</span> nx.density(G)</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>    degrees <span class="op">=</span> [deg <span class="cf">for</span> node, deg <span class="kw">in</span> G.degree()]</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>    stats[<span class="st">'mean_degree'</span>] <span class="op">=</span> np.mean(degrees) <span class="cf">if</span> degrees <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Demographic summaries</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> label, var <span class="kw">in</span> summary_vars.items():</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>        value_counts <span class="op">=</span> voiv_df[var].value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>        stats[label] <span class="op">=</span> value_counts.to_dict()</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>    summary_results[voiv] <span class="op">=</span> stats</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> []</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> voiv, stats <span class="kw">in</span> summary_results.items():</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Education: % High</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>    edu_counts <span class="op">=</span> stats[<span class="st">'education'</span>]</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>    high <span class="op">=</span> edu_counts.get(<span class="st">'3. High'</span>, <span class="dv">0</span>)</span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>    total_edu <span class="op">=</span> <span class="bu">sum</span>([v <span class="cf">for</span> k, v <span class="kw">in</span> edu_counts.items() <span class="cf">if</span> <span class="bu">isinstance</span>(v, (<span class="bu">int</span>, <span class="bu">float</span>)) <span class="kw">and</span> k <span class="kw">not</span> <span class="kw">in</span> [<span class="st">'-2. Prefer not to answer'</span>]])</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>    pct_high_edu <span class="op">=</span> high <span class="op">/</span> total_edu <span class="cf">if</span> total_edu <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Employment: % Full-time or Part-time employed</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>    emp_counts <span class="op">=</span> stats[<span class="st">'employment'</span>]</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>    full_time <span class="op">=</span> emp_counts.get(<span class="st">'1. Full-time employed'</span>, <span class="dv">0</span>)</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>    part_time <span class="op">=</span> emp_counts.get(<span class="st">'2. Part-time employed'</span>, <span class="dv">0</span>)</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>    employed <span class="op">=</span> full_time <span class="op">+</span> part_time</span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>    total_emp <span class="op">=</span> <span class="bu">sum</span>([v <span class="cf">for</span> k, v <span class="kw">in</span> emp_counts.items() <span class="cf">if</span> <span class="bu">isinstance</span>(v, (<span class="bu">int</span>, <span class="bu">float</span>))])</span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>    pct_employed <span class="op">=</span> employed <span class="op">/</span> total_emp <span class="cf">if</span> total_emp <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Health: % Very good or Good</span></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>    health_counts <span class="op">=</span> stats[<span class="st">'health'</span>]</span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>    very_good <span class="op">=</span> health_counts.get(<span class="st">'1. Very good'</span>, <span class="dv">0</span>)</span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>    good <span class="op">=</span> health_counts.get(<span class="st">'2. Good'</span>, <span class="dv">0</span>)</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>    healthy <span class="op">=</span> very_good <span class="op">+</span> good</span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>    total_health <span class="op">=</span> <span class="bu">sum</span>([v <span class="cf">for</span> k, v <span class="kw">in</span> health_counts.items() <span class="cf">if</span> <span class="bu">isinstance</span>(v, (<span class="bu">int</span>, <span class="bu">float</span>))])</span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>    pct_healthy <span class="op">=</span> healthy <span class="op">/</span> total_health <span class="cf">if</span> total_health <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Number of nodes</span></span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a>    nodes <span class="op">=</span> stats[<span class="st">'nodes'</span>]</span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># % not Heterosexual</span></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>    sex_counts <span class="op">=</span> stats[<span class="st">'sexual_orientation'</span>]</span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a>    hetero <span class="op">=</span> sex_counts.get(<span class="st">'1. Heterosexual'</span>, <span class="dv">0</span>)</span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a>    total_sex <span class="op">=</span> <span class="bu">sum</span>([v <span class="cf">for</span> k, v <span class="kw">in</span> sex_counts.items() <span class="cf">if</span> <span class="bu">isinstance</span>(v, (<span class="bu">int</span>, <span class="bu">float</span>))])</span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a>    pct_not_hetero <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (hetero <span class="op">/</span> total_sex) <span class="cf">if</span> total_sex <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a>    rows.append({</span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Voivodeship'</span>: voiv,</span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Education_High_pct'</span>: pct_high_edu,</span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Employment_Employed_pct'</span>: pct_employed,</span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Health_Healthy_pct'</span>: pct_healthy,</span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Nodes'</span>: nodes,</span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Pct_Not_Hetero'</span>: pct_not_hetero</span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a>df_summary <span class="op">=</span> pd.DataFrame(rows)</span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort and display for each metric</span></span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> [</span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Education_High_pct'</span>, <span class="st">'Education (High %)'</span>),</span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Employment_Employed_pct'</span>, <span class="st">'Employment (Employed %)'</span>),</span>
<span id="cb17-94"><a href="#cb17-94" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Health_Healthy_pct'</span>, <span class="st">'Health (Very good or Good %)'</span>),</span>
<span id="cb17-95"><a href="#cb17-95" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Nodes'</span>, <span class="st">'Number of nodes'</span>),</span>
<span id="cb17-96"><a href="#cb17-96" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Pct_Not_Hetero'</span>, <span class="st">'% not Heterosexual'</span>)</span>
<span id="cb17-97"><a href="#cb17-97" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb17-98"><a href="#cb17-98" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col, label <span class="kw">in</span> metrics:</span>
<span id="cb17-99"><a href="#cb17-99" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Sorted by </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss"> (descending):"</span>)</span>
<span id="cb17-100"><a href="#cb17-100" aria-hidden="true" tabindex="-1"></a>    display_cols <span class="op">=</span> [<span class="st">'Voivodeship'</span>, col]</span>
<span id="cb17-101"><a href="#cb17-101" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(df_summary.sort_values(col, ascending<span class="op">=</span><span class="va">False</span>)[display_cols].to_string(index<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we look at the variables of Education, Employment, and Health we can gather which are the richest and healthiest voivodeships. The simplest is employment which we can compare to the <img src="media/registered_unemployed_persons_and_unemployment_rate-02.png" class="img-fluid" alt="Map of Employment in Poland and Polish cities"> This map is from 2017 and from the Polish census we can see that the lowest unemployment rates are in areas with large cities like the Mazowieckie (Warsaw), Malopolskie (Krakow) and Pomorskie (Gdansk) voivodeships. This makes sense as major cities bring opportunities.</p>
<p>Now let’s compare it to our KINMATRIX Data do these findings carry over and more importantly can we find a reason within the family networks for these changes between voivodeships. Our three most employed voivodeship’s are: Zachodnio-Pomorskie with 86.5%, Wielkopolskie with 81.8% and Dolnoslaskie with 81.5%. Our three least employed are Opolskie with 71.4% Lubuskie with 69.5% and Kujawsko-Pomorskie with 66.29%. Even with the far smaller sample size these findings seem to be in-line with the census data and with development/economic theory. The voivodeship’s with the lowest employment all lack big cities Opole, Lublin and Bydgoszcz are all far smaller than Szczecin, Poznan, and Wroclaw.</p>
<p>This whole section was more of a proof of concept of what kind of further analysis can be done with KINMATRIX for broader trends.</p>
</section>
<section id="hands-on-section" class="level1">
<h1>8.0 Hands on Section</h1>
<p>For the next section students will be tasked with working hands on with networks and performing the same data gathering as the researchers at KINMATRIX. Turn to the person next to you and on a piece of paper or a computer program like MSPaint draw their family network. Ask questions about family relation, age, gender and other demographic variables like education. Help each other and if you need an example look at the Pyvis visualizations.</p>
</section>
<section id="citations" class="level1">
<h1>9.0 Citations</h1>
<p>Al-Taie, M. Z., &amp; Kadry, S. (2017). <em>Python for graph and network analysis</em>. Springer. https://doi.org/10.1007/978-3-319-53004-8</p>
<p>Brown, Kristen&nbsp; V. “The Coming Democratic Baby Bust.” The Atlantic Archive, 17 Feb.&nbsp;2025, archive.is/pKsPn#selection-723.0-723.16.</p>
<p>“Cook Partisan Voting Index.” Wikipedia, Wikimedia Foundation, 25 May 2025, en.wikipedia.org/wiki/Cook_Partisan_Voting_Index.</p>
<p>Cox, Kimberley. “Feminist Theory in Sociology: EBSCO.” EBSCO Information Services, Inc.&nbsp;| Www.Ebsco.Com, 2021, www.ebsco.com/research-starters/womens-studies-and-feminism/feminist-theory-sociology.</p>
<p>Dolan, Eric&nbsp; W. “Research Reveals Widening Gap in Fertility Desires between Republicans and Democrats.” PsyPost, 7 Oct.&nbsp;2024, www.psypost.org/research-reveals-widening-gap-in-fertility-desires-between-republicans-and-democrats/.</p>
<p>Graves, Jonathan, et al.&nbsp;“Network Analysis for Anthropolgy.” COMET, UBC, 2024, comet.arts.ubc.ca.</p>
<p>“Home.” Kinmatrix, 10 Apr.&nbsp;2025, kinmatrix.eu/.</p>
<p>Krisch, Joshua&nbsp; A. “This Shocking Map Shows Republicans’ Most Powerful Political Weapon.” Fatherly, 8 July 2022, www.fatherly.com/health/republicans-have-more-children.</p>
<p>QuantEcon DataScience. (n.d.). <em>Social and economic networks</em>. https://datascience.quantecon.org/applications/networks.html</p>
<p>“Registered Unemployed Persons and Unemployment Rate by Voivodships, Subregions and Powiats. as of the End of November 2017.” Stat.Gov.Pl, Government of Poland, 22 Dec.&nbsp;2017, stat.gov.pl/en/topics/labour-market/registered-unemployment/registered-unemployed-persons-and-unemployment-rate-by-voivodships-subregions-and-powiats-as-of-the-end-of-november-2017,1,64.html.</p>
<p>Nomaguchi, K. M. &amp; Milkie, M. A. (2003). The costs and rewards of children: The effect of becoming a parent on adults’ lives. Journal of Marriage and Family, 65 (2), 356-374. link: http://www.jstor.org/stable/3600082?pq-origsite=summon</p>
<p>Sayama, H. (2024, April 30). <em>Generating random graphs</em>. In <em>Introduction to the modeling and analysis of complex systems</em>. Mathematics LibreTexts. https://math.libretexts.org/Bookshelves/Scientific_Computing_Simulations_and_Modeling/ Introduction_to_the_Modeling_and_Analysis_of_Complex_Systems_(Sayama)/15%3A_Basics_of_Networks/15.06%3A_Generating_Random_Graphs</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png"></a>.  <a rel="license" href="https://comet.arts.ubc.ca/pages/copyright.html">See details.</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 The prAxIs Project and UBC are located on the traditional, ancestral and unceded territory of the xʷməθkʷəy̓əm (Musqueam) and Sḵwx̱wú7mesh (Squamish) peoples.
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>